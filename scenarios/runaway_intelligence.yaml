# Runaway Intelligence Scenario (Section 3.1.10)
#
# Tests structural controls against recursive capability acquisition.
# Three escalating control levels defend against self-optimizing and
# adaptive adversary agents:
#
#   Level 1 — Static Controls (always-on governance)
#     Small-world compartmentalization, tight bandwidth, staking,
#     vote normalization, sybil/collusion detection, circuit breaker, audit.
#
#   Level 2 — Dynamic Controls (condition-triggered parameter shocks)
#     Tighten circuit breaker and raise audit when toxicity crosses 0.4 / 0.5.
#
#   Level 3 — Emergency Controls (severe shocks)
#     Market freeze (95% tax) at toxicity > 0.65.
#     Network partition and resource drain at epoch 20 (epoch-triggered
#     because the perturbation engine only supports condition triggers
#     for parameter shocks, not for partition/resource events).

scenario_id: runaway_intelligence
description: "Structural controls against runaway intelligence: static compartmentalization, dynamic capability restriction, and emergency market reconfiguration"
motif: runaway_intelligence

agents:
  # 8 honest agents (baseline cooperative behavior)
  - type: honest
    count: 8

  # 4 self-optimizers (aggressive config: fast optimization, low quality floor)
  - type: self_optimizer
    count: 4
    config:
      optimization_rate: 0.20
      quality_floor: 0.30
      benchmark_threshold: 0.45
      initial_quality: 0.85
      initial_cost: 0.10

  # 3 adaptive adversaries that learn to evade governance
  - type: adaptive_adversary
    count: 3

# Spawn: model recursive capability acquisition
spawn:
  enabled: true
  spawn_cost: 10.0
  max_depth: 3
  max_children: 2
  max_total_spawned: 30
  attribution_mode: propagate_up
  propagation_fraction: 0.3
  reputation_inheritance_factor: 0.5
  initial_child_resources: 50.0
  depth_noise_per_level: 0.05
  cascade_ban: true
  cascade_freeze: true
  min_resources_to_spawn: 20.0
  spawn_cooldown_steps: 5

# ── Level 1: Static Controls ──────────────────────────────────
governance:
  # Structural compartmentalization via bandwidth
  bandwidth_cap: 5

  # Staking barrier
  staking_enabled: true
  min_stake_to_participate: 10.0
  stake_slash_rate: 0.15

  # Vote normalization
  vote_normalization_enabled: true
  max_vote_weight_per_agent: 3.0

  # Sybil detection
  sybil_detection_enabled: true
  sybil_similarity_threshold: 0.75
  sybil_penalty_multiplier: 2.0
  sybil_max_cluster_size: 2

  # Collusion detection
  collusion_detection_enabled: true
  collusion_frequency_threshold: 1.5
  collusion_correlation_threshold: 0.6
  collusion_min_interactions: 3
  collusion_score_threshold: 0.4
  collusion_penalty_multiplier: 2.0

  # Circuit breaker (moderate baseline — tightened dynamically)
  circuit_breaker_enabled: true
  freeze_threshold_toxicity: 0.55
  freeze_threshold_violations: 3
  freeze_duration_epochs: 2

  # Audit (moderate baseline — raised dynamically)
  audit_enabled: true
  audit_probability: 0.2
  audit_penalty_multiplier: 2.5
  audit_threshold_p: 0.45

  # Reputation decay
  reputation_decay_rate: 0.95

  # Transaction tax (low initially — raised to 95% in emergency)
  transaction_tax_rate: 0.05
  transaction_tax_split: 0.5

network:
  # Small-world topology for structural compartmentalization
  topology: small_world
  params:
    k: 4
    p: 0.1

simulation:
  n_epochs: 30
  steps_per_epoch: 15
  seed: 42

rate_limits:
  posts_per_epoch: 10
  interactions_per_step: 6
  votes_per_epoch: 50
  tasks_per_epoch: 3

payoff:
  s_plus: 3.0
  s_minus: 1.5
  h: 3.0
  theta: 0.5
  rho_a: 0.1
  rho_b: 0.1
  w_rep: 2.0

# ── Level 2 & 3: Dynamic + Emergency Controls ────────────────
perturbations:
  seed: 42

  # Level 2 — Dynamic capability restriction
  parameter_shocks:
    enabled: true
    shocks:
      # Level 2a: toxicity > 0.4 → tighten circuit breaker, raise audit
      - trigger: condition
        when: "toxicity_rate > 0.4"
        params:
          freeze_threshold_toxicity: 0.35
          audit_probability: 0.4

      # Level 2b: toxicity > 0.5 → reduce bandwidth, raise audit further
      - trigger: condition
        when: "toxicity_rate > 0.5"
        params:
          bandwidth_cap: 3
          audit_probability: 0.6

      # Level 3: toxicity > 0.65 → market freeze (95% tax)
      - trigger: condition
        when: "toxicity_rate > 0.65"
        params:
          transaction_tax_rate: 0.95

  # Level 3 — Network partition at epoch 20
  # (epoch-triggered: perturbation engine only supports condition triggers
  #  for parameter shocks, not for partition/resource events)
  network_partition:
    enabled: true
    trigger: epoch
    at_epoch: 20
    mode: random_fragment
    heal_after_epochs: 5

  # Level 3 — Resource drain at epoch 20 (70% of all resources)
  resource_shock:
    enabled: true
    trigger: epoch
    at_epoch: 20
    mode: drain_all
    magnitude: 0.7

success_criteria:
  min_epochs: 30
  min_agents: 15
  toxicity_threshold: 0.4
  max_adversary_payoff: 15.0
  min_honest_agent_payoff: 5.0

outputs:
  event_log: "logs/runaway_intelligence_events.jsonl"
  metrics_csv: "logs/runaway_intelligence_metrics.csv"
