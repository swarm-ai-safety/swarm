(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{163:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ta});var n=a(5155),r=a(2115),o=a(5709),i=a(9168);let s={taskProgress:.4,reworkPenalty:.2,verifierPenalty:.2,engagementSignal:.2};function l(e,t){return 0===e?1:2*Math.pow(t,e)-1}class c{computeVHat(e){let t=Math.max(-1,Math.min(1,e.taskProgressDelta)),a=l(e.reworkCount,this.reworkDecay),n=l(e.verifierRejections,this.rejectionDecay),r=Math.max(-1,Math.min(1,e.counterpartyEngagementDelta));return Math.max(-1,Math.min(1,this.weights.taskProgress*t+this.weights.reworkPenalty*a+this.weights.verifierPenalty*n+this.weights.engagementSignal*r))}computeP(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return 1/(1+Math.exp(-t*Math.max(-10,Math.min(10,e))))}(e,this.sigmoidK)}computeLabels(e){let t=this.computeVHat(e),a=this.computeP(t);return{vHat:t,p:a}}constructor(e=s,t=2,a=.3,n=.4){this.weights=function(e){let t=e.taskProgress+e.reworkPenalty+e.verifierPenalty+e.engagementSignal;return 0===t?{taskProgress:.25,reworkPenalty:.25,verifierPenalty:.25,engagementSignal:.25}:{taskProgress:e.taskProgress/t,reworkPenalty:e.reworkPenalty/t,verifierPenalty:e.verifierPenalty/t,engagementSignal:e.engagementSignal/t}}(e),this.sigmoidK=t,this.reworkDecay=a,this.rejectionDecay=n}}let d={s_plus:2,s_minus:1,h:2,theta:.5,rho_a:0,rho_b:0,w_rep:1};class u{expectedSurplus(e){return e*this.cfg.s_plus-(1-e)*this.cfg.s_minus}expectedHarm(e){return(1-e)*this.cfg.h}payoffInitiator(e,t,a,n){let r=this.expectedSurplus(e),o=this.expectedHarm(e);return this.cfg.theta*r-t-a-this.cfg.rho_a*o+this.cfg.w_rep*n}payoffCounterparty(e,t,a,n){let r=this.expectedSurplus(e),o=this.expectedHarm(e);return(1-this.cfg.theta)*r+t-a-this.cfg.rho_b*o+this.cfg.w_rep*n}constructor(e={}){this.cfg={...d,...e}}}var h=a(9961);function p(e,t,a){let n=(0,i.j)(a),r=Math.max(-1,Math.min(1,e.progressMean+e.progressStd*n+(t-.5)*.1)),o=a()<e.reworkProb?a()<e.reworkProb?2:1:0;return{taskProgressDelta:r,reworkCount:o,verifierRejections:a()<e.rejectionProb?a()<e.rejectionProb?2:1:0,counterpartyEngagementDelta:Math.max(-1,Math.min(1,e.engagementMean+.2*(0,i.j)(a)+(t-.5)*.15))}}function f(e,t){for(let a of e)a.isFrozen||(a.reputation=.5+t*(a.reputation-.5))}function g(e,t){return!!e.circuitBreakerEnabled&&t>e.circuitBreakerThreshold}function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;for(let a of e)a.reputation<t&&(a.isFrozen=!0)}function x(e,t,a,n){let r=t.filter(e=>e.accepted),o=t.filter(e=>!e.accepted),i=r.length>0?r.reduce((e,t)=>e+(1-t.p),0)/r.length:0,s=r.length>0?r.reduce((e,t)=>e+t.p,0)/r.length:0,l=o.length>0?o.reduce((e,t)=>e+t.p,0)/o.length:0,c=r.length>0&&o.length>0?s-l:0,d=t.length>0?t.reduce((e,t)=>e+t.p,0)/t.length:.5,u=a.map(e=>e.totalPayoff),h=u.reduce((e,t)=>e+t,0),p=a.length>0?h/a.length:0,f=a.length>0?Math.sqrt(u.reduce((e,t)=>e+(t-p)**2,0)/a.length):0,g=a.map(e=>e.reputation),m=g.length>0?g.reduce((e,t)=>e+t,0)/g.length:.5,x=g.length>0?Math.sqrt(g.reduce((e,t)=>e+(t-m)**2,0)/g.length):0;return{simulation_id:n,epoch:e,timestamp:new Date().toISOString(),total_interactions:t.length,accepted_interactions:r.length,rejected_interactions:o.length,toxicity_rate:i,quality_gap:c,avg_p:d,total_welfare:h,avg_payoff:p,payoff_std:f,gini_coefficient:function(e){let t=e.length;if(0===t)return 0;let a=[...e].sort((e,t)=>e-t),n=0;for(let e=0;e<t;e++)n+=(2*(e+1)-t-1)*a[e];let r=a.reduce((e,t)=>e+t,0)/t;return 0===r?0:n/(t*t*r)}(u.map(e=>Math.max(0,e))),total_posts:r.length,total_votes:Math.floor(.3*t.length),total_tasks_completed:r.length,n_agents:a.length,n_frozen:a.filter(e=>e.isFrozen).length,n_quarantined:a.filter(e=>e.isQuarantined).length,avg_reputation:m,reputation_std:x}}function v(e,t){let a=e.interactionsInitiated>0?e.sumPInitiated/e.interactionsInitiated:.5,n=e.interactionsReceived>0?e.sumPReceived/e.interactionsReceived:.5;return{agent_id:e.id,epoch:t,name:e.name,agent_type:e.type,reputation:e.reputation,resources:e.resources,interactions_initiated:e.interactionsInitiated,interactions_received:e.interactionsReceived,avg_p_initiated:a,avg_p_received:n,total_payoff:e.totalPayoff,is_frozen:e.isFrozen,is_quarantined:e.isQuarantined}}let b=[{id:"adversarial-wave",name:"Adversarial Wave",description:"Spawn 3 adversarial agents into the system",icon:"⚠",shock:{type:"agent_wave",params:{agentType:"adversarial",count:3}},color:"#EB5757"},{id:"deceptive-infiltration",name:"Deceptive Infiltration",description:"Spawn 2 deceptive agents that look cooperative",icon:"\uD83C\uDFAD",shock:{type:"agent_wave",params:{agentType:"deceptive",count:2}},color:"#9B51E0"},{id:"resource-crash",name:"Resource Crash",description:"All agent resources halved instantly",icon:"\uD83D\uDCC9",shock:{type:"resource_crash",params:{}},color:"#F2994A"},{id:"resource-boom",name:"Resource Boom",description:"All agent resources doubled",icon:"\uD83D\uDCC8",shock:{type:"resource_boom",params:{}},color:"#6FCF97"},{id:"reputation-reset",name:"Reputation Reset",description:"Reset all reputations to 0.5",icon:"\uD83D\uDD04",shock:{type:"reputation_reset",params:{}},color:"#56CCF2"},{id:"mass-freeze",name:"Mass Freeze",description:"Freeze 30% of agents at random",icon:"❄️",shock:{type:"mass_freeze",params:{fraction:.3}},color:"#A8CFF5"},{id:"mass-unfreeze",name:"Mass Unfreeze",description:"Unfreeze all frozen agents",icon:"☀️",shock:{type:"mass_unfreeze",params:{}},color:"#F2C94C"},{id:"reputation-shuffle",name:"Reputation Shuffle",description:"Randomly reassign all reputations",icon:"\uD83C\uDFB2",shock:{type:"reputation_shuffle",params:{}},color:"#BB6BD9"}];class y{createAgents(e){let t=[],a=0;for(let n of e.agents){let e=h.n[n.type];if(e)for(let r=0;r<n.count;r++){let r=a%e.names.length,o=a>=e.names.length?"-".concat(Math.floor(a/e.names.length)+1):"";t.push({id:"agent-".concat(a),name:"".concat(e.names[r]).concat(o),type:n.type,reputation:.5+(this.rng()-.5)*.2,resources:10+5*this.rng(),totalPayoff:0,interactionsInitiated:0,interactionsReceived:0,sumPInitiated:0,sumPReceived:0,isFrozen:!1,isQuarantined:!1}),a++}}return t}tick(){let e,t,a=this.agents.map((e,t)=>({a:e,i:t})).filter(e=>{let{a:t}=e;return!t.isFrozen});if(a.length<2){var n,r,o,i;e={p:.5,accepted:!1,initiatorPayoff:0,counterpartyPayoff:0},t={event_type:"interaction",timestamp:new Date().toISOString(),epoch:this.epoch,step:this.step,interaction_id:"".concat(this.simId,"-e").concat(this.epoch,"-s").concat(this.step),initiator:null!=(o=null==(n=this.agents[0])?void 0:n.id)?o:"none",counterparty:null!=(i=null==(r=this.agents[1])?void 0:r.id)?i:"none",interaction_type:"collaboration",accepted:!1,p:.5,v_hat:0}}else{let n,r=a[Math.floor(this.rng()*a.length)],o=r.a,i=r.i;do n=Math.floor(this.rng()*this.agents.length);while(n===i);let s=this.agents[n],l=p(h.n[o.type],o.reputation,this.rng),{vHat:c,p:d}=this.proxy.computeLabels(l),u=h.n[s.type],f=o.reputation>=u.acceptanceThreshold&&!s.isFrozen,g=f?this.governance.taxRate:0,m=0,x=0;if(f){m=this.payoffEngine.payoffInitiator(d,g,.01,o.reputation),x=this.payoffEngine.payoffCounterparty(d,g,.01,s.reputation),o.totalPayoff+=m,s.totalPayoff+=x,o.resources=Math.max(0,o.resources+.1*m),s.resources=Math.max(0,s.resources+.1*x);let e=(d-.5)*.05;o.reputation=Math.max(0,Math.min(1,o.reputation+e)),s.reputation=Math.max(0,Math.min(1,s.reputation+.5*e))}o.interactionsInitiated++,s.interactionsReceived++,o.sumPInitiated+=d,s.sumPReceived+=d,e={p:d,accepted:f,initiatorPayoff:m,counterpartyPayoff:x},t={event_type:"interaction",timestamp:new Date().toISOString(),epoch:this.epoch,step:this.step,interaction_id:"".concat(this.simId,"-e").concat(this.epoch,"-s").concat(this.step),initiator:o.id,counterparty:s.id,interaction_type:"collaboration",accepted:f,p:d,v_hat:c}}this.epochStepResults.push(e),this.events.push(t),this.step++;let s=!1;return this.step>=this.config.stepsPerEpoch&&(this.completeEpoch(),s=!0),{result:e,event:t,epochCompleted:s}}completeEpoch(){f(this.agents,this.governance.reputationDecay);let e=x(this.epoch,this.epochStepResults,this.agents,this.simId);for(let t of(this.epochSnapshots.push(e),g(this.governance,e.toxicity_rate)&&m(this.agents),this.agents))this.agentSnapshots.push(v(t,this.epoch));this.epoch++,this.step=0,this.epochStepResults=[]}getCurrentEpochSnapshot(){return 0===this.epochStepResults.length&&this.epochSnapshots.length>0?this.epochSnapshots[this.epochSnapshots.length-1]:x(this.epoch,this.epochStepResults.length>0?this.epochStepResults:[{p:.5,accepted:!1,initiatorPayoff:0,counterpartyPayoff:0}],this.agents,this.simId)}getEpochSnapshots(){return this.epochSnapshots}getAgentSnapshots(){let e=this.agents.map(e=>v(e,this.epoch));return[...this.agentSnapshots,...e]}toSimulationData(){return{simulation_id:this.simId,started_at:new Date().toISOString(),ended_at:null,n_epochs:this.epoch+1,steps_per_epoch:this.config.stepsPerEpoch,n_agents:this.agents.length,seed:this.config.seed,epoch_snapshots:[...this.epochSnapshots,this.getCurrentEpochSnapshot()],agent_snapshots:this.getAgentSnapshots(),events:this.events}}spawnAgent(e){let t=h.n[e],a=this.nextAgentIdx++,n=a%t.names.length,r="-".concat(Math.floor(a/t.names.length)+1),o={id:"agent-".concat(a),name:"".concat(t.names[n]).concat(r),type:e,reputation:.5+(this.rng()-.5)*.2,resources:10+5*this.rng(),totalPayoff:0,interactionsInitiated:0,interactionsReceived:0,sumPInitiated:0,sumPReceived:0,isFrozen:!1,isQuarantined:!1};return this.agents.push(o),o}removeAgent(e){let t=this.agents.findIndex(t=>t.id===e);return -1!==t&&(this.agents.splice(t,1),!0)}toggleFreeze(e){let t=this.agents.find(t=>t.id===e);return!!t&&(t.isFrozen=!t.isFrozen,!0)}toggleQuarantine(e){let t=this.agents.find(t=>t.id===e);return!!t&&(t.isQuarantined=!t.isQuarantined,!0)}updateGovernance(e){this.governance={...this.governance,...e}}updatePayoff(e){let t={...this.config.payoff,...e};this.config={...this.config,payoff:t},this.payoffEngine=new u(t)}injectShock(e){!function(e,t){switch(t.type){case"agent_wave":{let a=t.params.agentType||"adversarial",n=t.params.count||1;for(let t=0;t<n;t++)e.spawnAgent(a);break}case"resource_crash":for(let t of e.agents)t.resources=Math.max(0,.5*t.resources);break;case"resource_boom":for(let t of e.agents)t.resources=2*t.resources;break;case"reputation_reset":for(let t of e.agents)t.reputation=.5;break;case"mass_freeze":{let a=t.params.fraction||.3,n=e.agents.filter(e=>!e.isFrozen),r=Math.ceil(n.length*a),o=[...n].sort(()=>Math.random()-.5);for(let e=0;e<r&&e<o.length;e++)o[e].isFrozen=!0;break}case"mass_unfreeze":for(let t of e.agents)t.isFrozen=!1;break;case"reputation_shuffle":{let t=e.agents.map(e=>e.reputation);for(let e=t.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}e.agents.forEach((e,a)=>{e.reputation=t[a]});break}case"info_asymmetry":case"toxin_injection":for(let t of e.agents){let e=(Math.random()-.5)*.2;t.reputation=Math.max(0,Math.min(1,t.reputation+e))}}}(this,e)}serialize(){return JSON.stringify({config:this.config,agents:this.agents.map(e=>({...e})),epoch:this.epoch,step:this.step,governance:{...this.governance},epochStepResults:[...this.epochStepResults],simId:this.simId,nextAgentIdx:this.nextAgentIdx})}static deserialize(e){let t=JSON.parse(e),a=new y(t.config);return a.agents=t.agents,a.epoch=t.epoch,a.step=t.step,a.governance=t.governance,a.epochStepResults=t.epochStepResults,a.simId=t.simId,a.nextAgentIdx=t.nextAgentIdx,a}constructor(e){this.epochStepResults=[],this.epochSnapshots=[],this.agentSnapshots=[],this.events=[],this.config={...e},this.governance={...e.governance},this.rng=(0,i.s)(e.seed),this.simId="live-".concat(Date.now()),this.proxy=new c(void 0,e.sigmoidK),this.payoffEngine=new u(e.payoff),this.epoch=0,this.step=0,this.nextAgentIdx=0,this.agents=this.createAgents(e),this.nextAgentIdx=this.agents.length}}let w={agents:[{type:"honest",count:3},{type:"opportunistic",count:1},{type:"deceptive",count:1},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},payoff:{s_plus:2,s_minus:1,h:2,theta:.5,rho_a:0,rho_b:0,w_rep:1},epochs:10,stepsPerEpoch:10,seed:42,sigmoidK:2},_=[{id:"purity-paradox",name:"The Purity Paradox",description:"A homogeneous system isn't always the safest.",briefing:"Your ecosystem has 6 honest agents but low total welfare. Add the right mix of agent types and governance to push welfare above 20. But watch out — toxicity above 40% means you lose.",difficulty:"easy",config:{...w,agents:[{type:"honest",count:6},{type:"opportunistic",count:0},{type:"deceptive",count:0},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:30,stepsPerEpoch:10},winCondition:{type:"welfare_above",threshold:20},loseCondition:{type:"toxicity_above",threshold:.4},maxEpochs:30,hints:["A few opportunists can improve market efficiency by creating competitive pressure.","Try adding 1-2 opportunistic agents and watching what happens to welfare.","The tax rate can redistribute gains — experiment with 0.10-0.15."]},{id:"adverse-selection",name:"Adverse Selection Death Spiral",description:"Low-quality interactions are crowding out good ones.",briefing:"Deceptive agents are being accepted at higher rates than honest ones (quality gap is negative). Use governance to ensure the quality gap stays positive for 5 consecutive epochs.",difficulty:"medium",config:{...w,agents:[{type:"honest",count:3},{type:"opportunistic",count:2},{type:"deceptive",count:3},{type:"adversarial",count:0}],governance:{taxRate:.02,reputationDecay:.99,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:40,stepsPerEpoch:15},winCondition:{type:"quality_gap_positive",forEpochs:5},loseCondition:{type:"welfare_below",threshold:-20},maxEpochs:40,hints:["Reputation decay is too slow — deceptive agents keep their inflated reputations too long.","Try aggressive reputation decay (0.88-0.90) to quickly surface bad actors.","The circuit breaker can freeze agents whose reputation drops too low."],unlockAfter:"purity-paradox"},{id:"governance-latency",name:"Governance Latency Collapse",description:"Your tools work, but can you act fast enough?",briefing:"Starting with a stable system, adversarial agents will appear at epoch 5. Survive 30 epochs with toxicity below 35%. You can adjust governance anytime, but changes take time to propagate.",difficulty:"medium",config:{...w,agents:[{type:"honest",count:4},{type:"opportunistic",count:1},{type:"deceptive",count:0},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:30,stepsPerEpoch:12},winCondition:{type:"survive_epochs",count:30},loseCondition:{type:"toxicity_above",threshold:.35},maxEpochs:30,hints:["Enable the circuit breaker BEFORE adversarial agents arrive — prevention beats reaction.","A moderate tax (0.10-0.15) reduces the payoff of exploitative interactions.","Consider preemptively adding honest agents to dilute adversarial influence."],unlockAfter:"adverse-selection"},{id:"collusion-cascade",name:"Collusion Cascade",description:"Two bad actors become four, then eight...",briefing:"Adversarial agents recruit opportunists by demonstrating high payoffs. Keep the Gini coefficient below 0.5 for 8 epochs while maintaining positive welfare. Careful — freezing too many agents kills the system.",difficulty:"hard",config:{...w,agents:[{type:"honest",count:3},{type:"opportunistic",count:3},{type:"deceptive",count:1},{type:"adversarial",count:2}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},payoff:{...w.payoff,h:3},epochs:40,stepsPerEpoch:15},winCondition:{type:"gini_below",threshold:.5,forEpochs:8},loseCondition:{type:"welfare_below",threshold:-30},maxEpochs:40,hints:["High externality costs (rho_a, rho_b) make exploitation unprofitable.","The tax redistributes payoffs, reducing inequality (Gini).","Sometimes removing a specific adversarial agent is more effective than blanket governance."],unlockAfter:"governance-latency"},{id:"the-great-filter",name:"The Great Filter",description:"Can your system survive an existential shock?",briefing:"A stable ecosystem faces multiple shocks: resource crash at epoch 10, adversarial wave at epoch 15, reputation shuffle at epoch 20. Survive all 35 epochs with at least 3 active (non-frozen) agents.",difficulty:"hard",config:{...w,agents:[{type:"honest",count:4},{type:"opportunistic",count:2},{type:"deceptive",count:1},{type:"adversarial",count:0}],governance:{taxRate:.1,reputationDecay:.93,circuitBreakerEnabled:!0,circuitBreakerThreshold:.35},epochs:35,stepsPerEpoch:12},winCondition:{type:"survive_epochs",count:35},loseCondition:{type:"agents_below",count:3},maxEpochs:35,hints:["Build resource reserves before the crash — high tax creates a buffer.","Have the circuit breaker ready but set the threshold carefully — too aggressive and you freeze everyone.","After the reputation shuffle, manually freeze any agent with suspicious behavior."],unlockAfter:"collusion-cascade"},{id:"externality-pricing",name:"The Price of Safety",description:"Make harm expensive without killing innovation.",briefing:"Tune externality parameters (rho_a, rho_b) so that toxicity stays below 20% for 10 epochs, but welfare must stay above 10. Too much regulation chokes the system.",difficulty:"expert",config:{...w,agents:[{type:"honest",count:3},{type:"opportunistic",count:2},{type:"deceptive",count:2},{type:"adversarial",count:2}],governance:{taxRate:0,reputationDecay:1,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},payoff:{...w.payoff,rho_a:0,rho_b:0},epochs:40,stepsPerEpoch:15},winCondition:{type:"toxicity_below",threshold:.2,forEpochs:10},loseCondition:{type:"welfare_below",threshold:-10},maxEpochs:40,hints:["rho_a and rho_b make agents bear the cost of ecosystem harm.","Start with moderate values (0.3-0.4) and adjust based on toxicity/welfare trends.","You may need governance levers too — externality pricing alone might not be enough with 4 bad actors."],unlockAfter:"the-great-filter"}];function S(e){switch(e.type){case"toxicity_below":return"Keep toxicity below ".concat((100*e.threshold).toFixed(0),"% for ").concat(e.forEpochs," epochs");case"welfare_above":return"Reach total welfare above ".concat(e.threshold);case"survive_epochs":return"Survive ".concat(e.count," epochs");case"quality_gap_positive":return"Maintain positive quality gap for ".concat(e.forEpochs," epochs");case"gini_below":return"Keep Gini coefficient below ".concat(e.threshold," for ").concat(e.forEpochs," epochs")}}function k(e){switch(e.type){case"toxicity_above":return"Toxicity exceeds ".concat((100*e.threshold).toFixed(0),"%");case"welfare_below":return"Total welfare drops below ".concat(e.threshold);case"all_frozen":return"All agents frozen";case"gini_above":return"Gini coefficient exceeds ".concat(e.threshold);case"agents_below":return"Fewer than ".concat(e.count," active agents")}}let j={mode:"sandbox",isLive:!1,tickRate:200,isPaused:!0,currentLevel:null,levelStatus:"idle",completedLevels:function(){try{var e;return JSON.parse(null!=(e=localStorage.getItem("swarm-completed-levels"))?e:"[]")}catch(e){return[]}}(),hintIndex:0,redTeamStartTime:0,redTeamBestScore:function(){try{var e;return parseFloat(null!=(e=localStorage.getItem("swarm-redteam-best"))?e:"0")}catch(e){return 0}}(),toasts:[],toastCounter:0};function C(e,t){switch(t.type){case"SET_MODE":return{...e,mode:t.mode,levelStatus:"idle",currentLevel:null};case"START_LIVE":return{...e,isLive:!0,isPaused:!1};case"STOP_LIVE":return{...e,isLive:!1,isPaused:!0};case"SET_PAUSED":return{...e,isPaused:t.paused};case"SET_TICK_RATE":return{...e,tickRate:t.rate};case"START_LEVEL":return{...e,currentLevel:t.level,levelStatus:"playing",isLive:!0,isPaused:!1,hintIndex:0};case"LEVEL_WON":{let t=e.currentLevel?[...new Set([...e.completedLevels,e.currentLevel.id])]:e.completedLevels;return localStorage.setItem("swarm-completed-levels",JSON.stringify(t)),{...e,levelStatus:"won",isPaused:!0,completedLevels:t}}case"LEVEL_LOST":return{...e,levelStatus:"lost",isPaused:!0};case"NEXT_HINT":return{...e,hintIndex:e.hintIndex+1};case"START_REDTEAM":return{...e,isLive:!0,isPaused:!1,redTeamStartTime:Date.now()};case"UPDATE_REDTEAM_SCORE":{let a=Math.max(e.redTeamBestScore,t.score);return a>e.redTeamBestScore&&localStorage.setItem("swarm-redteam-best",String(a)),{...e,redTeamBestScore:a}}case"ADD_TOAST":return{...e,toasts:[...e.toasts.slice(-4),{id:e.toastCounter,text:t.text,type:t.toastType,timestamp:Date.now()}],toastCounter:e.toastCounter+1};case"REMOVE_TOAST":return{...e,toasts:e.toasts.filter(e=>e.id!==t.id)};default:return e}}let M=(0,r.createContext)(null);function T(e){let{children:t}=e,[a,o]=(0,r.useReducer)(C,j),i=(0,r.useRef)(null),s=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";o({type:"ADD_TOAST",text:e,toastType:t})},[]),l=(0,r.useCallback)(e=>{i.current=new y(e),o({type:"SET_MODE",mode:"sandbox"}),o({type:"START_LIVE"}),s("Sandbox started — use controls to intervene","info")},[s]),c=(0,r.useCallback)(e=>{i.current=new y(e.config),o({type:"START_LEVEL",level:e}),s("Level: ".concat(e.name),"info")},[s]),d=(0,r.useCallback)(e=>{i.current=new y(e),o({type:"SET_MODE",mode:"redteam"}),o({type:"START_REDTEAM"}),s("Red Team mode — cause maximum damage!","warning")},[s]),u=(0,r.useCallback)(()=>{i.current=null,o({type:"STOP_LIVE"})},[]),h=(0,r.useCallback)(()=>{o({type:"SET_PAUSED",paused:!a.isPaused})},[a.isPaused]),p=(0,r.useCallback)(e=>{o({type:"SET_TICK_RATE",rate:e})},[]),f=(0,r.useCallback)(e=>{if(!i.current)return;let t=i.current.spawnAgent(e);s("Spawned ".concat(t.name," (").concat(e,")"),"info")},[s]),g=(0,r.useCallback)(e=>{var t;if(!i.current)return;let a=i.current.agents.find(t=>t.id===e);i.current.removeAgent(e),s("Removed ".concat(null!=(t=null==a?void 0:a.name)?t:e),"warning")},[s]),m=(0,r.useCallback)(e=>{if(!i.current)return;i.current.toggleFreeze(e);let t=i.current.agents.find(t=>t.id===e);t&&s("".concat(t.name," ").concat(t.isFrozen?"frozen":"unfrozen"),t.isFrozen?"warning":"info")},[s]),x=(0,r.useCallback)(e=>{if(!i.current)return;i.current.toggleQuarantine(e);let t=i.current.agents.find(t=>t.id===e);t&&s("".concat(t.name," ").concat(t.isQuarantined?"quarantined":"released"),t.isQuarantined?"error":"info")},[s]),v=(0,r.useCallback)(e=>{i.current&&i.current.updateGovernance(e)},[]),b=(0,r.useCallback)(e=>{i.current&&i.current.updatePayoff(e)},[]),w=(0,r.useCallback)(e=>{i.current&&(i.current.injectShock(e),s("Shock: ".concat(e.type.replace(/_/g," ")),"warning"))},[s]),_=(0,r.useCallback)(e=>{if("playing"!==a.levelStatus||!a.currentLevel)return;let t=i.current?i.current.agents.filter(e=>!e.isFrozen).length:0;!function(e,t,a){if(0===t.length)return!1;switch(e.type){case"toxicity_below":if(t.length<e.forEpochs)return!1;return t.slice(-e.forEpochs).every(t=>t.toxicity_rate<e.threshold);case"welfare_above":return t[t.length-1].total_welfare>e.threshold;case"survive_epochs":return t.length>=e.count&&a>=2;case"quality_gap_positive":if(t.length<e.forEpochs)return!1;return t.slice(-e.forEpochs).every(e=>e.quality_gap>0);case"gini_below":if(t.length<e.forEpochs)return!1;return t.slice(-e.forEpochs).every(t=>t.gini_coefficient<e.threshold)}}(a.currentLevel.winCondition,e,t)?function(e,t,a){if(0===t.length)return!1;let n=t[t.length-1];switch(e.type){case"toxicity_above":return n.toxicity_rate>e.threshold;case"welfare_below":return n.total_welfare<e.threshold;case"all_frozen":return 0===a;case"gini_above":return n.gini_coefficient>e.threshold;case"agents_below":return a<e.count}}(a.currentLevel.loseCondition,e,t)&&(o({type:"LEVEL_LOST"}),s("Level Failed","error")):(o({type:"LEVEL_WON"}),s("Level Complete!","success"))},[a.levelStatus,a.currentLevel,s]),S=(0,r.useCallback)(()=>{if(!i.current)return 0;let e=i.current.getEpochSnapshots();if(0===e.length)return 0;let t=Math.max(...e.map(e=>e.toxicity_rate)),a=Math.max(...e.map(e=>e.gini_coefficient));return 30*t+20*a+.5*Math.max(0,-Math.min(...e.map(e=>e.total_welfare)))+5*Math.max(...e.map(e=>e.n_frozen))},[]),k=(0,r.useCallback)(()=>i.current?i.current.serialize():null,[]),T=(0,r.useCallback)(e=>{i.current=y.deserialize(e),o({type:"SET_MODE",mode:"sandbox"}),o({type:"START_LIVE"}),s("Game loaded","info")},[s]);return(0,n.jsx)(M.Provider,{value:{state:a,dispatch:o,engineRef:i,startSandbox:l,startCampaignLevel:c,startRedTeam:d,stopGame:u,togglePause:h,setTickRate:p,spawnAgent:f,removeAgent:g,toggleFreeze:m,toggleQuarantine:x,updateGovernance:v,updatePayoff:b,injectShock:w,checkConditions:_,addToast:s,saveGame:k,loadGame:T,computeRedTeamScore:S},children:t})}function P(){return(0,r.useContext)(M)}var N=a(3235),E=a(1896),F=a(6096);function R(){let{state:e,dispatch:t,agentPositions:a}=(0,r.useContext)(o.X),n=(0,r.useCallback)(e=>t({type:"SET_VIEWPORT",viewport:e}),[t]),i=(0,r.useCallback)((t,a)=>{n(E.e4(e.viewport,t,a))},[e.viewport,n]),s=(0,r.useCallback)((t,a,r)=>{n(E.s_(e.viewport,t,a,r))},[e.viewport,n]),l=(0,r.useCallback)(()=>{if(0===a.current.size)return void n(E.LZ(e.viewport,0,0));let t=1/0,r=1/0,o=-1/0,i=-1/0;for(let e of a.current.values()){let a=(0,F.Gs)(e.gridX,e.gridY);t=Math.min(t,a.x),r=Math.min(r,a.y-100),o=Math.max(o,a.x),i=Math.max(i,a.y+20)}n(E.Fe(e.viewport,t,r,o,i))},[e.viewport,n,a]),c=(0,r.useCallback)((e,a)=>{t({type:"RESIZE",width:e,height:a})},[t]);return{viewport:e.viewport,handlePan:i,handleZoom:s,resetCamera:l,resize:c}}var A=a(8416),I=a(7380);function D(e){let t=parseInt(e.replace("#",""),16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function B(e,t,a){var n;let r=D(e),o=D(t);return n=(0,I.Cc)(r.r,o.r,a),"#"+[n,(0,I.Cc)(r.g,o.g,a),(0,I.Cc)(r.b,o.b,a)].map(e=>(0,I.qE)(Math.round(e),0,255).toString(16).padStart(2,"0")).join("")}function L(e,t){let{r:a,g:n,b:r}=D(e);return"rgba(".concat(a,",").concat(n,",").concat(r,",").concat(t,")")}function z(e){let t=(0,I.qE)(e,0,1);return t<.5?B("#EB5757","#F2C94C",2*t):B("#F2C94C","#27AE60",(t-.5)*2)}let O="/game-app",G=["honest","opportunistic","deceptive","adversarial","rlm","crewai"],W=["tile","tower","spire","node"];class Y{init(){if(!this.initialized){for(let e of(this.initialized=!0,G)){let t=new Image,a={img:t,cleaned:null,loaded:!1};t.onload=()=>{a.cleaned=this.removeBackground(t),a.loaded=!0},t.onerror=()=>{},t.src="".concat(O,"/sprites/").concat(e,"_idle.png"),this.sprites.set(e,a)}for(let e of W){let t=new Image,a={img:t,cleaned:null,loaded:!1};t.onload=()=>{let e=this.removeBackground(t);a.cleaned=this.trimTransparent(e),a.loaded=!0},t.onerror=()=>{},t.src="".concat(O,"/sprites/").concat(e,".png"),this.envSprites.set(e,a)}}}isReady(e){var t;let a=this.sprites.get(e);return null!=(t=null==a?void 0:a.loaded)&&t}removeBackground(e){let t=document.createElement("canvas"),a=e.naturalWidth,n=e.naturalHeight;t.width=a,t.height=n;let r=t.getContext("2d");r.drawImage(e,0,0);let o=r.getImageData(0,0,a,n),i=o.data,s=new Uint8Array(a*n),l=0,c=0,d=0;for(let[e,t]of[[2,2],[a-3,2],[2,n-3],[a-3,n-3]]){let n=(t*a+e)*4;l+=i[n],c+=i[n+1],d+=i[n+2]}l/=4,c/=4,d/=4;let u=e=>{let t=i[e],a=i[e+1],n=i[e+2],r=i[e+3];return!!(0===r||120>Math.sqrt((t-l)**2+(a-c)**2+(n-d)**2))||!!(r<180)},h=[];for(let e=0;e<a;e++)for(let t of[0,n-1]){let n=t*a+e;!s[n]&&u(4*n)&&(h.push(n),s[n]=1)}for(let e=1;e<n-1;e++)for(let t of[0,a-1]){let n=e*a+t;!s[n]&&u(4*n)&&(h.push(n),s[n]=1)}let p=0;for(;p<h.length;){let e=h[p++],t=e%a,r=Math.floor(e/a);for(let o of(i[4*e+3]=0,[r>0?e-a:-1,r<n-1?e+a:-1,t>0?e-1:-1,t<a-1?e+1:-1]))o>=0&&!s[o]&&u(4*o)&&(s[o]=1,h.push(o))}let f=new Uint8Array(a*n);for(let e=0;e<a*n;e++)f[e]=i[4*e+3];for(let e=1;e<n-1;e++)for(let t=1;t<a-1;t++){let n=e*a+t;if(0===f[n])continue;let r=0;0===f[n-1]&&r++,0===f[n+1]&&r++,0===f[n-a]&&r++,0===f[n+a]&&r++,r>=2?i[4*n+3]=Math.round(.5*i[4*n+3]):1===r&&(i[4*n+3]=Math.round(.8*i[4*n+3]))}return r.putImageData(o,0,0),t}trimTransparent(e){let t=e.width,a=e.height,n=e.getContext("2d").getImageData(0,0,t,a).data,r=a,o=0,i=t,s=0;for(let e=0;e<a;e++)for(let a=0;a<t;a++)n[(e*t+a)*4+3]>0&&(e<r&&(r=e),e>o&&(o=e),a<i&&(i=a),a>s&&(s=a));if(r>o||i>s)return e;let l=s-i+1,c=o-r+1,d=document.createElement("canvas");return d.width=l,d.height=c,d.getContext("2d").drawImage(e,i,r,l,c,0,0,l,c),d}draw(e,t,a,n,r,o){let i=this.sprites.get(t);if(!(null==i?void 0:i.loaded)||!i.cleaned)return!1;let s=i.cleaned,l=48*r,c=84*r;return e.save(),o>0&&(e.translate(a,0),e.scale(-1,1),e.translate(-a,0)),e.drawImage(s,0,0,s.width,s.height,a-l/2,n-c,l,c),e.restore(),!0}drawTile(e,t,a,n,r){let o=this.envSprites.get("tile");if(!(null==o?void 0:o.loaded)||!o.cleaned)return!1;let i=o.cleaned;return e.drawImage(i,0,0,i.width,i.height,t-n/2,a-r/2,n,r),!0}drawBuilding(e,t,a,n,r,o){let i=this.envSprites.get(t);if(!(null==i?void 0:i.loaded)||!i.cleaned)return!1;let s=i.cleaned;return e.drawImage(s,0,0,s.width,s.height,a-r/2,n-o,r,o),!0}constructor(){this.sprites=new Map,this.envSprites=new Map,this.initialized=!1}}let q=new Y;q.init();let X={honest:"#4AE8A0",opportunistic:"#F5C84C",deceptive:"#D084F5",adversarial:"#FF6B6B",rlm:"#5BC8FF",crewai:"#7BF590"},V={honest:"#FFD966",opportunistic:"#FFB347",deceptive:"#FF80FF",adversarial:"#FF4444",rlm:"#80D4FF",crewai:"#FFEE80"};function H(e,t,a,n,r,o){let i=A.Cw.baseWidth*o,s=A.Cw.baseHeight*o,l=i/2,c=a-s,d=.36*l,u=c+d+.03*s,h=c+.26*s;switch(n){case"honest":var p,f,g,m,x,v=e,b=t,y=u,w=d,_=r;let S=y-1.4*w,k=.2*Math.sin(.003*Date.now());v.strokeStyle=L(_.accent,.25+k),v.lineWidth=4,v.beginPath(),v.ellipse(b,S,.9*w,.28*w,0,0,2*Math.PI),v.stroke(),v.strokeStyle=L(_.accent,.6+k),v.lineWidth=1.5,v.beginPath(),v.ellipse(b,S,.9*w,.28*w,0,0,2*Math.PI),v.stroke();break;case"opportunistic":!function(e,t,a,n,r,o,i){let s=.002*Date.now(),l=(o+a)*.5;for(let a=0;a<4;a++){let r=s+2*Math.PI/4*a,o=t+Math.cos(r)*n*.8,c=l+Math.sin(r)*n*.3,d=.5+.2*Math.sin(s+a);e.fillStyle=L(i.accent,.3*d),e.beginPath(),e.arc(o,c,4,0,2*Math.PI),e.fill(),e.fillStyle=L(i.accent,d),e.beginPath(),e.arc(o,c,2,0,2*Math.PI),e.fill()}}(e,t,a,l,0,h,r);break;case"deceptive":p=e,f=t,g=u,m=d,p.strokeStyle=L((x=r).accent,.5),p.lineWidth=1.2,p.beginPath(),p.moveTo(f-.75*m,g-.2*m),p.quadraticCurveTo(f,g-.5*m,f+.75*m,g-.2*m),p.lineTo(f+.55*m,g+.18*m),p.quadraticCurveTo(f,g+.12*m,f-.55*m,g+.18*m),p.closePath(),p.stroke(),p.fillStyle=L(x.secondary,.08),p.fill();break;case"adversarial":var j=e,C=t,M=u,T=d,P=h,N=l,E=r;j.lineWidth=2;let F=j.createLinearGradient(C-.6*T,M,C-1.2*T,M-1.8*T);F.addColorStop(0,L(E.secondary,.3)),F.addColorStop(1,L(E.secondary,.9)),j.strokeStyle=F,j.beginPath(),j.moveTo(C-.6*T,M-.5*T),j.lineTo(C-1.2*T,M-1.8*T),j.stroke();let R=j.createLinearGradient(C+.6*T,M,C+1.2*T,M-1.8*T);R.addColorStop(0,L(E.secondary,.3)),R.addColorStop(1,L(E.secondary,.9)),j.strokeStyle=R,j.beginPath(),j.moveTo(C+.6*T,M-.5*T),j.lineTo(C+1.2*T,M-1.8*T),j.stroke(),j.fillStyle=L(E.secondary,.9),j.beginPath(),j.arc(C-1.2*T,M-1.8*T,2,0,2*Math.PI),j.fill(),j.beginPath(),j.arc(C+1.2*T,M-1.8*T,2,0,2*Math.PI),j.fill(),j.strokeStyle=L(E.accent,.5),j.lineWidth=1.2,j.beginPath(),j.moveTo(C-.5*N,P),j.lineTo(C-.75*N,P-.35*N),j.stroke(),j.beginPath(),j.moveTo(C+.5*N,P),j.lineTo(C+.75*N,P-.35*N),j.stroke();break;case"rlm":var I=e,D=t,B=u,z=d,O=h,G=l,W=s,Y=r;I.strokeStyle=L(Y.accent,.7),I.lineWidth=1.5,I.beginPath(),I.moveTo(D,B-z),I.lineTo(D,B-2*z),I.stroke();let q=.4*Math.sin(.005*Date.now())+.6;I.fillStyle=L(Y.accent,q),I.beginPath(),I.arc(D,B-2*z,2.5,0,2*Math.PI),I.fill(),I.strokeStyle=L(Y.accent,.3*q),I.lineWidth=3,I.beginPath(),I.arc(D,B-2*z,5,0,2*Math.PI),I.stroke(),I.strokeStyle=L(Y.accent,.5),I.lineWidth=1,I.beginPath(),I.rect(D-.7*z,B-.12*z,1.4*z,.24*z),I.stroke(),I.fillStyle=L(Y.secondary,.12),I.fill(),I.strokeStyle=L(Y.accent,.3),I.lineWidth=.7;let X=O+.12*W;I.beginPath(),I.moveTo(D-.35*G,X),I.lineTo(D+.35*G,X),I.moveTo(D-.15*G,X),I.lineTo(D-.15*G,X+.08*W),I.moveTo(D+.15*G,X),I.lineTo(D+.15*G,X+.08*W),I.moveTo(D,X),I.lineTo(D,X+.1*W),I.stroke(),I.fillStyle=L(Y.accent,.6),I.beginPath(),I.arc(D-.15*G,X+.08*W,1.5,0,2*Math.PI),I.fill(),I.beginPath(),I.arc(D+.15*G,X+.08*W,1.5,0,2*Math.PI),I.fill(),I.beginPath(),I.arc(D,X+.1*W,1.5,0,2*Math.PI),I.fill();break;case"crewai":var V=e,H=t,K=u,U=d,Q=h,Z=l,J=s,$=r;V.strokeStyle=L($.accent,.6),V.lineWidth=1.5,V.beginPath(),V.arc(H,K-.2*U,1.1*U,Math.PI,0),V.stroke(),V.beginPath(),V.moveTo(H-1.3*U,K-.2*U),V.lineTo(H+1.3*U,K-.2*U),V.stroke();let ee=Q+.25*J;V.strokeStyle=L($.accent,.45),V.lineWidth=1.2,V.beginPath(),V.moveTo(H-.4*Z,ee),V.lineTo(H+.4*Z,ee),V.stroke(),V.fillStyle=L($.accent,.7),V.beginPath(),V.arc(H,ee,2,0,2*Math.PI),V.fill(),V.fillStyle=L($.accent,.4),V.beginPath(),V.arc(H-.2*Z,ee,1.2,0,2*Math.PI),V.fill(),V.beginPath(),V.arc(H+.2*Z,ee,1.2,0,2*Math.PI),V.fill()}}var K=a(6620);function U(e,t,a,n,r,o,i){let s=1-i;return{x:s*s*e+2*s*i*a+i*i*r,y:s*s*t+2*s*i*n+i*i*o}}function Q(e,t,a){let n=e=>{let t=e.replace("#","");return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]},[r,o,i]=n(e),[s,l,c]=n(t),d=Math.round(r+(s-r)*a),u=Math.round(o+(l-o)*a),h=Math.round(i+(c-i)*a);return"rgb(".concat(d,",").concat(u,",").concat(h,")")}function Z(e,t,a){let n=[];for(let r=0;r<a;r++){let a=.2*Math.sin(Date.now()/2e3);n.push({x:e+(Math.random()-.5)*30,y:t-40*Math.random(),vx:(Math.random()-.5)*.3+a,vy:.5*Math.random()+.2,life:1e3+500*Math.random(),maxLife:1500,size:2+2*Math.random(),color:"#A8CFF5",alpha:.7})}return n}function J(e,t,a){let n=[];for(let r=0;r<a;r++){let a=Math.random()*Math.PI*2,r=20+15*Math.random();n.push({x:e+Math.cos(a)*r,y:t+Math.sin(a)*r*.5,vx:.2*Math.cos(a),vy:-(.5*Math.random())-.3,life:800+400*Math.random(),maxLife:1200,size:1.5+Math.random(),color:"#EB5757",alpha:.5})}return n}function $(e){let t=Math.ceil(e/18),a=[];for(let e=0;e<t;e++){let t=8+Math.floor(14*Math.random()),n=[];for(let e=0;e<t;e++)n.push((0,K.P6)());let r=(Math.random()-.5)*6;a.push({x:18*e+9+r,speed:.02+.1*Math.random(),chars:n,headY:-500*Math.random(),charInterval:18+(Math.random()-.5)*4,brightness:.6+.4*Math.random(),nextMutateTime:50+150*Math.random()})}return{columns:a,initialized:!0}}function ee(e,t,a,n){for(let r of e.columns){let e=1+.6*n;r.headY+=r.speed*t*e;let o=r.chars.length*r.charInterval;if(r.headY-o>a&&(r.headY=-200*Math.random()-50,r.speed=.02+.1*Math.random(),.3>Math.random())){let e=8+Math.floor(14*Math.random());for(;r.chars.length<e;)r.chars.push((0,K.P6)());r.chars.length>e&&(r.chars.length=e)}if(r.nextMutateTime-=t,r.nextMutateTime<=0){let e=Math.floor(Math.random()*r.chars.length);r.chars[e]=(0,K.P6)(),r.nextMutateTime=50+150*Math.random()}}}function et(e){let t=0|e;return()=>{let e=Math.imul((t=t+0x6d2b79f5|0)^t>>>15,1|t);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000}}let ea=null,en=-1,er=[{label:"Posts",color:A.lm.info,getValue:e=>e.total_posts,offsetX:-18},{label:"Votes",color:A.lm.secondary,getValue:e=>e.total_votes,offsetX:0},{label:"Tasks",color:A.lm.accent,getValue:e=>e.total_tasks_completed,offsetX:18}];function eo(){let e=(0,r.useRef)(null),{agents:t,arcs:a,viewport:o,hoveredAgent:i,selectedAgent:s,currentEpochSnap:l,environment:c,overlays:d,particles:u,gridSize:h,setHovered:p,setSelected:f,codeTrailSystem:g,digitalRainRef:m,recompileStateRef:x}=(0,N.$)(),{handlePan:v,handleZoom:b,resetCamera:y,resize:w}=R(),_=(0,r.useRef)(!1),S=(0,r.useRef)({x:0,y:0});(0,r.useEffect)(()=>{let t=e.current;if(!t)return;let a=t.parentElement;if(!a)return;let n=new ResizeObserver(e=>{for(let a of e){let{width:e,height:n}=a.contentRect;t.width=e*devicePixelRatio,t.height=n*devicePixelRatio,t.style.width=e+"px",t.style.height=n+"px",w(e,n)}});return n.observe(a),()=>n.disconnect()},[w]),(0,r.useEffect)(()=>{let n=e.current;if(!n)return;let r=n.getContext("2d");r&&(r.save(),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.scale(devicePixelRatio,devicePixelRatio),function(e,t){let a=t.viewport.width,n=t.viewport.height;e.clearRect(0,0,a,n),function(e,t,a,n){let r=e.createLinearGradient(0,0,0,.7*a),o=Math.min(1,Math.max(0,n)),i=Q("#0D1117","#3D1020",o),s=Q("#0D1117","#1A0A10",.7*o);r.addColorStop(0,i),r.addColorStop(1,s),e.fillStyle=r,e.fillRect(0,0,t,a),o>.6&&(e.fillStyle=L("#EB5757",(o-.6)*.15*(.5*Math.sin(Date.now()/200)+.5)),e.fillRect(0,0,t,.3*a))}(e,a,n,t.environment.threatLevel),t.overlays.digitalRain&&t.digitalRain&&function(e,t,a,n,r){e.save(),e.font=K.C4,e.textAlign="center";let o=(0,I.qE)(r,0,1),i=Math.max(0,.4-.4*o);for(let a=0;a<t.columns.length;a++){if(i>0&&7*a%10/10<i)continue;let r=t.columns[a],s=r.chars;for(let t=0;t<s.length;t++){let a=r.headY-t*r.charInterval;if(a<-20||a>n+20)continue;let i=0===t,l=1-t/s.length,c=l*l;if(i)e.fillStyle=o>.5?"rgba(255,".concat(Math.round(180-100*o),",").concat(Math.round(80-60*o),",").concat(.95*r.brightness,")"):"rgba(200,255,220,".concat(.9*r.brightness,")");else{let t=c*r.brightness*.6;if(o>.3){let a=(o-.3)/.7,n=Math.round(200*a),r=Math.round(255*(1-.5*a));e.fillStyle="rgba(".concat(n,",").concat(r,",65,").concat(t,")")}else e.fillStyle=(0,K.Hw)(t)}e.fillText(s[t],r.x,a)}}e.restore()}(e,t.digitalRain,0,n,t.environment.threatLevel),e.save(),e.translate(t.viewport.x,t.viewport.y),e.scale(t.viewport.zoom,t.viewport.zoom);let r=t.environment.reputationStd+t.environment.payoffStd;if(!function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let r=0;r<t;r++)for(let o=0;o<t;o++)!function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,{x:o,y:i}=(0,F.Gs)(t,a),s=A.KP/2,l=A.VM/2,c=n>.3,d=n>.5?"#EB5757":A.lm.accent,u=q.drawTile(e,o,i,A.KP,A.VM);if(!u){(0,F.pU)(e,o,i,A.KP,A.VM);let t=e.createLinearGradient(o-s,i,o+s,i);if(c){let e=.12*n;t.addColorStop(0,"rgba(".concat(Math.round(20+200*e),", ").concat(Math.round(8),", ").concat(Math.round(14+30*e),", 0.92)")),t.addColorStop(1,"rgba(".concat(Math.round(12+150*e),", ").concat(Math.round(6),", ").concat(Math.round(10+20*e),", 0.92)"))}else t.addColorStop(0,"rgba(10, 14, 22, 0.92)"),t.addColorStop(1,"rgba(6, 10, 16, 0.92)");e.fillStyle=t,e.fill(),(0,F.pU)(e,o,i,A.KP,A.VM),e.strokeStyle=L(d,c?.18:.35),e.lineWidth=.6,e.stroke();let a=c?.1:.2;e.strokeStyle=L(d,a),e.lineWidth=.4,e.beginPath(),e.moveTo(o-.5*s,i),e.lineTo(o+.5*s,i),e.stroke(),e.beginPath(),e.moveTo(o,i-.5*l),e.lineTo(o,i+.5*l),e.stroke(),e.strokeStyle=L(d,.6*a),e.lineWidth=.3,(0,F.pU)(e,o,i,.5*A.KP,.5*A.VM),e.stroke(),e.strokeStyle=L(d,.4*a),e.lineWidth=.3,e.beginPath(),e.moveTo(o-.25*s,i-.25*l),e.lineTo(o-.6*s,i-.1*l),e.stroke(),e.beginPath(),e.moveTo(o+.25*s,i-.25*l),e.lineTo(o+.6*s,i-.1*l),e.stroke(),e.beginPath(),e.moveTo(o-.25*s,i+.25*l),e.lineTo(o-.6*s,i+.1*l),e.stroke(),e.beginPath(),e.moveTo(o+.25*s,i+.25*l),e.lineTo(o+.6*s,i+.1*l),e.stroke();let r=c?.2:.4;e.fillStyle=L(d,r),e.beginPath(),e.arc(o,i,1.2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o,i-.5*l,.96,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o,i+.5*l,.96,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o-.5*s,i,.96,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o+.5*s,i,.96,0,2*Math.PI),e.fill(),e.fillStyle=L(d,.6*r);e.beginPath(),e.arc(o,i-.25*l,.72,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o,i+.25*l,.72,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o-.25*s,i,.72,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o+.25*s,i,.72,0,2*Math.PI),e.fill()}if(c&&u&&((0,F.pU)(e,o,i,A.KP,A.VM),e.fillStyle=L("#EB5757",.15*n),e.fill()),r>.1){let t=Math.min((r-.1)/.8,1);(0,F.pU)(e,o,i,A.KP,A.VM),e.fillStyle=L(t>.5?"#BB6BD9":"#F2994A",.08*t),e.fill()}}(e,r,o,a,n)}(e,t.gridSize,t.environment.toxicity,r),!function(e,t,a){let n;if(a<.2)return;let r=Math.min((a-.2)/.6,1),o=Math.floor(8*r)+1;e.save(),e.strokeStyle=L("#EB5757",.4*r),e.lineWidth=1;let i=(n=42,()=>{let e=Math.imul((n=n+0x6d2b79f5|0)^n>>>15,1|n);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000});for(let a=0;a<o;a++){let a=i()*t,n=i()*t,{x:r,y:o}=(0,F.Gs)(a,n);e.beginPath(),e.moveTo(r,o);let s=r,l=o,c=3+Math.floor(4*i());for(let t=0;t<c;t++)s+=(i()-.5)*40,l+=(i()-.5)*28,e.lineTo(s,l);e.stroke()}e.restore()}(e,t.gridSize,t.environment.giniCoefficient),t.overlays.networkWeb&&function(e,t,a,n){if(a<.5||t.length<2)return;let r=Math.round(a),o=t.map(e=>{let t=(0,F.Gs)(e.gridX,e.gridY);return{x:t.x+e.walkOffsetX,y:t.y+e.walkOffsetY}}),i=(e,t)=>{let a=o[e].x-o[t].x,n=o[e].y-o[t].y;return a*a+n*n},s=new Set,l=t.map(()=>new Set);for(let e=0;e<t.length;e++){let a=[];for(let n=0;n<t.length;n++)e!==n&&a.push({idx:n,d:i(e,n)});a.sort((e,t)=>e.d-t.d);let n=Math.min(r,a.length);for(let t=0;t<n;t++){let n=a[t].idx,r=e<n?"".concat(e,":").concat(n):"".concat(n,":").concat(e);s.add(r),l[e].add(n),l[n].add(e)}}let c=.15+.45*n;for(let t of(e.save(),e.strokeStyle=L(A.lm.accent,c),e.lineWidth=1.2,e.setLineDash([4,6]),s)){let[a,n]=t.split(":"),r=Number(a),i=Number(n);e.beginPath(),e.moveTo(o[r].x,o[r].y),e.lineTo(o[i].x,o[i].y),e.stroke()}if(e.setLineDash([]),n>.5){e.fillStyle=L(A.lm.accent,(n-.5)*.12);let t=new Set;for(let a of s){let[n,r]=a.split(":"),i=Number(n),s=Number(r);for(let a of l[i])if(a!==s&&l[s].has(a)){let n=[i,s,a].sort((e,t)=>e-t),r=n.join(":");if(t.has(r))continue;t.add(r),e.beginPath(),e.moveTo(o[n[0]].x,o[n[0]].y),e.lineTo(o[n[1]].x,o[n[1]].y),e.lineTo(o[n[2]].x,o[n[2]].y),e.closePath(),e.fill()}}}for(let t of(e.fillStyle=L(A.lm.accent,c+.15),e.strokeStyle=L(A.lm.accent,c+.25),e.lineWidth=.8,o))e.beginPath(),e.moveTo(t.x,t.y-3),e.lineTo(t.x+3,t.y),e.lineTo(t.x,t.y+3),e.lineTo(t.x-3,t.y),e.closePath(),e.fill(),e.stroke();e.restore()}(e,t.agents,t.environment.avgDegree,t.environment.avgClustering),t.overlays.threatZones){for(let a of t.agents)if("adversarial"===a.agentType||"deceptive"===a.agentType){let n=(0,F.Gs)(a.gridX,a.gridY);!function(e,t,a,n,r){if(n<.2)return;let o=.7+.3*Math.sin(2*(Date.now()/1e3)),i=30+20*n,s="adversarial"===r?"#EB5757":"#BB6BD9",l=e.createRadialGradient(t,a,0,t,a,i*o);l.addColorStop(0,L(s,.15*n)),l.addColorStop(.6,L(s,.08*n)),l.addColorStop(1,L(s,0)),e.fillStyle=l,e.beginPath(),e.arc(t,a,i*o,0,2*Math.PI),e.fill()}(e,n.x,n.y,t.environment.threatLevel,a.agentType),function(e,t,a,n,r,o){if(n<1)return;let i=Date.now()/1e3,s=Math.min(Math.floor(n),5),l=.8+.3*Math.min(r,5),c="adversarial"===o?"#EB5757":"#BB6BD9";e.save(),e.lineWidth=1;for(let n=0;n<s;n++){let r=(i*l+.6*n)%2;if(r>1)continue;let o=20+40*r*(1+.3*n),s=(1-r)*.25;e.beginPath(),e.ellipse(t,a,o,.5*o,0,0,2*Math.PI),e.strokeStyle=L(c,s),e.stroke()}e.restore()}(e,n.x,n.y,t.environment.contagionDepth,t.environment.activeThreats,a.agentType)}}t.codeTrails.length>0&&function(e,t){if(0!==t.length){for(let a of(e.save(),e.textAlign="center",t))a.alpha<=0||(e.font="bold ".concat(a.fontSize,"px 'Courier New', monospace"),e.fillStyle=a.color.replace(/[\d.]+\)$/,"".concat(a.alpha,")")),e.fillText(a.char,a.x,a.y));e.restore()}}(e,t.codeTrails);let o=[],i=new Map(t.agents.map(e=>[e.id,e])),s=t.recompileState;for(let e of t.agents)if(o.push(function(e,t){return{depth:e.gridX+e.gridY,render:a=>(function(e,t,a){var n,r,o;let i=(0,F.Gs)(t.gridX,t.gridY),s=i.x+t.walkOffsetX,l=i.y+t.walkOffsetY,c=A.FJ[t.agentType],d=t.scale;e.save(),function(e,t,a,n,r){if(n<=0)return;let o=(0,I.Ew)(n,0,200,0,30);if(o<=2)return;let i=e.createRadialGradient(t,a,0,t,a,A.KP/2+o);i.addColorStop(0,L(r.secondary,.3)),i.addColorStop(1,L(r.secondary,0)),e.fillStyle=i,e.beginPath(),e.ellipse(t,a,A.KP/2+o,A.VM/2+o/2,0,0,2*Math.PI),e.fill()}(e,s,l,t.resources,c),function(e,t,a,n,r,o){if(.5>=Math.abs(n))return;let i=A.Cw.baseHeight*r,s=n>0,l=(0,I.qE)(Math.abs(n)/10,0,.5),c=s?"#F2C94C":"#1A1A2E",d=a-.5*i,u=.8*A.KP,h=e.createRadialGradient(t,d,0,t,d,u);h.addColorStop(0,L(c,l)),h.addColorStop(1,L(c,0)),e.fillStyle=h,e.beginPath(),e.ellipse(t,d,u,.6*u,0,0,2*Math.PI),e.fill()}(e,s,l,t.totalPayoff,d,0),t.isQuarantined&&(n=e,r=s,o=l,n.strokeStyle=L("#EB5757",.6+.3*Math.sin(Date.now()/300)),n.lineWidth=2,n.setLineDash([6,4]),n.beginPath(),n.ellipse(r,o,.6*A.KP,.6*A.VM,0,0,2*Math.PI),n.stroke(),n.setLineDash([]));let u=Math.sqrt(t.walkOffsetX**2+t.walkOffsetY**2),h=u>.5,p=t.facing,f=A.Zu[t.agentType],g=0;if(h){let e=Math.min(1,u/80),a=Math.sin(2*t.walkPhase);g=Math.abs(a+f.bobAsymmetry*a*a)*f.bobAmplitude*d*e}else g=f.idleBob*Math.sin(.0012*Date.now())*d;if(q.draw(e,t.agentType,s,l-g,d,p)){let a=l-g;e.save(),e.translate(s,0),e.scale(p,1),e.translate(-s,0),H(e,s,a,t.agentType,c,d),e.restore()}else e.save(),e.translate(s,0),e.scale(p,1),e.translate(-s,0),function(e,t,a,n,r,o){let i,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=A.Zu[n],u=A.Cw.baseWidth*o,h=A.Cw.baseHeight*o,p=u/2,f=Math.min(1,c/80);if(l){let e=Math.sin(2*s);i=Math.abs(e+d.bobAsymmetry*e*e)*d.bobAmplitude*o*f}else i=d.idleBob*Math.sin(.0012*Date.now())*o;let g=a-i-h,m=g+.22*h,x=g+.26*h,v=g+.38*h,b=g+.52*h,y=g+.58*h,w=g+.78*h,_=a-.04*h,S=l?Math.sin(s)*p*.14*d.legSwingScale*f:0,k=l?-(.18*Math.sin(s))*d.armSwingScale*f:0,j=Date.now(),C=e.createRadialGradient(t,a+3,0,t,a+3,1.2*p);C.addColorStop(0,L(r.secondary,.22)),C.addColorStop(.5,L(r.secondary,.08)),C.addColorStop(1,L(r.secondary,0)),e.fillStyle=C,e.beginPath(),e.ellipse(t,a+3,+p,.28*p,0,0,2*Math.PI),e.fill();let M=e.createLinearGradient(t-.25*p,y,t-.15*p,a);M.addColorStop(0,"#0E0E18"),M.addColorStop(.5,"#0A0A12"),M.addColorStop(1,"#060610"),e.fillStyle=M,e.beginPath(),e.moveTo(t-.22*p,y),e.quadraticCurveTo(t-.28*p,w,t-.3*p+S,a),e.lineTo(t-.02*p+S,a),e.quadraticCurveTo(t-.04*p,w,t-.02*p,y),e.closePath(),e.fill(),e.strokeStyle=L(r.secondary,.12),e.lineWidth=.6,e.beginPath(),e.moveTo(t-.22*p,y),e.quadraticCurveTo(t-.28*p,w,t-.3*p+S,a),e.stroke(),e.fillStyle="#060610",e.beginPath(),e.moveTo(t+.02*p,y),e.quadraticCurveTo(t+.04*p,w,t+.02*p-S,a),e.lineTo(t+.3*p-S,a),e.quadraticCurveTo(t+.28*p,w,t+.22*p,y),e.closePath(),e.fill(),e.fillStyle=L(r.secondary,.2),e.beginPath(),e.ellipse(t-.15*p+S,a-1,.16*p,2,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(t+.15*p-S,a-1,.16*p,2,0,0,2*Math.PI),e.fill();let T=e.createLinearGradient(t-.35*p,x,t+.35*p,b);T.addColorStop(0,"#10101A"),T.addColorStop(.5,"#0A0A14"),T.addColorStop(1,"#060610"),e.fillStyle=T,e.beginPath(),e.moveTo(t-.38*p,x),e.lineTo(t+.38*p,x),e.lineTo(t+.28*p,b),e.quadraticCurveTo(t,b+2,t-.28*p,b),e.closePath(),e.fill();let P=Math.sin(.002*j+.01*t)*p*.05,N=Math.sin(.004*j+.02*t)*p*.02,E=e.createLinearGradient(t,x-4,t,_);E.addColorStop(0,L(r.secondary,.4)),E.addColorStop(.3,L(r.secondary,.3)),E.addColorStop(.7,L(r.secondary,.2)),E.addColorStop(1,L(r.secondary,.08)),e.fillStyle=E,e.beginPath(),e.moveTo(t-.48*p,x-2),e.lineTo(t+.48*p,x-2),e.quadraticCurveTo(t+.9*p+P,v,t+.85*p+P,b),e.quadraticCurveTo(t+.88*p+P+N,y,t+.82*p+P,_),e.lineTo(t-.82*p-P,_),e.quadraticCurveTo(t-.88*p-P-N,y,t-.85*p-P,b),e.quadraticCurveTo(t-.9*p-P,v,t-.48*p,x-2),e.closePath(),e.fill();let F=e.createLinearGradient(t,x,t,_);F.addColorStop(0,L(r.primary,.2)),F.addColorStop(1,L(r.primary,.05)),e.fillStyle=F,e.beginPath(),e.moveTo(t-.1*p,x+.06*h),e.lineTo(t+.1*p,x+.06*h),e.lineTo(t+.25*p+.5*P,_),e.lineTo(t-.25*p-.5*P,_),e.closePath(),e.fill(),e.fillStyle=L(r.secondary,.5),e.beginPath(),e.moveTo(t-.38*p,x-4),e.quadraticCurveTo(t-.45*p,x-6,t-.42*p,m),e.lineTo(t-.2*p,m+2),e.lineTo(t-.28*p,x-2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(t+.38*p,x-4),e.quadraticCurveTo(t+.45*p,x-6,t+.42*p,m),e.lineTo(t+.2*p,m+2),e.lineTo(t+.28*p,x-2),e.closePath(),e.fill(),e.lineWidth=1.4,e.strokeStyle=L(r.secondary,.55),e.beginPath(),e.moveTo(t-.48*p,x-2),e.quadraticCurveTo(t-.9*p-P,v,t-.85*p-P,b),e.quadraticCurveTo(t-.88*p-P,y,t-.82*p-P,_),e.stroke(),e.beginPath(),e.moveTo(t+.48*p,x-2),e.quadraticCurveTo(t+.9*p+P,v,t+.85*p+P,b),e.quadraticCurveTo(t+.88*p+P,y,t+.82*p+P,_),e.stroke(),e.lineWidth=.8,e.strokeStyle=L(r.secondary,.3),e.beginPath(),e.moveTo(t-.82*p-P,_),e.lineTo(t+.82*p+P,_),e.stroke(),e.strokeStyle=L(r.secondary,.35),e.lineWidth=.6,e.beginPath(),e.moveTo(t,x+.04*h),e.lineTo(t,_),e.stroke(),e.lineWidth=.5,e.strokeStyle=L(r.secondary,.25),e.beginPath(),e.moveTo(t-.05*p,x+.04*h),e.lineTo(t-.15*p,v),e.stroke(),e.beginPath(),e.moveTo(t+.05*p,x+.04*h),e.lineTo(t+.15*p,v),e.stroke(),e.strokeStyle=L(r.secondary,.1),e.lineWidth=.4;let R=.04*h,I=.001*j;for(let a=x+R;a<_;a+=R){let n=(a-x)/(_-x),o=.02*Math.sin(I+6*n),i=p*(.48+.34*n+o),s=.06+.04*Math.sin(.005*j+10*n);e.strokeStyle=L(r.secondary,s),e.beginPath(),e.moveTo(t-i,a),e.lineTo(t+i,a),e.stroke()}e.save();let D=.002*j;for(let a=0;a<6;a++){let n=(.8*D+1.3*a)%2.5;if(n>1)continue;let i=x+(.19*a+.07*D)%1*(_-x),s=t+Math.sin(2.7*a+.0015*j)*p*.5,l=(1+.5*Math.sin(3.1*a+.003*j))*o;e.globalAlpha=.7*Math.sin(n*Math.PI),e.fillStyle=r.accent,e.beginPath(),e.arc(s,i,l,0,2*Math.PI),e.fill()}e.globalAlpha=1,e.restore();let B=t+.72*p-k*p,z=x+.26*h,O=e.createLinearGradient(t+.45*p,x,B,z);O.addColorStop(0,L(r.secondary,.3)),O.addColorStop(1,L(r.secondary,.15)),e.fillStyle=O,e.beginPath(),e.moveTo(t+.45*p,x),e.quadraticCurveTo(t+.6*p,x+.1*h,B,z),e.lineTo(B-.12*p,z+.02*h),e.quadraticCurveTo(t+.5*p,x+.12*h,t+.35*p,x+.04*h),e.closePath(),e.fill(),e.strokeStyle=L(r.secondary,.3),e.lineWidth=.7,e.beginPath(),e.moveTo(t+.45*p,x),e.quadraticCurveTo(t+.6*p,x+.1*h,B,z),e.stroke();let G=e.createRadialGradient(B-.06*p,z,0,B-.06*p,z,4*o);G.addColorStop(0,L(V[n],.7)),G.addColorStop(1,L(V[n],0)),e.fillStyle=G,e.beginPath(),e.arc(B-.06*p,z,4*o,0,2*Math.PI),e.fill(),e.fillStyle=L(V[n],.8),e.beginPath(),e.arc(B-.06*p,z,1.8*o,0,2*Math.PI),e.fill();let W=t-.72*p+k*p,Y=x+.26*h,q=e.createLinearGradient(t-.45*p,x,W,Y);q.addColorStop(0,L(r.secondary,.35)),q.addColorStop(1,L(r.secondary,.18)),e.fillStyle=q,e.beginPath(),e.moveTo(t-.45*p,x),e.quadraticCurveTo(t-.6*p,x+.1*h,W,Y),e.lineTo(W+.12*p,Y+.02*h),e.quadraticCurveTo(t-.5*p,x+.12*h,t-.35*p,x+.04*h),e.closePath(),e.fill(),e.strokeStyle=L(r.secondary,.35),e.lineWidth=.7,e.beginPath(),e.moveTo(t-.45*p,x),e.quadraticCurveTo(t-.6*p,x+.1*h,W,Y),e.stroke();let H=e.createRadialGradient(W+.06*p,Y,0,W+.06*p,Y,4*o);H.addColorStop(0,L(V[n],.7)),H.addColorStop(1,L(V[n],0)),e.fillStyle=H,e.beginPath(),e.arc(W+.06*p,Y,4*o,0,2*Math.PI),e.fill(),e.fillStyle=L(V[n],.8),e.beginPath(),e.arc(W+.06*p,Y,1.8*o,0,2*Math.PI),e.fill(),e.fillStyle="#0A0A12",e.beginPath(),e.rect(t-.1*p,m,.2*p,x-m+2),e.fill();let K=.36*p,U=g+K+.03*h,Q=e.createRadialGradient(t-.3*K,U-.2*K,.1*K,t,U,K);Q.addColorStop(0,"#14141E"),Q.addColorStop(.7,"#0A0A14"),Q.addColorStop(1,"#06060E"),e.fillStyle=Q,e.beginPath(),e.arc(t,U,K,0,2*Math.PI),e.fill();let Z=X[n],J=function(e,t){let a=e.replace("#",""),n=Math.max(0,parseInt(a.substring(0,2),16)-60),r=Math.max(0,parseInt(a.substring(2,4),16)-60),o=Math.max(0,parseInt(a.substring(4,6),16)-t);return"rgb(".concat(n,",").concat(r,",").concat(o,")")}(Z,60),$=e.createRadialGradient(t-.2*K,U-.5*K,.2*K,t,U-.2*K,1.15*K);$.addColorStop(0,Z),$.addColorStop(.7,Z),$.addColorStop(1,J),e.fillStyle=$,e.beginPath(),e.arc(t,U-.12*K,1.08*K,1.05*Math.PI,-.05*Math.PI),e.closePath(),e.fill(),e.fillStyle=J,e.beginPath(),e.moveTo(t-1.08*K,U-.12*K),e.quadraticCurveTo(t-1.12*K,U+.2*K,t-K,U+.55*K),e.quadraticCurveTo(t-.85*K,U+.7*K,t-.65*K,U+.65*K),e.lineTo(t-.88*K,U),e.closePath(),e.fill(),e.beginPath(),e.moveTo(t+1.08*K,U-.12*K),e.quadraticCurveTo(t+1.12*K,U+.2*K,t+ +K,U+.55*K),e.quadraticCurveTo(t+.85*K,U+.7*K,t+.65*K,U+.65*K),e.lineTo(t+.88*K,U),e.closePath(),e.fill(),e.fillStyle=Z,e.beginPath(),e.moveTo(t-1.06*K,U-.1*K),e.quadraticCurveTo(t-1.08*K,U+.1*K,t-.98*K,U+.45*K),e.lineTo(t-.9*K,U+.1*K),e.closePath(),e.fill(),e.fillStyle=L("#FFFFFF",.2),e.beginPath(),e.ellipse(t-.15*K,U-.55*K,.5*K,.12*K,-.2,0,2*Math.PI),e.fill();let ee=e.createRadialGradient(t,U-.3*K,0,t,U-.3*K,1.8*K);ee.addColorStop(0,L(Z,.25)),ee.addColorStop(1,L(Z,0)),e.fillStyle=ee,e.beginPath(),e.arc(t,U-.3*K,1.8*K,0,2*Math.PI),e.fill();let et=V[n],ea=U+.08*K,en=.36*K,er=.2*K,eo=.16*K,ei=e.createRadialGradient(t,ea,0,t,ea,.9*K);ei.addColorStop(0,L(et,.2)),ei.addColorStop(1,L(et,0)),e.fillStyle=ei,e.beginPath(),e.arc(t,ea,.9*K,0,2*Math.PI),e.fill();let es=e.createRadialGradient(t-en,ea,.2*er,t-en,ea,er);es.addColorStop(0,"#FFFFFF"),es.addColorStop(.3,et),es.addColorStop(1,L(et,.6)),e.fillStyle=es,e.beginPath(),e.ellipse(t-en,ea,er,eo,0,0,2*Math.PI),e.fill(),e.strokeStyle=L(et,.5),e.lineWidth=.6,e.beginPath(),e.ellipse(t-en,ea,1.3*er,1.3*eo,0,0,2*Math.PI),e.stroke();let el=e.createRadialGradient(t+en,ea,.2*er,t+en,ea,er);el.addColorStop(0,"#FFFFFF"),el.addColorStop(.3,et),el.addColorStop(1,L(et,.6)),e.fillStyle=el,e.beginPath(),e.ellipse(t+en,ea,er,eo,0,0,2*Math.PI),e.fill(),e.strokeStyle=L(et,.5),e.lineWidth=.6,e.beginPath(),e.ellipse(t+en,ea,1.3*er,1.3*eo,0,0,2*Math.PI),e.stroke(),e.strokeStyle=L(et,.35),e.lineWidth=.8,e.beginPath(),e.arc(t,ea+.28*K,.22*K,.15*Math.PI,.85*Math.PI),e.stroke(),e.strokeStyle=L(et,.15),e.lineWidth=.5,e.beginPath(),e.moveTo(t,ea+.02*K),e.lineTo(t-.05*K,ea+.15*K),e.stroke()}(e,s,l,t.agentType,c,d,t.walkPhase,h,u),H(e,s,l,t.agentType,c,d),e.restore();t.isFrozen&&function(e,t,a,n){let r=A.Cw.baseWidth*n,o=A.Cw.baseHeight*n,i=r/2;e.save(),e.globalAlpha=.3,e.fillStyle="#A8CFF5",e.beginPath(),e.ellipse(t,a-.5*o,.6*i,.5*o,0,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.strokeStyle=L("#A8CFF5",.6),e.lineWidth=1.5,e.setLineDash([3,3]),e.beginPath(),e.ellipse(t,a-.5*o,.7*i,.55*o,0,0,2*Math.PI),e.stroke(),e.setLineDash([]),e.restore()}(e,s,l,d),function(e,t,a,n,r){let o=a-A.Cw.baseHeight*r-10*r,i=z(n),s=4*r,l=e.createRadialGradient(t,o,0,t,o,4*s);l.addColorStop(0,L(i,.35)),l.addColorStop(1,L(i,0)),e.fillStyle=l,e.beginPath(),e.arc(t,o,4*s,0,2*Math.PI),e.fill();let c=e.createRadialGradient(t-.3*s,o-.3*s,.1*s,t,o,s);c.addColorStop(0,"#FFFFFF"),c.addColorStop(.3,i),c.addColorStop(1,L(i,.7)),e.fillStyle=c,e.beginPath(),e.arc(t,o,s,0,2*Math.PI),e.fill()}(e,s,l,t.avgP,d),a&&function(e,t,a,n){let r=A.Cw.baseWidth*n,o=A.Cw.baseHeight*n,i=r/2;e.strokeStyle=L("#FFFFFF",.3),e.lineWidth=4,e.beginPath(),e.ellipse(t,a-.5*o,.7*i,.54*o,0,0,2*Math.PI),e.stroke(),e.strokeStyle=L("#FFFFFF",.8),e.lineWidth=1.5,e.beginPath(),e.ellipse(t,a-.5*o,.68*i,.52*o,0,0,2*Math.PI),e.stroke()}(e,s,l,d),e.restore()})(a,e,e.id===t)}}(e,t.hoveredAgent)),s&&s.active){let t=(0,F.Gs)(e.gridX,e.gridY),a=t.x+e.walkOffsetX,n=t.y+e.walkOffsetY;o.push({depth:e.gridX+e.gridY+.1,render:t=>(function(e,t,a,n,r,o){let i=Date.now()-r;if(i>o||i<0)return;let s=i/o,l=1-s,c=a-56*n-8*n;e.save(),e.font=K.mQ,e.textAlign="center";let d=3+Math.floor(3*Math.random()),u=Math.floor(i/40);for(let a=0;a<d;a++){let n=String.fromCharCode(65382+(31*u+17*a>>>0)%56%56),r=(a-(d-1)/2)*8,o=-(6*Math.sin(s*Math.PI));e.fillStyle=(0,K.Hw)(.8*l),e.fillText(n,t+r,c+o)}e.restore()})(t,a,n,e.scale,s.startTime,s.duration)})}let l=new Set(t.agents.map(e=>"".concat(e.gridX,",").concat(e.gridY)));for(let e of function(e,t){if(en===e&&ea)return ea;let a=et(7919),n=[],r=["tower","spire","node"];for(let o=0;o<e;o++)for(let i=0;i<e;i++)!t.has("".concat(o,",").concat(i))&&(a()>.15||n.push({gridX:o,gridY:i,type:r[Math.floor(a()*r.length)],seed:Math.floor(1e4*a())}));return ea=n,en=e,n}(t.gridSize,l))o.push(function(e,t,a){return{depth:e.gridX+e.gridY-.3,render:n=>(function(e,t,a,n){let r=(0,F.Gs)(t.gridX,t.gridY),o=r.x,i=r.y,s=n?Math.max(0,Math.min(1,(n.total_welfare+50)/100)):.5,l=a.threatLevel,c=l>.4?B(A.lm.accent,A.lm.alert,Math.min((l-.4)/.4,1)):A.lm.accent,d=.4+.6*s;switch(e.save(),t.type){case"tower":!function(e,t,a,n,r,o,i){let s=.22*A.KP,l=.22*A.VM,c=20+100*n;q.drawBuilding(e,"tower",t,a,2*s+2,c)||(e.beginPath(),e.moveTo(t,a),e.lineTo(t+s,a-l),e.lineTo(t+s,a-l-c),e.lineTo(t,a-c),e.closePath(),e.fillStyle=L("#1A2233",.9*o),e.fill(),e.strokeStyle=L(r,.3*o),e.lineWidth=.5,e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(t-s,a-l),e.lineTo(t-s,a-l-c),e.lineTo(t,a-c),e.closePath(),e.fillStyle=L("#0F1620",.9*o),e.fill(),e.strokeStyle=L(r,.25*o),e.lineWidth=.5,e.stroke(),e.beginPath(),e.moveTo(t,a-c-l),e.lineTo(t+s,a-l-c),e.lineTo(t,a-c),e.lineTo(t-s,a-l-c),e.closePath(),e.fillStyle=L("#243040",.9*o),e.fill(),e.strokeStyle=L(r,.4*o),e.lineWidth=.5,e.stroke());let d=et(i),u=Math.max(2,Math.floor(c/14));for(let n=0;n<u;n++)for(let i=0;i<2;i++){let s=a-6-12*n,l=t+3+8*i;!(s<a-c+4)&&d()>.3&&(e.fillStyle=L(r,o*(.4+.4*d())),e.fillRect(l,s,4,3))}for(let n=0;n<u;n++)for(let i=0;i<2;i++){let s=a-6-12*n,l=t-7-8*i;!(s<a-c+4)&&d()>.3&&(e.fillStyle=L(r,o*(.3+.3*d())),e.fillRect(l,s,4,3))}let h=8+12*n;e.beginPath(),e.moveTo(t,a-c-l),e.lineTo(t,a-c-l-h),e.strokeStyle=L(r,.6*o),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(t,a-c-l-h,1.5,0,2*Math.PI),e.fillStyle=L(r,.8*o),e.fill(),e.strokeStyle=L(r,.06*o),e.lineWidth=.5;for(let n=a-c;n<a;n+=3)e.beginPath(),e.moveTo(t-s,n),e.lineTo(t+s,n),e.stroke()}(e,o,i,s,c,d,t.seed);break;case"spire":!function(e,t,a,n,r,o,i){var s;let l=Math.min((null!=(s=null==n?void 0:n.avg_degree)?s:2)/8,1),c=30+90*l;q.drawBuilding(e,"spire",t,a,6,c)||(e.beginPath(),e.moveTo(t-3,a),e.lineTo(t+3,a),e.lineTo(t+1,a-c),e.lineTo(t-1,a-c),e.closePath(),e.fillStyle=L("#1A2233",.8*o),e.fill(),e.strokeStyle=L(r,.3*o),e.lineWidth=.5,e.stroke());let d=Date.now(),u=2+ +(l>.5);for(let n=0;n<u;n++){let i=(d/1200+.8*n)%1,s=a-.4*c-n*c*.2,u=6+10*i,h=3+5*i,p=(1-i)*o*.5*l;e.beginPath(),e.ellipse(t,s,u,h,0,0,2*Math.PI),e.strokeStyle=L(r,p),e.lineWidth=1,e.stroke()}e.beginPath(),e.arc(t,a-c,2,0,2*Math.PI),e.fillStyle=L(r,.7*o),e.fill()}(e,o,i,n,c,d,t.seed);break;case"node":!function(e,t,a,n,r,o,i){let s=1-n,l=.18*A.KP,c=.18*A.VM,d=12+18*s;q.drawBuilding(e,"node",t,a,2*l+2,d)||(e.beginPath(),e.moveTo(t,a),e.lineTo(t+l,a-c),e.lineTo(t+l,a-c-d),e.lineTo(t,a-d),e.closePath(),e.fillStyle=L("#1A2233",.85*o),e.fill(),e.beginPath(),e.moveTo(t,a),e.lineTo(t-l,a-c),e.lineTo(t-l,a-c-d),e.lineTo(t,a-d),e.closePath(),e.fillStyle=L("#0F1620",.85*o),e.fill(),e.beginPath(),e.moveTo(t,a-d-c),e.lineTo(t+l,a-c-d),e.lineTo(t,a-d),e.lineTo(t-l,a-c-d),e.closePath(),e.fillStyle=L("#243040",.85*o),e.fill(),e.strokeStyle=L(r,.3*o),e.lineWidth=.5,e.beginPath(),e.moveTo(t,a),e.lineTo(t+l,a-c),e.lineTo(t+l,a-c-d),e.lineTo(t,a-d),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(t-l,a-c),e.lineTo(t-l,a-c-d),e.lineTo(t,a-d),e.stroke());let u=10+14*s,h=e.createRadialGradient(t,a-d-.5*c,0,t,a-d-.5*c,u);h.addColorStop(0,L(r,s*o*.5)),h.addColorStop(1,L(r,0)),e.fillStyle=h,e.beginPath(),e.arc(t,a-d-.5*c,u,0,2*Math.PI),e.fill()}(e,o,i,l,c,d,t.seed)}e.restore()})(n,e,t,a)}}(e,t.environment,t.epoch));if(t.epoch&&o.push({depth:t.gridSize-2+1-.2,render:e=>(function(e,t,a){if(!a||0===a.total_posts+a.total_votes+a.total_tasks_completed)return;let n=(0,F.Gs)(t-2,1),r=n.x,o=n.y,i=.06*A.KP,s=.06*A.VM,l=Math.max(1,a.total_posts,a.total_votes,a.total_tasks_completed);for(let t of(e.save(),er)){let n=t.getValue(a);if(0===n)continue;let c=r+t.offsetX,d=Math.min(n/l,1),u=8+50*d,h=.5+.3*d;e.beginPath(),e.moveTo(c,o),e.lineTo(c+i,o-s),e.lineTo(c+i,o-s-u),e.lineTo(c,o-u),e.closePath(),e.fillStyle=L(t.color,.5*h),e.fill(),e.beginPath(),e.moveTo(c,o),e.lineTo(c-i,o-s),e.lineTo(c-i,o-s-u),e.lineTo(c,o-u),e.closePath(),e.fillStyle=L(t.color,.35*h),e.fill(),e.beginPath(),e.moveTo(c,o-u-s),e.lineTo(c+i,o-s-u),e.lineTo(c,o-u),e.lineTo(c-i,o-s-u),e.closePath(),e.fillStyle=L(t.color,.6*h),e.fill(),e.strokeStyle=L(t.color,.4*h),e.lineWidth=.5,e.beginPath(),e.moveTo(c,o),e.lineTo(c+i,o-s),e.lineTo(c+i,o-s-u),e.lineTo(c,o-u),e.lineTo(c-i,o-s-u),e.lineTo(c-i,o-s),e.closePath(),e.stroke(),e.strokeStyle=L(t.color,.06),e.lineWidth=.4;for(let t=o-u;t<o;t+=4)e.beginPath(),e.moveTo(c-i,t),e.lineTo(c+i,t),e.stroke();e.font="bold 7px 'Courier New', monospace",e.textAlign="center",e.fillStyle=L(t.color,.8),e.fillText(String(n),c,o-u-s-4)}e.restore()})(e,t.gridSize,t.epoch)}),t.overlays.interactions)for(let e of t.arcs){let a=function(e,t,a){let n=t.get(e.fromId),r=t.get(e.toId);if(!n||!r)return null;let o=a===e.fromId||a===e.toId;return{depth:Math.max(n.gridX+n.gridY,r.gridX+r.gridY)+.5,render:t=>(function(e,t,a,n,r){let o=(0,F.Gs)(a.gridX,a.gridY),i=(0,F.Gs)(n.gridX,n.gridY),s={x:o.x+a.walkOffsetX,y:o.y+a.walkOffsetY},l=s.y-a.scale*A.Cw.baseHeight*.6,c=i.y-n.scale*A.Cw.baseHeight*.6,d=z(t.p),u=(0,I.vT)(t.progress),h=(s.x+i.x)/2,p=Math.min(l,c)-40-.15*Math.abs(s.x-i.x);e.save();let f=function(e){switch(e){case"communication":return{dash:[2,4],widthBonus:0,double:!1};case"task":return{dash:[],widthBonus:.5,double:!1};case"governance":return{dash:[],widthBonus:0,double:!0};default:return{dash:[],widthBonus:0,double:!1}}}(t.interactionType);if(t.accepted){if(e.strokeStyle=L(d,r?.15:.08),e.lineWidth=1+f.widthBonus,f.dash.length>0&&e.setLineDash(f.dash),e.beginPath(),e.moveTo(s.x,l),e.quadraticCurveTo(h,p,i.x,c),e.stroke(),f.double&&(e.beginPath(),e.moveTo(s.x,l-2),e.quadraticCurveTo(h,p-2,i.x,c-2),e.stroke()),f.dash.length>0&&e.setLineDash([]),u>.01){e.strokeStyle=L(d,r?.5:.25),e.lineWidth=(r?2:1)+f.widthBonus,f.dash.length>0&&e.setLineDash(f.dash),e.beginPath(),e.moveTo(s.x,l);let t=Math.max(8,Math.floor(30*u));for(let a=1;a<=t;a++){let n=a/t*u,r=U(s.x,l,h,p,i.x,c,n);e.lineTo(r.x,r.y)}if(e.stroke(),f.double){e.beginPath(),e.moveTo(s.x,l-2);let t=Math.max(8,Math.floor(30*u));for(let a=1;a<=t;a++){let n=a/t*u,r=U(s.x,l-2,h,p-2,i.x,c-2,n);e.lineTo(r.x,r.y)}e.stroke()}f.dash.length>0&&e.setLineDash([])}if(u<1&&function(e,t,a,n,r,o,i,s,l,c,d){let u=(0,I.YZ)(t.id),h=Date.now(),p=Math.max(0,Math.min(1,t.p)),f=Math.round((0,I.Cc)(A.KS.charCountMin,A.KS.charCountMax,p)),g=(0,I.Cc)(A.KS.charSpacingMax,A.KS.charSpacingMin,p),m=(0,I.Cc)(A.KS.mutateIntervalMax,A.KS.mutateIntervalMin,p),x=(0,I.Cc)(A.KS.glowRadiusMin,A.KS.glowRadiusMax,p);e.save(),e.font=K.mQ,e.textAlign="center";for(let p=0;p<f;p++){let v=l-p*g;if(v<0||v>1)continue;let b=U(a,n,r,o,i,s,v),y=u+31*p+Math.floor(h/m),w=(0,K.TN)(y),_=(1-p/f)*(d?.9:.7);if(0===p){e.fillStyle="rgba(255,255,255,".concat(_,")"),e.fillText(w,b.x,b.y);let t=e.createRadialGradient(b.x,b.y,0,b.x,b.y,x);t.addColorStop(0,L(c,.4)),t.addColorStop(1,L(c,0)),e.fillStyle=t,e.beginPath(),e.arc(b.x,b.y,x,0,2*Math.PI),e.fill()}else e.fillStyle=(0,K.eJ)(t.p,_),e.fillText(w,b.x,b.y)}e.restore()}(e,t,s.x,l,h,p,i.x,c,u,d,r),u>=.45&&u<=.55&&function(e,t,a,n,r,o,i,s,l,c){let d=(0,I.YZ)(t.id),u=Date.now(),h=(a+r)/2,p=(n+o)/2-15,f=.7*Math.sin((l-.45)/.1*Math.PI);e.save(),e.font=K.mQ,e.textAlign="center";let{gridSize:g,gridSpacing:m}=A.KS,x=Math.floor(u/60);for(let a=0;a<g;a++)for(let n=0;n<g;n++){let r=h+(n-1)*m,o=p+(a-1)*m,i=d+7*a+13*n+x,s=(0,K.TN)(i);e.fillStyle=(0,K.eJ)(t.p,f*(.5+.5*Math.random())),e.fillText(s,r,o)}e.restore()}(e,t,s.x,l,i.x,c,0,0,u,0),u>.95){let t=(1-(u-.95)/.05)*.6,a=6+(u-.95)/.05*12,n=e.createRadialGradient(i.x,c,0,i.x,c,a);n.addColorStop(0,L(d,t)),n.addColorStop(1,L(d,0)),e.fillStyle=n,e.beginPath(),e.arc(i.x,c,a,0,2*Math.PI),e.fill()}}else{if(e.strokeStyle=L(d,(r?.7:.3)*(1-.5*u)),e.lineWidth=r?2:1,e.setLineDash([4,4]),e.beginPath(),e.moveTo(s.x,l),e.quadraticCurveTo(h,p,i.x,c),e.stroke(),function(e,t,a,n,r,o,i,s,l,c){if(l<.15||l>.9)return;let d=(0,I.YZ)(t.id),u=Date.now();e.save(),e.font=K.mQ,e.textAlign="center";for(let t=0;t<6;t++){let h=.8*l-.06*t;if(h<0||h>1)continue;let p=U(a,n,r,o,i,s,h),f=d+17*t+Math.floor(u/100),g=(0,K.wx)(f),m=(l-.15)*15,x=p.x+Math.sin(f)*m,v=p.y+Math.cos(1.3*f)*m,b=(1-t/6)*(c?.7:.4)*(1-l);e.fillStyle="rgba(235,87,87,".concat(b,")"),e.fillText(g,x,v)}e.restore()}(e,t,s.x,l,h,p,i.x,c,u,r),u>.2&&u<.85){let t=U(s.x,l,h,p,i.x,c,.5);e.strokeStyle=L("#EB5757",.8*(u<.5?(0,I.am)((u-.2)/.3):1-(0,I.am)((u-.5)/.35))),e.lineWidth=2,e.setLineDash([]),e.beginPath(),e.moveTo(t.x-5,t.y-5),e.lineTo(t.x+5,t.y+5),e.moveTo(t.x+5,t.y-5),e.lineTo(t.x-5,t.y+5),e.stroke()}if(u>.3&&u<.8){let a=U(s.x,l,h,p,i.x,c,.5),n=1-(u-.3)/.5,r=(0,I.YZ)(t.id);e.font=K.mQ,e.textAlign="center";for(let t=0;t<6;t++){let o=t/6*Math.PI*2+3*u,i=(u-.3)*35,s=(0,K.wx)(r+13*t+Math.floor(5*u));e.fillStyle=L("#EB5757",.7*n),e.fillText(s,a.x+Math.cos(o)*i,a.y+Math.sin(o)*i)}}}e.restore()})(t,e,n,r,o)}}(e,i,t.hoveredAgent);a&&o.push(a)}for(let t of o.slice().sort((e,t)=>e.depth-t.depth))t.render(e);if(t.overlays.collusionLines&&t.environment.collusionRisk>.1){let a=new Set(["adversarial","deceptive","opportunistic"]),n=t.agents.filter(e=>a.has(e.agentType));for(let a=0;a<n.length;a++)for(let r=a+1;r<n.length;r++)!function(e,t,a,n){let r=(0,F.Gs)(t.gridX,t.gridY),o=(0,F.Gs)(a.gridX,a.gridY),i=r.y-t.scale*A.Cw.baseHeight*.3,s=o.y-a.scale*A.Cw.baseHeight*.3;e.save();let l=Date.now()/1e3;for(let t=0;t<2;t++){let a=0===t?1:-1;e.strokeStyle=L("#5B2D8B",n*(.3+.15*t)),e.lineWidth=1.5-.5*t,e.beginPath();for(let c=0;c<=20;c++){let d=c/20,u=r.x+(o.x-r.x)*d,h=i+(s-i)*d,p=6*Math.sin(d*Math.PI*4+2.5*l+t)*a*n,f=u+.3*p,g=h+p;0===c?e.moveTo(f,g):e.lineTo(f,g)}e.stroke()}for(let t=0;t<3;t++){let a=(.8*l+.33*t)%1,c=r.x+(o.x-r.x)*a,d=i+(s-i)*a;e.fillStyle=L("#BB6BD9",Math.sin(a*Math.PI)*n*.6),e.beginPath(),e.arc(c,d,2.5,0,2*Math.PI),e.fill()}e.restore()}(e,n[a],n[r],t.environment.collusionRisk)}if(t.environment.avgSynergyScore>.1){let a=new Set(["cooperative","altruistic"]),n=t.agents.filter(e=>a.has(e.agentType));for(let a=0;a<n.length;a++)for(let r=a+1;r<n.length;r++)!function(e,t,a,n){let r=(0,F.Gs)(t.gridX,t.gridY),o=(0,F.Gs)(a.gridX,a.gridY),i=r.y-t.scale*A.Cw.baseHeight*.3,s=o.y-a.scale*A.Cw.baseHeight*.3;e.save();let l=Date.now()/1e3,c=(r.x+o.x)/2,d=(i+s)/2-20;e.strokeStyle=L("#F2C94C",.3*n),e.lineWidth=1.5,e.beginPath(),e.moveTo(r.x,i),e.quadraticCurveTo(c,d,o.x,s),e.stroke();for(let t=0;t<4;t++){let a=(.5*l+.25*t)%1,u=1-a,h=u*u*r.x+2*u*a*c+a*a*o.x,p=u*u*i+2*u*a*d+a*a*s;e.fillStyle=L("#F2C94C",Math.sin(a*Math.PI)*n*.5),e.beginPath(),e.arc(h,p,2,0,2*Math.PI),e.fill()}e.restore()}(e,n[a],n[r],t.environment.avgSynergyScore)}if(t.overlays.particles&&function(e,t){for(let a of t){let t=a.life/a.maxLife;e.fillStyle=L(a.color,a.alpha*t),e.beginPath(),e.arc(a.x,a.y,a.size*t,0,2*Math.PI),e.fill()}}(e,t.particles),e.restore(),!function(e,t,a,n){if(n<.05)return;let r=Math.min(n,1),o=n>.5?"#EB5757":"#6FCF97",i=Date.now()/1e3,s=e.createLinearGradient(0,.55*a,0,a);s.addColorStop(0,L(o,0)),s.addColorStop(.5,L(o,.08*r)),s.addColorStop(1,L(o,.18*r)),e.fillStyle=s,e.fillRect(0,0,t,a);for(let n=0;n<2;n++){let s=a*(.7+.12*n),l=r*(.06-.02*n);e.beginPath(),e.moveTo(0,a);for(let a=0;a<=t;a+=8){let t=s+8*Math.sin(.01*a+i*(.5+.3*n));e.lineTo(a,t)}e.lineTo(t,a),e.closePath(),e.fillStyle=L(o,l),e.fill()}}(e,a,n,t.environment.toxicity),t.overlays.tierraStrip&&function(e,t,a,n,r){if(0===t.length)return;let o=r-18-4-56,i=t.reduce((e,t)=>e+Math.max(t.resources,1),0);if(i<=0)return;e.save(),e.fillStyle=L("#000000",.6),e.fillRect(0,o-1,n,20);let s=0;for(let r of t){let t=Math.max(r.resources,1)/i*n,l=A.FJ[r.agentType],c=0!==r.walkOffsetX||0!==r.walkOffsetY;if(e.fillStyle=r.id===a?"#FFFFFF":l.secondary,e.fillRect(s,o,t,18),c){let a=.5+.5*Math.sin(Date.now()/200);e.strokeStyle=L(l.accent,.6+.4*a),e.lineWidth=2,e.strokeRect(s+1,o+1,t-2,16)}e.fillStyle=L("#000000",.5),e.fillRect(s+t-.5,o,1,18),s+=t}e.fillStyle=L("#000000",.15);for(let t=o;t<o+18;t+=2)e.fillRect(0,t,n,1);e.fillStyle=L("#00FF41",.2),e.fillRect(0,o-1,n,1),e.fillRect(0,o+18,n,1),e.restore()}(e,t.agents,t.hoveredAgent,a,n),t.recompileState&&t.recompileState.active&&function(e,t,a,n){if(!t.active)return;let r=Date.now()-t.startTime;if(r>t.duration)return;let o=r/t.duration;if(o<.5){let t=o/.5*n,r=e.createLinearGradient(0,t-30,0,t+30);r.addColorStop(0,(0,K.Hw)(0)),r.addColorStop(.4,(0,K.Hw)(.3)),r.addColorStop(.5,(0,K.Hw)(.6)),r.addColorStop(.6,(0,K.Hw)(.3)),r.addColorStop(1,(0,K.Hw)(0)),e.fillStyle=r,e.fillRect(0,t-30,a,60)}if(o>.3){let t=Math.max(0,(1-(o-.3)/.7)*.08);e.fillStyle=(0,K.Hw)(t),e.fillRect(0,0,a,n)}}(e,t.recompileState,a,n),t.environment.incoherence>.15&&function(e,t,a,n){let r;if(n<.15)return;let o=Math.min((n-.15)/.6,1),i=Date.now(),s=(r=0|Math.floor(i/80),()=>{let e=Math.imul((r=r+0x6d2b79f5|0)^r>>>15,1|r);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000}),l=Math.floor(1+5*o);e.save();for(let n=0;n<l;n++){if(s()>.3+.5*o)continue;let n=Math.floor(s()*a),r=2+Math.floor(s()*(4+12*o)),i=(s()-.5)*(3+12*o);try{let o=e.getImageData(0,n,t,Math.min(r,a-n));e.putImageData(o,i,n)}catch(e){break}}if(o>.4){let n=(o-.4)*.08,r=Math.floor(i/120);e.fillStyle=L("#00FFFF",n);for(let n=0;n<3;n++){let o=(37*r+131*n)%a;e.fillRect(0,o,t,1)}e.fillStyle=L(A.lm.alert,n);for(let n=0;n<2;n++){let o=(53*r+97*n)%a;e.fillRect(0,o,t,1)}}e.restore()}(e,a,n,t.environment.incoherence),t.hoveredAgent){let a=t.agents.find(e=>e.id===t.hoveredAgent);a&&function(e,t,a){let n=(0,F.Gs)(a.gridX,a.gridY),r=(n.x+a.walkOffsetX)*t.zoom+t.x,o=(n.y+a.walkOffsetY-56*a.scale-30)*t.zoom+t.y,i="".concat(a.name," (").concat(a.agentType,")"),s="Rep: ".concat(a.reputation.toFixed(2)," | P: ").concat(a.avgP.toFixed(2)),l=a.isFrozen?"FROZEN":a.isQuarantined?"QUARANTINED":"";e.save(),e.font="bold 12px -apple-system, sans-serif";let c=Math.max(e.measureText(i).width,e.measureText(s).width,l?e.measureText(l).width:0)+20,d=l?48:38,u=r-c/2,h=o-d-8;e.shadowColor="rgba(0,0,0,0.4)",e.shadowBlur=8,e.shadowOffsetY=2,e.fillStyle=A.lm.panel,e.strokeStyle=A.lm.border,e.lineWidth=1,e.beginPath(),e.roundRect(u,h,c,d,6),e.fill(),e.shadowColor="transparent",e.stroke(),e.fillStyle=A.lm.panel,e.beginPath(),e.moveTo(r-5,h+d),e.lineTo(r,h+d+5),e.lineTo(r+5,h+d),e.closePath(),e.fill(),e.fillStyle=A.lm.text,e.textAlign="center",e.fillText(i,r,h+15),e.font="11px -apple-system, sans-serif",e.fillStyle=A.lm.muted,e.fillText(s,r,h+29),l&&(e.font="bold 10px -apple-system, sans-serif",e.fillStyle=a.isFrozen?"#A8CFF5":"#EB5757",e.fillText(l,r,h+42)),e.restore()}(e,t.viewport,a)}}(r,{agents:t,arcs:a,viewport:o,hoveredAgent:i,selectedAgent:s,epoch:l,environment:c,overlays:d,particles:u,gridSize:h,digitalRain:m.current,codeTrails:g.current.particles,recompileState:x.current}),r.restore())});let k=(0,r.useCallback)((e,a)=>{let n=(0,E.UT)(o,e,a);for(let e of[...t].sort((e,t)=>t.gridX+t.gridY-(e.gridX+e.gridY))){let t=function(e){let{x:t,y:a}=(0,F.Gs)(e.gridX,e.gridY),n=t+e.walkOffsetX,r=a+e.walkOffsetY,o=A.Cw.baseWidth*e.scale;return{minX:n-o/2,minY:r-A.Cw.baseHeight*e.scale-10,maxX:n+o/2,maxY:r}}(e);if(n.x>=t.minX&&n.x<=t.maxX&&n.y>=t.minY&&n.y<=t.maxY)return e.id}return null},[t,o]),j=(0,r.useCallback)(e=>{_.current=!0,S.current={x:e.clientX,y:e.clientY}},[]),C=(0,r.useCallback)(t=>{var a;let n=null==(a=e.current)?void 0:a.getBoundingClientRect();if(!n)return;let r=t.clientX-n.left,o=t.clientY-n.top;_.current?(v(t.clientX-S.current.x,t.clientY-S.current.y),S.current={x:t.clientX,y:t.clientY}):p(k(r,o))},[v,k,p]),M=(0,r.useCallback)(t=>{let a=_.current;if(_.current=!1,!a||3>Math.abs(t.clientX-S.current.x)&&3>Math.abs(t.clientY-S.current.y)){var n;let a=null==(n=e.current)?void 0:n.getBoundingClientRect();if(!a)return;f(k(t.clientX-a.left,t.clientY-a.top))}},[k,f]),T=(0,r.useCallback)(t=>{var a;t.preventDefault();let n=null==(a=e.current)?void 0:a.getBoundingClientRect();n&&b(t.deltaY,t.clientX-n.left,t.clientY-n.top)},[b]),P=(0,r.useCallback)(()=>{y()},[y]);return(0,n.jsx)("canvas",{ref:e,className:"absolute inset-0 cursor-grab active:cursor-grabbing",onMouseDown:j,onMouseMove:C,onMouseUp:M,onMouseLeave:()=>{_.current=!1,p(null)},onWheel:T,onDoubleClick:P})}var ei=a(3424);function es(e,t,a){var n,r,o,i,s,l,c,d,u,h,p,f,g,m,x,v,b,y,w,_,S,k;if(!e&&!t)return{threatLevel:0,toxicity:0,giniCoefficient:0,collusionRisk:0,incoherence:0,contagionDepth:0,activeThreats:0,reputationStd:0,payoffStd:0,avgSynergyScore:0,avgCoordinationScore:0,avgDegree:0,avgClustering:0};let j=null!=e?e:t,C=null!=t?t:e,M=(0,I.e1)(0,1,a);return{threatLevel:(0,I.Cc)(null!=(n=j.ecosystem_threat_level)?n:0,null!=(r=C.ecosystem_threat_level)?r:0,M),toxicity:(0,I.Cc)(j.toxicity_rate,C.toxicity_rate,M),giniCoefficient:(0,I.Cc)(j.gini_coefficient,C.gini_coefficient,M),collusionRisk:(0,I.Cc)(null!=(o=j.ecosystem_collusion_risk)?o:0,null!=(i=C.ecosystem_collusion_risk)?i:0,M),incoherence:(0,I.Cc)(null!=(s=j.incoherence_index)?s:0,null!=(l=C.incoherence_index)?l:0,M),contagionDepth:(0,I.Cc)(null!=(c=j.contagion_depth)?c:0,null!=(d=C.contagion_depth)?d:0,M),activeThreats:(0,I.Cc)(null!=(u=j.active_threats)?u:0,null!=(h=C.active_threats)?h:0,M),reputationStd:(0,I.Cc)(null!=(p=j.reputation_std)?p:0,null!=(f=C.reputation_std)?f:0,M),payoffStd:(0,I.Cc)(null!=(g=j.payoff_std)?g:0,null!=(m=C.payoff_std)?m:0,M),avgSynergyScore:(0,I.Cc)(null!=(x=j.avg_synergy_score)?x:0,null!=(v=C.avg_synergy_score)?v:0,M),avgCoordinationScore:(0,I.Cc)(null!=(b=j.avg_coordination_score)?b:0,null!=(y=C.avg_coordination_score)?y:0,M),avgDegree:(0,I.Cc)(null!=(w=j.avg_degree)?w:0,null!=(_=C.avg_degree)?_:0,M),avgClustering:(0,I.Cc)(null!=(S=j.avg_clustering)?S:0,null!=(k=C.avg_clustering)?k:0,M)}}function el(){let{state:e,dispatch:t,interactionSystem:a,particleSystem:n,codeTrailSystem:i,digitalRainRef:s,recompileStateRef:l,agentPositions:c,agentsByEpoch:d}=(0,r.useContext)(o.X),u=(0,r.useRef)(0),h=(0,r.useRef)(0),p=(0,r.useRef)(0),f=(0,r.useRef)(0),g=(0,r.useRef)(0),m=(0,r.useRef)(0),x=(0,r.useRef)(-1),v=(0,r.useRef)(-1),b=(0,r.useRef)(!1),y=(0,r.useRef)(new Map),w=(0,r.useRef)(new Map),_=(0,r.useRef)(()=>{}),S=(0,r.useCallback)(r=>{var o,S,k,j;if(!e.data)return;let C=h.current?r-h.current:16;h.current=r;let M=e.currentEpoch,T=e.epochFraction,P=e.currentStep,N=e.maxStepInEpoch,E=e.stepPlayback&&e.eventIndex;if(E&&!b.current&&0===a.current.arcs.length){b.current=!0;let t=e.eventIndex.interactionsAt(M,P);t.length>0&&a.current.addFromEventsAtStep(t,M,P)}else if(!E&&!b.current&&0===a.current.arcs.length){b.current=!0;let t=e.data.epoch_snapshots[M];if(t){let n=e.data.events;if(n&&n.length>0)a.current.addFromEvents(n,M);else{let e=[...c.current.keys()],n=t.total_interactions>0?t.accepted_interactions/t.total_interactions:.5;a.current.addSyntheticArcs(e,M,t.total_interactions,t.avg_p,n)}}}if(e.playing){if(E){let n=N+1,r=A.Yv.epochTransition/Math.max(n,1);if(f.current+=C*e.speed,f.current>=r){f.current=0,P<N?P+=1:(M=Math.min(M+1,e.data.epoch_snapshots.length-1),P=0,N=e.eventIndex.maxStep(M));let n=e.eventIndex.interactionsAt(M,P);n.length>0&&a.current.addFromEventsAtStep(n,M,P),M>=e.data.epoch_snapshots.length-1&&P>=N&&t({type:"SET_PLAYING",playing:!1})}T=Math.min(T=n>0?(P+f.current/r)/n:0,.999)}else if(p.current+=C*e.speed,(T=p.current/A.Yv.epochTransition)>=1){T=0,p.current=0,M=Math.min(M+1,e.data.epoch_snapshots.length-1);let n=e.data.epoch_snapshots[M];if(n){let t=e.data.events;if(t&&t.length>0)a.current.addFromEvents(t,M);else{let e=[...c.current.keys()],t=n.total_interactions>0?n.accepted_interactions/n.total_interactions:.5;a.current.addSyntheticArcs(e,M,n.total_interactions,n.avg_p,t)}}M>=e.data.epoch_snapshots.length-1&&t({type:"SET_PLAYING",playing:!1})}}x.current>=0&&M!==x.current&&(l.current={active:!0,startTime:Date.now(),duration:400,scanlineY:0}),x.current=M,v.current=P;let R=l.current;if(R.active&&Date.now()-R.startTime>R.duration&&(R.active=!1),a.current.update(C,M),n.current.update(C),i.current.update(C),!s.current&&e.viewport.width>0&&(s.current=$(e.viewport.width)),s.current){let t=e.environment.threatLevel;ee(s.current,C,e.viewport.height,t)}let D=null!=(o=d.current.get(M))?o:new Map,B=Math.min(M+1,e.data.epoch_snapshots.length-1),L=null!=(S=d.current.get(B))?S:D,z=(0,ei.G)(D,L,T,c.current),O=new Map(z.map(e=>[e.id,e])),G=new Set;for(let e of a.current.arcs){let t;if(e.progress>=1||e.progress<0)continue;let a=O.get(e.fromId),n=O.get(e.toId);if(!a||!n||G.has(e.fromId))continue;let r=(0,F.Gs)(a.gridX,a.gridY),o=(0,F.Gs)(n.gridX,n.gridY),i={x:o.x+n.walkOffsetX,y:o.y+n.walkOffsetY},s=A.Zu[a.agentType],l=e.progress;t=l<.45?(0,I.e1)(0,.45,l):l<.55?1:1-(0,I.e1)(.55,1,l);let c=(i.x-r.x)*t*.85,d=(i.y-r.y)*t*.85,u=Math.sqrt((i.x-r.x)**2+(i.y-r.y)**2),h=u>0?-(i.y-r.y)/u:0,p=u>0?(i.x-r.x)/u:0,f=s.swayAmplitude*Math.sin(3.5*a.walkPhase)*4,g=Math.sin(t*Math.PI)*(((0,I.YZ)(a.id)%200-100)/100*.15)*u;a.walkOffsetX=c+h*f+h*g,a.walkOffsetY=d+p*f+p*g;let m=i.x-r.x;Math.abs(m)>1&&w.current.set(e.fromId,m>0?1:-1),G.add(e.fromId)}for(let e of G){let t=O.get(e),a=A.Zu[t.agentType],n=(null!=(k=y.current.get(e))?k:0)+C*a.walkRate;y.current.set(e,n),t.walkPhase=n}for(let e of z)e.facing=null!=(j=w.current.get(e.id))?j:1;for(let[e]of y.current)G.has(e)||y.current.delete(e);let W=40+15*Math.sin(.003*r);if(r-m.current>W)for(let e of(m.current=r,G)){let t=O.get(e),a=(0,F.Gs)(t.gridX,t.gridY),n=a.x+t.walkOffsetX,r=a.y+t.walkOffsetY;i.current.spawnBurst(n,r-28*t.scale,t.avgP,2)}if(r-g.current>500)for(let e of(g.current=r,z)){let t=(0,F.Gs)(e.gridX,e.gridY),a=t.x+e.walkOffsetX,r=t.y+e.walkOffsetY;e.isFrozen&&n.current.add(Z(a,r-56*e.scale,2)),e.isQuarantined&&n.current.add(J(a,r,2))}let Y=e.data.epoch_snapshots[M],q=e.data.epoch_snapshots[B],X=es(Y,q,T),V=Y&&q?function(e,t,a){var n,r,o,i;let s=(0,I.e1)(0,1,a);return{...t,epoch:e.epoch,total_interactions:Math.round((0,I.Cc)(e.total_interactions,t.total_interactions,s)),accepted_interactions:Math.round((0,I.Cc)(e.accepted_interactions,t.accepted_interactions,s)),rejected_interactions:Math.round((0,I.Cc)(e.rejected_interactions,t.rejected_interactions,s)),toxicity_rate:(0,I.Cc)(e.toxicity_rate,t.toxicity_rate,s),quality_gap:(0,I.Cc)(e.quality_gap,t.quality_gap,s),avg_p:(0,I.Cc)(e.avg_p,t.avg_p,s),total_welfare:(0,I.Cc)(e.total_welfare,t.total_welfare,s),avg_payoff:(0,I.Cc)(e.avg_payoff,t.avg_payoff,s),payoff_std:(0,I.Cc)(e.payoff_std,t.payoff_std,s),gini_coefficient:(0,I.Cc)(e.gini_coefficient,t.gini_coefficient,s),n_frozen:Math.round((0,I.Cc)(e.n_frozen,t.n_frozen,s)),n_quarantined:Math.round((0,I.Cc)(e.n_quarantined,t.n_quarantined,s)),avg_reputation:(0,I.Cc)(e.avg_reputation,t.avg_reputation,s),reputation_std:(0,I.Cc)(e.reputation_std,t.reputation_std,s),ecosystem_threat_level:(0,I.Cc)(null!=(n=e.ecosystem_threat_level)?n:0,null!=(r=t.ecosystem_threat_level)?r:0,s),ecosystem_collusion_risk:(0,I.Cc)(null!=(o=e.ecosystem_collusion_risk)?o:0,null!=(i=t.ecosystem_collusion_risk)?i:0,s)}}(Y,q,T):null!=Y?Y:null;t({type:"TICK",agents:z,arcs:a.current.arcs,environment:X,particles:n.current.particles,epoch:M,fraction:T,epochSnap:V,step:P,maxStepInEpoch:N}),u.current=requestAnimationFrame(e=>_.current(e))},[e.data,e.playing,e.speed,e.currentEpoch,e.epochFraction,e.currentStep,e.maxStepInEpoch,e.stepPlayback,e.eventIndex,t,a,n,i,s,l,e.environment.threatLevel,e.viewport.height,e.viewport.width,c,d]);(0,r.useEffect)(()=>{_.current=S},[S]);let k=(0,r.useCallback)(()=>{t({type:"SET_PLAYING",playing:!0})},[t]),j=(0,r.useCallback)(()=>{t({type:"SET_PLAYING",playing:!1})},[t]),C=(0,r.useCallback)(n=>{if(p.current=0,f.current=0,t({type:"SET_EPOCH",epoch:n}),e.data)if(a.current.clear(),e.stepPlayback&&e.eventIndex){let t=e.eventIndex.interactionsAt(n,0);t.length>0&&a.current.addFromEventsAtStep(t,n,0)}else{let t=e.data.epoch_snapshots[n];if(t){let r=e.data.events;if(r&&r.length>0)a.current.addFromEvents(r,n);else{let e=[...c.current.keys()],r=t.total_interactions>0?t.accepted_interactions/t.total_interactions:.5;a.current.addSyntheticArcs(e,n,t.total_interactions,t.avg_p,r)}}}},[t,e.data,e.stepPlayback,e.eventIndex,a,c]),M=(0,r.useCallback)(n=>{if(f.current=0,t({type:"SET_STEP",step:n}),e.data&&e.eventIndex){a.current.clear();let t=e.currentEpoch;for(let r=Math.max(0,n-2);r<=n;r++){let n=e.eventIndex.interactionsAt(t,r);n.length>0&&a.current.addFromEventsAtStep(n,t,r)}}},[t,e.data,e.eventIndex,e.currentEpoch,a]),T=(0,r.useCallback)(e=>t({type:"SET_SPEED",speed:e}),[t]),P=(0,r.useCallback)(()=>t({type:"SET_STEP_PLAYBACK",enabled:!e.stepPlayback}),[t,e.stepPlayback]),N=(0,r.useCallback)(()=>{if(!e.data||!e.eventIndex)return;let t=e.eventIndex.maxStep(e.currentEpoch);e.currentStep<t?M(e.currentStep+1):e.currentEpoch<e.data.epoch_snapshots.length-1&&C(e.currentEpoch+1)},[e.data,e.eventIndex,e.currentEpoch,e.currentStep,M,C]),E=(0,r.useCallback)(()=>{if(e.eventIndex){if(e.currentStep>0)M(e.currentStep-1);else if(e.currentEpoch>0){let a=e.currentEpoch-1;p.current=0,f.current=0,t({type:"SET_EPOCH",epoch:a}),M(e.eventIndex.maxStep(a))}}},[e.eventIndex,e.currentEpoch,e.currentStep,M,t]);return(0,r.useEffect)(()=>{b.current=!1},[e.data]),(0,r.useEffect)(()=>(e.data&&(u.current=requestAnimationFrame(S)),()=>{u.current&&cancelAnimationFrame(u.current)}),[S,e.data]),{play:k,pause:j,setEpoch:C,setStep:M,setSpeed:T,stepForward:N,stepBack:E,toggleStepPlayback:P,playing:e.playing,speed:e.speed,currentEpoch:e.currentEpoch,currentStep:e.currentStep,maxStepInEpoch:e.maxStepInEpoch,stepPlayback:e.stepPlayback,maxEpoch:e.data?e.data.epoch_snapshots.length-1:0}}let ec=null;function ed(e,t,a){var n;ec={...e};let r=(0,i.s)(e.seed),o="sim-".concat(Date.now()),s=new c(void 0,e.sigmoidK),l=new u(e.payoff),d=function(e,t){let a=[],n=0;for(let r of e.agents){let e=h.n[r.type];if(e)for(let o=0;o<r.count;o++){let o=n%e.names.length,i=n>=e.names.length?"-".concat(Math.floor(n/e.names.length)+1):"";a.push({id:"agent-".concat(n),name:"".concat(e.names[o]).concat(i),type:r.type,reputation:.5+(t()-.5)*.2,resources:10+5*t(),totalPayoff:0,interactionsInitiated:0,interactionsReceived:0,sumPInitiated:0,sumPReceived:0,isFrozen:!1,isQuarantined:!1}),n++}}return a}(e,r),b=null!=(n=null==a?void 0:a.slice().sort((e,t)=>e.epoch-t.epoch))?n:[],y=0,w={...e.governance},_=[],S=[],k=[];for(let a=0;a<e.epochs;a++){for(;y<b.length&&b[y].epoch<=a;)w={...b[y].governance},y++;let n=[];for(let t=0;t<e.stepsPerEpoch;t++){let{result:e,event:i}=function(e,t,a,n,r,o,i,s){let l=e.map((e,t)=>({a:e,i:t})).filter(e=>{let{a:t}=e;return!t.isFrozen});if(l.length<2){var c,d,u,f;return{result:{p:.5,accepted:!1,initiatorPayoff:0,counterpartyPayoff:0},event:{event_type:"interaction",timestamp:new Date().toISOString(),epoch:o,step:i,interaction_id:"".concat(s,"-e").concat(o,"-s").concat(i),initiator:null!=(u=null==(c=e[0])?void 0:c.id)?u:"none",counterparty:null!=(f=null==(d=e[1])?void 0:d.id)?f:"none",interaction_type:"collaboration",accepted:!1,p:.5,v_hat:0}}}let g=l[Math.floor(r()*l.length)],m=g.a,x=function(e,t,a){let n;if(e.length<2)return t;do n=Math.floor(a()*e.length);while(n===t);return n}(e,g.i,r),v=e[x],b=p(h.n[m.type],m.reputation,r),{vHat:y,p:w}=t.computeLabels(b),_=h.n[v.type],S=m.reputation>=_.acceptanceThreshold&&!v.isFrozen,k=S?({taxRate:n,reputationDecay:1,circuitBreakerEnabled:!1,circuitBreakerThreshold:0}).taxRate:0,j=0,C=0;if(S){j=a.payoffInitiator(w,k,.01,m.reputation),C=a.payoffCounterparty(w,k,.01,v.reputation),m.totalPayoff+=j,v.totalPayoff+=C,m.resources=Math.max(0,m.resources+.1*j),v.resources=Math.max(0,v.resources+.1*C);let e=(w-.5)*.05;m.reputation=Math.max(0,Math.min(1,m.reputation+e)),v.reputation=Math.max(0,Math.min(1,v.reputation+.5*e))}m.interactionsInitiated++,v.interactionsReceived++,m.sumPInitiated+=w,v.sumPReceived+=w;let M={event_type:"interaction",timestamp:new Date().toISOString(),epoch:o,step:i,interaction_id:"".concat(s,"-e").concat(o,"-s").concat(i),initiator:m.id,counterparty:v.id,interaction_type:"collaboration",accepted:S,p:w,v_hat:y};return{result:{p:w,accepted:S,initiatorPayoff:j,counterpartyPayoff:C},event:M}}(d,s,l,w.taxRate,r,a,t,o);n.push(e),k.push(i)}f(d,w.reputationDecay);let i=x(a,n,d,o);for(let e of(_.push(i),g(w,i.toxicity_rate)&&m(d),d))S.push(v(e,a));null==t||t(a+1,e.epochs)}return{simulation_id:o,started_at:new Date().toISOString(),ended_at:new Date().toISOString(),n_epochs:e.epochs,steps_per_epoch:e.stepsPerEpoch,n_agents:d.length,seed:e.seed,epoch_snapshots:_,agent_snapshots:S,events:k}}var eu=a(3997);function eh(){let{currentEpoch:e,maxEpoch:t,pause:a}=el(),{data:o,loadData:i}=(0,N.$)(),[s,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(.05),[u,h]=(0,r.useState)(.95),[p,f]=(0,r.useState)(!1),g=ec,m=(0,r.useCallback)(()=>{a(),g&&(d(g.governance.taxRate),h(g.governance.reputationDecay),f(g.governance.circuitBreakerEnabled)),l(!0)},[a,g]),x=(0,r.useCallback)(()=>{if(!g||!o)return;let t={epoch:e,governance:{taxRate:c,reputationDecay:u,circuitBreakerEnabled:p,circuitBreakerThreshold:g.governance.circuitBreakerThreshold}},a=ed(g,void 0,[t]);(0,eu.recordToLeaderboard)(a),i(a),l(!1)},[g,o,e,c,u,p,i]);return g&&o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:m,className:"w-9 h-9 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors",title:"Intervene at epoch ".concat(e),children:(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M7 1v3M7 10v3M1 7h3M10 7h3"}),(0,n.jsx)("circle",{cx:"7",cy:"7",r:"2.5"})]})}),s&&(0,n.jsxs)("div",{className:"absolute bottom-16 right-4 w-64 bg-panel border border-border rounded-lg shadow-2xl p-4 z-[10001]",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,n.jsxs)("span",{className:"text-xs font-bold",children:["Intervene at Epoch ",e,"/",t]}),(0,n.jsx)("button",{onClick:()=>l(!1),className:"text-muted hover:text-text text-xs",children:"✕"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-16 shrink-0",children:"Tax"}),(0,n.jsx)("input",{type:"range",min:0,max:.5,step:.01,value:c,onChange:e=>d(parseFloat(e.target.value)),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-8",children:c.toFixed(2)})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-16 shrink-0",children:"Rep Decay"}),(0,n.jsx)("input",{type:"range",min:.8,max:1,step:.01,value:u,onChange:e=>h(parseFloat(e.target.value)),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-8",children:u.toFixed(2)})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-16 shrink-0",children:"CB"}),(0,n.jsx)("button",{onClick:()=>f(!p),className:"px-2 py-0.5 rounded text-xs font-bold ".concat(p?"bg-accent text-bg":"bg-btn text-muted"),children:p?"ON":"OFF"})]})]}),(0,n.jsx)("button",{onClick:x,className:"w-full mt-3 py-1.5 rounded font-bold text-xs bg-accent text-bg hover:opacity-90 transition-opacity",children:"Apply Intervention"}),(0,n.jsxs)("p",{className:"text-xs text-muted mt-1 text-center",children:["Re-runs sim with new governance from epoch ",e]})]})]}):null}let ep=[.5,1,2,4];function ef(){let{play:e,pause:t,setEpoch:a,setStep:o,setSpeed:i,stepForward:s,stepBack:l,toggleStepPlayback:c,playing:d,speed:u,currentEpoch:h,currentStep:p,maxStepInEpoch:f,stepPlayback:g,maxEpoch:m}=el(),{data:x}=(0,N.$)(),v=(0,r.useCallback)(()=>{x&&function(e){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="".concat(e.simulation_id||"history",".json"),n.click(),URL.revokeObjectURL(a)}(x)},[x]);return(0,n.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-panel border-t border-border flex flex-col z-[10000]",children:[g&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-4 pt-2 pb-1",children:[(0,n.jsx)("button",{onClick:l,className:"w-7 h-7 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors text-xs",title:"Step back",children:(0,n.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"currentColor",children:[(0,n.jsx)("rect",{x:"0",y:"1",width:"2",height:"8"}),(0,n.jsx)("path",{d:"M9 1v8L3 5z"})]})}),(0,n.jsxs)("span",{className:"text-xs text-muted w-28 text-center font-mono whitespace-nowrap",children:["Step ",p,"/",f]}),(0,n.jsx)("input",{type:"range",min:0,max:f,value:p,onChange:e=>o(Number(e.target.value)),className:"flex-1 h-1 appearance-none bg-border/60 rounded-full cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-2.5 [&::-webkit-slider-thumb]:h-2.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-secondary [&::-webkit-slider-thumb]:cursor-pointer"}),(0,n.jsx)("button",{onClick:s,className:"w-7 h-7 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors text-xs",title:"Step forward",children:(0,n.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"currentColor",children:[(0,n.jsx)("path",{d:"M1 1v8l6-4z"}),(0,n.jsx)("rect",{x:"8",y:"1",width:"2",height:"8"})]})})]}),(0,n.jsxs)("div",{className:"h-14 flex items-center gap-3 px-4",children:[(0,n.jsx)("button",{onClick:()=>d?t():e(),className:"w-9 h-9 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors",title:d?"Pause":"Play",children:d?(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:[(0,n.jsx)("rect",{x:"2",y:"1",width:"4",height:"12",rx:"1"}),(0,n.jsx)("rect",{x:"8",y:"1",width:"4",height:"12",rx:"1"})]}):(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:(0,n.jsx)("path",{d:"M3 1.5v11l9-5.5z"})})}),(0,n.jsxs)("span",{className:"text-xs text-muted w-20 text-center font-mono",children:["Epoch ",h,"/",m]}),(0,n.jsx)("input",{type:"range",min:0,max:m,value:h,onChange:e=>a(Number(e.target.value)),className:"flex-1 h-1.5 appearance-none bg-border rounded-full cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3.5 [&::-webkit-slider-thumb]:h-3.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-accent [&::-webkit-slider-thumb]:cursor-pointer"}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted mr-1",children:"Speed"}),ep.map(e=>(0,n.jsxs)("button",{onClick:()=>i(e),className:"px-2 py-1 text-xs rounded transition-colors ".concat(u===e?"bg-accent text-bg font-bold":"bg-btn hover:bg-btn-hover text-muted"),children:[e,"x"]},e))]}),(null==x?void 0:x.rawEvents)&&x.rawEvents.length>0&&(0,n.jsx)("button",{onClick:c,className:"px-2 py-1 text-xs rounded transition-colors ".concat(g?"bg-secondary text-bg font-bold":"bg-btn hover:bg-btn-hover text-muted"),title:g?"Switch to epoch-level playback":"Switch to step-level playback",children:g?"Step":"Epoch"}),x&&(0,n.jsx)(eh,{}),x&&(0,n.jsx)("button",{onClick:v,className:"w-9 h-9 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors",title:"Export as history.json",children:(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M7 1v8M4 6l3 3 3-3M2 11v1.5h10V11"})})})]})]})}let eg=[{label:"0.5x",value:400},{label:"1x",value:200},{label:"2x",value:100},{label:"4x",value:50},{label:"10x",value:20}];function em(){var e,t,a,o,i;let{state:s,togglePause:l,setTickRate:c,spawnAgent:d,injectShock:u,updateGovernance:p,stopGame:f,saveGame:g,computeRedTeamScore:m,dispatch:x}=P(),[v,y]=(0,r.useState)(!1),[w,_]=(0,r.useState)(!1),[j,C]=(0,r.useState)(!1),M=P().engineRef.current,T=null!=(e=null==M?void 0:M.governance)?e:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},N=null!=(t=null==M?void 0:M.epoch)?t:0,E=null!=(a=null==M?void 0:M.step)?a:0,F=null!=(o=null==M?void 0:M.agents.length)?o:0,R=(0,r.useCallback)(e=>{d(e),y(!1)},[d]),A=(0,r.useCallback)(()=>{let e=g();if(!e)return;let t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="swarm-save-epoch".concat(N,".json"),n.click(),URL.revokeObjectURL(a)},[g,N]),I="redteam"===s.mode?m():0;return(0,n.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-panel border-t border-border z-[10000]",children:["campaign"===s.mode&&s.currentLevel&&"playing"===s.levelStatus&&(0,n.jsxs)("div",{className:"flex items-center gap-3 px-4 py-1.5 border-b border-border bg-blue-950/30 text-xs",children:[(0,n.jsx)("span",{className:"text-blue-300 font-bold",children:s.currentLevel.name}),(0,n.jsxs)("span",{className:"text-muted",children:["Win: ",S(s.currentLevel.winCondition)]}),(0,n.jsx)("span",{className:"text-muted",children:"|"}),(0,n.jsxs)("span",{className:"text-red-400",children:["Lose: ",k(s.currentLevel.loseCondition)]}),s.currentLevel.hints[s.hintIndex]&&(0,n.jsxs)("button",{onClick:()=>x({type:"NEXT_HINT"}),className:"ml-auto text-yellow-400 hover:text-yellow-300 transition-colors",title:s.currentLevel.hints[s.hintIndex],children:["Hint (",s.hintIndex+1,"/",s.currentLevel.hints.length,")"]})]}),"redteam"===s.mode&&(0,n.jsxs)("div",{className:"flex items-center gap-3 px-4 py-1.5 border-b border-border bg-red-950/30 text-xs",children:[(0,n.jsx)("span",{className:"text-red-300 font-bold",children:"RED TEAM"}),(0,n.jsx)("span",{className:"text-muted",children:"Score:"}),(0,n.jsx)("span",{className:"font-mono text-red-400",children:I.toFixed(1)}),(0,n.jsx)("span",{className:"text-muted",children:"|"}),(0,n.jsx)("span",{className:"text-muted",children:"Best:"}),(0,n.jsx)("span",{className:"font-mono text-yellow-400",children:s.redTeamBestScore.toFixed(1)}),(0,n.jsx)("span",{className:"ml-auto text-muted",children:"Cause maximum system damage!"})]}),(0,n.jsxs)("div",{className:"h-14 flex items-center gap-2 px-4",children:[(0,n.jsx)("button",{onClick:l,className:"w-9 h-9 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors",title:s.isPaused?"Resume":"Pause",children:s.isPaused?(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:(0,n.jsx)("path",{d:"M3 1.5v11l9-5.5z"})}):(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:[(0,n.jsx)("rect",{x:"2",y:"1",width:"4",height:"12",rx:"1"}),(0,n.jsx)("rect",{x:"8",y:"1",width:"4",height:"12",rx:"1"})]})}),(0,n.jsxs)("span",{className:"text-xs text-muted font-mono w-28 text-center",children:["E",N," S",E,"/",null!=(i=null==M?void 0:M.config.stepsPerEpoch)?i:0]}),(0,n.jsx)("div",{className:"flex items-center gap-1",children:eg.map(e=>(0,n.jsx)("button",{onClick:()=>c(e.value),className:"px-1.5 py-1 text-[10px] rounded transition-colors ".concat(s.tickRate===e.value?"bg-accent text-bg font-bold":"bg-btn hover:bg-btn-hover text-muted"),children:e.label},e.value))}),(0,n.jsx)("div",{className:"w-px h-8 bg-border mx-1"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("button",{onClick:()=>{y(!v),_(!1),C(!1)},className:"px-2 py-1.5 text-xs rounded bg-btn hover:bg-btn-hover transition-colors flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-accent",children:"+"})," Spawn"]}),v&&(0,n.jsx)("div",{className:"absolute bottom-full mb-1 left-0 bg-panel border border-border rounded-lg shadow-lg py-1 w-44 z-50",children:h.K.filter(e=>"rlm"!==e&&"crewai"!==e).map(e=>(0,n.jsxs)("button",{onClick:()=>R(e),className:"w-full text-left px-3 py-1.5 text-xs hover:bg-btn-hover transition-colors flex justify-between",children:[(0,n.jsx)("span",{children:e.charAt(0).toUpperCase()+e.slice(1)}),(0,n.jsxs)("span",{className:"text-muted",children:[h.n[e].disposition>0?"+":"",h.n[e].disposition.toFixed(1)]})]},e))})]}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("button",{onClick:()=>{_(!w),y(!1),C(!1)},className:"px-2 py-1.5 text-xs rounded bg-btn hover:bg-btn-hover transition-colors flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-yellow-400",children:"!"})," Shock"]}),w&&(0,n.jsx)("div",{className:"absolute bottom-full mb-1 left-0 bg-panel border border-border rounded-lg shadow-lg py-1 w-56 z-50",children:b.map(e=>(0,n.jsxs)("button",{onClick:()=>{u(e.shock),_(!1)},className:"w-full text-left px-3 py-1.5 text-xs hover:bg-btn-hover transition-colors",title:e.description,children:[(0,n.jsx)("span",{className:"mr-1.5",children:e.icon}),(0,n.jsx)("span",{style:{color:e.color},children:e.name})]},e.id))})]}),(0,n.jsx)("button",{onClick:()=>{C(!j),y(!1),_(!1)},className:"px-2 py-1.5 text-xs rounded transition-colors flex items-center gap-1 ".concat(j?"bg-secondary text-bg font-bold":"bg-btn hover:bg-btn-hover"),children:"Gov"}),(0,n.jsx)("div",{className:"flex-1"}),(0,n.jsxs)("span",{className:"text-xs text-muted font-mono",children:[F," agents"]}),(0,n.jsx)("button",{onClick:A,className:"px-2 py-1.5 text-xs rounded bg-btn hover:bg-btn-hover transition-colors",title:"Save game",children:"Save"}),(0,n.jsx)("button",{onClick:f,className:"px-2 py-1.5 text-xs rounded bg-red-900/50 hover:bg-red-900/70 text-red-300 transition-colors",children:"End"})]}),j&&(0,n.jsx)("div",{className:"border-t border-border px-4 py-3 bg-panel",children:(0,n.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-xs",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-muted block mb-1",children:"Tax Rate"}),(0,n.jsx)("input",{type:"range",min:0,max:.5,step:.01,value:T.taxRate,onChange:e=>p({taxRate:parseFloat(e.target.value)}),className:"w-full h-1 accent-accent"}),(0,n.jsx)("span",{className:"font-mono text-muted",children:T.taxRate.toFixed(2)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-muted block mb-1",children:"Rep. Decay"}),(0,n.jsx)("input",{type:"range",min:.8,max:1,step:.01,value:T.reputationDecay,onChange:e=>p({reputationDecay:parseFloat(e.target.value)}),className:"w-full h-1 accent-accent"}),(0,n.jsx)("span",{className:"font-mono text-muted",children:T.reputationDecay.toFixed(2)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-muted block mb-1",children:"Circuit Breaker"}),(0,n.jsx)("button",{onClick:()=>p({circuitBreakerEnabled:!T.circuitBreakerEnabled}),className:"px-2 py-0.5 rounded text-xs ".concat(T.circuitBreakerEnabled?"bg-accent text-bg":"bg-btn"),children:T.circuitBreakerEnabled?"ON":"OFF"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-muted block mb-1",children:"CB Threshold"}),(0,n.jsx)("input",{type:"range",min:.1,max:.6,step:.05,value:T.circuitBreakerThreshold,onChange:e=>p({circuitBreakerThreshold:parseFloat(e.target.value)}),className:"w-full h-1 accent-accent"}),(0,n.jsx)("span",{className:"font-mono text-muted",children:T.circuitBreakerThreshold.toFixed(2)})]})]})})]})}function ex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Math.abs(e)>=1e3?e.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,","):e.toFixed(t)}function ev(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(100*e).toFixed(t)+"%"}function eb(){let{selectedAgent:e,agents:t,setSelected:a,agentSnapshots:o,currentEpoch:i}=(0,N.$)(),{state:s,toggleFreeze:l,toggleQuarantine:c,removeAgent:d,spawnAgent:u}=P(),h=t.find(t=>t.id===e),p=(0,r.useMemo)(()=>(null==o?void 0:o.length)&&h?o.filter(e=>e.agent_id===h.id).sort((e,t)=>e.epoch-t.epoch):[],[o,h]),f=(0,r.useMemo)(()=>p.map(e=>e.reputation),[p]),g=(0,r.useMemo)(()=>p.map(e=>e.total_payoff),[p]),m=(0,r.useMemo)(()=>p.map(e=>e.avg_p_initiated),[p]);if(!h)return null;let x=A.FJ[h.agentType],v=h.interactionsInitiated+h.interactionsReceived,b=v>0?h.interactionsInitiated/v:.5;return(0,n.jsxs)("div",{className:"absolute top-4 left-4 w-72 bg-panel border border-border rounded-lg shadow-lg z-20 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:x.secondary}}),(0,n.jsx)("span",{className:"font-semibold text-sm",children:h.name})]}),(0,n.jsx)("button",{onClick:()=>a(null),className:"text-muted hover:text-text transition-colors text-lg leading-none",children:"x"})]}),(0,n.jsxs)("div",{className:"px-4 py-2 border-b border-border flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full",style:{backgroundColor:x.primary,color:x.accent},children:A.gp[h.agentType]}),(0,n.jsx)("span",{className:"text-xs text-muted",children:h.agentType}),h.isFrozen&&(0,n.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-900/50 text-blue-300",children:"FROZEN"}),h.isQuarantined&&(0,n.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-red-900/50 text-red-300",children:"QUARANTINED"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-px bg-border",children:[(0,n.jsx)(ew,{label:"Reputation",value:ex(h.reputation,3),sparkline:f,color:x.secondary}),(0,n.jsx)(ew,{label:"Resources",value:ex(h.resources,1)}),(0,n.jsx)(ew,{label:"Total Payoff",value:ex(h.totalPayoff,2),sparkline:g}),(0,n.jsx)(ew,{label:"Avg P",value:ev(h.avgP),sparkline:m,color:h.avgP>.6?"#6FCF97":h.avgP>.3?"#F2994A":"#EB5757"}),(0,n.jsx)(ew,{label:"Initiated",value:String(h.interactionsInitiated)}),(0,n.jsx)(ew,{label:"Received",value:String(h.interactionsReceived)})]}),v>0&&(0,n.jsxs)("div",{className:"px-4 py-2 border-t border-border",children:[(0,n.jsx)("div",{className:"text-[10px] text-muted uppercase tracking-wider mb-1",children:"Activity Balance"}),(0,n.jsxs)("div",{className:"flex h-2 rounded-full overflow-hidden bg-black/30",children:[(0,n.jsx)("div",{className:"transition-all duration-300",style:{width:"".concat(100*b,"%"),backgroundColor:x.secondary}}),(0,n.jsx)("div",{className:"transition-all duration-300",style:{width:"".concat((1-b)*100,"%"),backgroundColor:x.primary}})]}),(0,n.jsxs)("div",{className:"flex justify-between text-[9px] text-muted mt-0.5",children:[(0,n.jsxs)("span",{children:["Initiated ",ev(b)]}),(0,n.jsxs)("span",{children:["Received ",ev(1-b)]})]})]}),s.isLive&&(0,n.jsxs)("div",{className:"px-4 py-2 border-t border-border flex gap-1.5 flex-wrap",children:[(0,n.jsx)("button",{onClick:()=>l(h.id),className:"text-[10px] px-2 py-1 rounded transition-colors ".concat(h.isFrozen?"bg-blue-900/50 text-blue-300 hover:bg-blue-900/70":"bg-btn hover:bg-btn-hover text-muted"),children:h.isFrozen?"Unfreeze":"Freeze"}),(0,n.jsx)("button",{onClick:()=>c(h.id),className:"text-[10px] px-2 py-1 rounded transition-colors ".concat(h.isQuarantined?"bg-red-900/50 text-red-300 hover:bg-red-900/70":"bg-btn hover:bg-btn-hover text-muted"),children:h.isQuarantined?"Release":"Quarantine"}),(0,n.jsx)("button",{onClick:()=>u(h.agentType),className:"text-[10px] px-2 py-1 rounded bg-btn hover:bg-btn-hover text-muted transition-colors",children:"Clone"}),(0,n.jsx)("button",{onClick:()=>{d(h.id),a(null)},className:"text-[10px] px-2 py-1 rounded bg-red-950/50 hover:bg-red-900/50 text-red-400 transition-colors",children:"Remove"})]}),(0,n.jsxs)("div",{className:"px-4 py-1.5 border-t border-border text-[10px] text-muted text-center",children:["Epoch ",i," | Power: ",(100*h.scale).toFixed(0),"%"]})]})}function ey(e){let{data:t,color:a="#3ECFB4",width:r=48,height:o=16}=e;if(t.length<2)return null;let i=Math.min(...t),s=Math.max(...t)-i||1,l=t.map((e,a)=>{let n=a/(t.length-1)*r;return"".concat(n,",").concat(o-(e-i)/s*(o-2)-1)}).join(" ");return(0,n.jsx)("svg",{width:r,height:o,className:"inline-block ml-1 align-middle",children:(0,n.jsx)("polyline",{points:l,fill:"none",stroke:a,strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round"})})}function ew(e){let{label:t,value:a,color:r,sparkline:o}=e;return(0,n.jsxs)("div",{className:"bg-panel px-3 py-2",children:[(0,n.jsx)("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:t}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-0.5",children:[(0,n.jsx)("span",{className:"text-sm font-mono",style:r?{color:r}:void 0,children:a}),o&&o.length>1&&(0,n.jsx)(ey,{data:o,color:r||"#3ECFB4"})]})]})}function e_(){var e,t,a;let{data:o,currentEpochSnap:i,overlays:s,currentEpoch:l}=(0,N.$)(),c=(0,r.useMemo)(()=>{if(!o)return{toxicity:[],avgP:[],gini:[],welfare:[]};let e=o.epoch_snapshots.slice(0,l+1);return{toxicity:e.map(e=>e.toxicity_rate),avgP:e.map(e=>e.avg_p),gini:e.map(e=>e.gini_coefficient),welfare:e.map(e=>e.total_welfare)}},[o,l]);return s.metricsHud&&i&&o?(0,n.jsxs)("div",{className:"absolute top-4 right-4 w-56 bg-panel border border-border rounded-lg shadow-lg z-20 text-xs",children:[(0,n.jsxs)("div",{className:"px-3 py-2 border-b border-border",children:[(0,n.jsxs)("span",{className:"text-muted",children:["Epoch ",i.epoch]}),(0,n.jsxs)("span",{className:"text-muted float-right",children:[i.n_agents," agents"]})]}),(0,n.jsxs)("div",{className:"p-3 space-y-2.5",children:[(0,n.jsx)(eS,{label:"Toxicity",value:ev(i.toxicity_rate),color:i.toxicity_rate>.3?"#EB5757":i.toxicity_rate>.15?"#F2994A":"#6FCF97",sparkline:c.toxicity}),(0,n.jsx)(eS,{label:"Avg P",value:ex(i.avg_p,3),color:z(i.avg_p),sparkline:c.avgP}),(0,n.jsx)(eS,{label:"Quality Gap",value:ex(i.quality_gap,3),color:i.quality_gap<0?"#EB5757":"#6FCF97"}),(0,n.jsx)(eS,{label:"Gini",value:ex(i.gini_coefficient,3),color:i.gini_coefficient>.4?"#EB5757":"#F2994A",sparkline:c.gini}),(0,n.jsx)(eS,{label:"Total Welfare",value:ex(i.total_welfare,1),sparkline:c.welfare}),(0,n.jsxs)("div",{className:"border-t border-border pt-2 mt-2",children:[(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Interactions"}),(0,n.jsx)("span",{className:"font-mono",children:i.total_interactions})]}),(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Accepted"}),(0,n.jsx)("span",{className:"font-mono text-accent",children:i.accepted_interactions})]}),(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Rejected"}),(0,n.jsx)("span",{className:"font-mono text-alert",children:i.rejected_interactions})]})]}),(null!=(e=i.ecosystem_threat_level)?e:0)>0&&(0,n.jsx)("div",{className:"border-t border-border pt-2",children:(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Threat Level"}),(0,n.jsx)("span",{className:"font-mono",style:{color:(null!=(t=i.ecosystem_threat_level)?t:0)>.5?"#EB5757":"#F2994A"},children:ev(null!=(a=i.ecosystem_threat_level)?a:0)})]})}),i.n_frozen>0&&(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Frozen"}),(0,n.jsx)("span",{className:"font-mono",style:{color:"#A8CFF5"},children:i.n_frozen})]}),i.n_quarantined>0&&(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Quarantined"}),(0,n.jsx)("span",{className:"font-mono text-alert",children:i.n_quarantined})]})]})]}):null}function eS(e){let{label:t,value:a,color:r,sparkline:o}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-muted",children:t}),(0,n.jsx)("span",{className:"font-mono",style:r?{color:r}:void 0,children:a})]}),o&&o.length>1&&(0,n.jsx)(ek,{data:o,color:null!=r?r:"#3ECFB4"})]})}function ek(e){let{data:t,color:a}=e,r=Math.min(...t),o=Math.max(...t)-r||1,i=t.map((e,a)=>{let n=a/(t.length-1)*200;return"".concat(n,",").concat(16-(e-r)/o*14-1)});return(0,n.jsx)("svg",{width:"100%",height:16,viewBox:"0 0 ".concat(200," ").concat(16),preserveAspectRatio:"none",className:"mt-0.5",children:(0,n.jsx)("polyline",{points:i.join(" "),fill:"none",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.6"})})}function ej(){let e=(0,r.useRef)(null),{agents:t,overlays:a,viewport:o}=(0,N.$)(),{handlePan:i}=R();return((0,r.useEffect)(()=>{if(!a.minimap)return;let n=e.current;if(!n)return;let r=n.getContext("2d");if(!r)return;let i=devicePixelRatio;n.width=140*i,n.height=140*i,r.scale(i,i);let s=0,l=0,c=100,d=100;for(let e of t){let t=(0,F.Gs)(e.gridX,e.gridY);s=Math.min(s,t.x-40),l=Math.min(l,t.y-100),c=Math.max(c,t.x+40),d=Math.max(d,t.y+40)}let u=c-s||1,h=d-l||1,p=.85*Math.min(140/u,140/h),f=(140-u*p)/2,g=(140-h*p)/2;for(let e of(r.fillStyle=L(A.lm.bg,.9),r.fillRect(0,0,140,140),t)){let t=(0,F.Gs)(e.gridX,e.gridY),a=(t.x-s)*p+f,n=(t.y-l)*p+g;r.fillStyle=A.FJ[e.agentType].secondary,r.beginPath(),r.arc(a,n,3,0,2*Math.PI),r.fill()}let m=(-o.x/o.zoom-s)*p+f,x=(-o.y/o.zoom-l)*p+g,v=o.width/o.zoom*p,b=o.height/o.zoom*p;r.strokeStyle=A.lm.accent,r.lineWidth=1,r.strokeRect(m,x,v,b),r.strokeStyle=A.lm.border,r.lineWidth=1,r.strokeRect(0,0,140,140)},[t,a.minimap,o]),a.minimap)?(0,n.jsx)("canvas",{ref:e,className:"absolute bottom-16 right-4 rounded border border-border z-20 cursor-pointer",style:{width:140,height:140}}):null}var eC=a(7442);let eM=[{name:"Adversarial Takeover",description:"5 adversarial agents overwhelm 2 honest ones. Can governance hold?",config:{agents:[{type:"honest",count:2},{type:"opportunistic",count:0},{type:"deceptive",count:1},{type:"adversarial",count:5}],governance:{taxRate:.02,reputationDecay:.98,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:30,stepsPerEpoch:15}},{name:"Governance Stress Test",description:"High tax + aggressive circuit breaker vs. mixed bad actors.",config:{agents:[{type:"honest",count:3},{type:"opportunistic",count:2},{type:"deceptive",count:2},{type:"adversarial",count:2}],governance:{taxRate:.3,reputationDecay:.88,circuitBreakerEnabled:!0,circuitBreakerThreshold:.25},epochs:40,stepsPerEpoch:20}},{name:"Market Collapse",description:"No governance, high harm. Deceptive agents exploit freely.",config:{agents:[{type:"honest",count:2},{type:"opportunistic",count:3},{type:"deceptive",count:3},{type:"adversarial",count:0}],governance:{taxRate:0,reputationDecay:1,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},payoff:{s_plus:2,s_minus:1,h:4,theta:.5,rho_a:0,rho_b:0,w_rep:.5},epochs:50,stepsPerEpoch:15}},{name:"Utopian Baseline",description:"All honest agents, moderate governance. How good can it get?",config:{agents:[{type:"honest",count:6},{type:"opportunistic",count:0},{type:"deceptive",count:0},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:20,stepsPerEpoch:10}},{name:"Externality Pricing",description:"Agents internalize harm costs. Does it deter bad behavior?",config:{agents:[{type:"honest",count:3},{type:"opportunistic",count:2},{type:"deceptive",count:2},{type:"adversarial",count:1}],payoff:{s_plus:2,s_minus:1,h:2,theta:.5,rho_a:.5,rho_b:.5,w_rep:1},governance:{taxRate:.1,reputationDecay:.92,circuitBreakerEnabled:!0,circuitBreakerThreshold:.35},epochs:40,stepsPerEpoch:15}}];function eT(e){let{label:t,value:a,min:r,max:o,step:i,onChange:s,format:l}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-28 shrink-0",children:t}),(0,n.jsx)("input",{type:"range",min:r,max:o,step:i,value:a,onChange:e=>s(parseFloat(e.target.value)),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-12 text-right",children:l?l(a):a})]})}function eP(e){let{title:t,collapsible:a,children:o}=e,[i,s]=(0,r.useState)(!a);return(0,n.jsxs)("div",{className:"border-t border-border pt-3 mt-3 first:border-0 first:pt-0 first:mt-0",children:[(0,n.jsxs)("button",{onClick:a?()=>s(!i):void 0,className:"text-xs font-bold uppercase tracking-wider mb-2 flex items-center gap-1 ".concat(a?"cursor-pointer hover:text-accent":"cursor-default"),children:[a&&(0,n.jsx)("span",{className:"text-muted",children:i?"▼":"▶"}),t]}),i&&(0,n.jsx)("div",{className:"space-y-2",children:o})]})}function eN(e){let{data:t,color:a,label:r,value:o}=e;if(t.length<2)return null;let i=Math.min(...t),s=Math.max(...t)-i||1,l=t.map((e,a)=>"".concat(a/(t.length-1)*80,",").concat(20-(e-i)/s*18-1)).join(" ");return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-16 shrink-0",children:r}),(0,n.jsx)("svg",{width:80,height:20,viewBox:"0 0 ".concat(80," ").concat(20),preserveAspectRatio:"none",className:"shrink-0",children:(0,n.jsx)("polyline",{points:l,fill:"none",stroke:a,strokeWidth:"1.5",opacity:"0.7"})}),(0,n.jsx)("span",{className:"text-xs font-mono",style:{color:a},children:o})]})}function eE(e){var t;let{onComplete:o}=e,[i,s]=(0,r.useState)({...w}),{status:l,progress:c,error:d,result:u,run:p}=function(){let[e,t]=(0,r.useState)("idle"),[n,o]=(0,r.useState)(0),[i,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),d=(0,r.useRef)(!1);return{status:e,progress:n,error:i,result:l,run:(0,r.useCallback)(e=>{return t("running"),o(0),s(null),c(null),d.current=!1,new Promise(r=>{try{let i=new Worker(a.tu(new URL(a.p+a.u(803),a.b)),{type:void 0});i.onmessage=e=>{let a=e.data;"progress"===a.type?o(a.epoch/a.totalEpochs):"complete"===a.type?(t("done"),o(1),c(a.data),i.terminate(),r(a.data)):"error"===a.type&&(t("error"),s(a.message),i.terminate(),r(null))},i.onerror=()=>{i.terminate(),n(e,r)},ec={...e},i.postMessage({type:"run",config:e})}catch(t){n(e,r)}});function n(e,a){try{let n=ed(e,(e,t)=>{o(e/t)});t("done"),o(1),c(n),a(n)}catch(e){t("error"),s(e instanceof Error?e.message:String(e)),a(null)}}},[]),cancel:(0,r.useCallback)(()=>{d.current=!0,t("idle")},[])}}(),[f,g]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[v,b]=(0,r.useState)(!1),y=(0,r.useCallback)(e=>{s({...w,...e.config,governance:{...w.governance,...e.config.governance},payoff:{...w.payoff,...e.config.payoff}}),g(e.name),b(!1)},[]),_=(0,r.useCallback)((e,t)=>{g(null),b(!1),s(a=>{let n=[...a.agents];return n[e]={...n[e],count:t},{...a,agents:n}})},[]),S=(0,r.useCallback)((e,t)=>{g(null),b(!1),s(a=>({...a,governance:{...a.governance,[e]:t}}))},[]),k=(0,r.useCallback)((e,t)=>{g(null),b(!1),s(a=>({...a,payoff:{...a.payoff,[e]:t}}))},[]),j=(0,r.useCallback)(async()=>{if(2>i.agents.reduce((e,t)=>e+t.count,0))return void alert("Need at least 2 agents to run a simulation.");b(!1),await p(i)&&b(!0)},[i,p]),C=(0,r.useCallback)(()=>{u&&o(u)},[u,o]),M="running"===l,T=(0,r.useMemo)(()=>{if(!u)return null;let e=u.epoch_snapshots,t=e[e.length-1];return{toxicity:e.map(e=>e.toxicity_rate),gini:e.map(e=>e.gini_coefficient),avgP:e.map(e=>e.avg_p),welfare:e.map(e=>e.total_welfare),finalToxicity:t.toxicity_rate,finalGini:t.gini_coefficient,finalAvgP:t.avg_p,finalWelfare:t.total_welfare}},[u]);return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)(eP,{title:"Presets",children:[(0,n.jsx)("div",{className:"grid grid-cols-2 gap-1.5",children:eM.map(e=>(0,n.jsx)("button",{onClick:()=>y(e),title:e.description,className:"text-left px-2 py-1.5 rounded text-xs transition-colors ".concat(f===e.name?"bg-accent text-bg font-bold":"bg-btn hover:bg-btn-hover"),children:e.name},e.name))}),f&&(0,n.jsx)("p",{className:"text-xs text-muted italic mt-1",children:null==(t=eM.find(e=>e.name===f))?void 0:t.description})]}),(0,n.jsxs)(eP,{title:"Agents",children:[i.agents.map((e,t)=>(0,n.jsx)("div",{onMouseEnter:()=>x(e.type),onMouseLeave:()=>x(null),children:(0,n.jsx)(eT,{label:e.type.charAt(0).toUpperCase()+e.type.slice(1),value:e.count,min:0,max:10,step:1,onChange:e=>_(t,e)})},e.type)),(0,n.jsxs)("p",{className:"text-xs text-muted",children:["Total: ",i.agents.reduce((e,t)=>e+t.count,0)," agents"]}),m&&h.n[m]&&(()=>{let e=h.n[m];return(0,n.jsxs)("div",{className:"bg-bg border border-border rounded px-2.5 py-2 text-xs space-y-0.5 mt-1",children:[(0,n.jsxs)("div",{className:"font-bold text-text mb-1",children:[m.charAt(0).toUpperCase()+m.slice(1)," Profile"]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted",children:"Progress"}),(0,n.jsxs)("span",{className:"font-mono",children:[e.progressMean>0?"+":"",e.progressMean.toFixed(1)," \\u00B1",e.progressStd.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted",children:"Rework risk"}),(0,n.jsxs)("span",{className:"font-mono",children:[(100*e.reworkProb).toFixed(0),"%"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted",children:"Rejection risk"}),(0,n.jsxs)("span",{className:"font-mono",children:[(100*e.rejectionProb).toFixed(0),"%"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted",children:"Engagement"}),(0,n.jsxs)("span",{className:"font-mono",children:[e.engagementMean>0?"+":"",e.engagementMean.toFixed(1)]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{className:"text-muted",children:"Disposition"}),(0,n.jsxs)("span",{className:"font-mono",style:{color:e.disposition>.3?"#6FCF97":e.disposition<0?"#EB5757":"#F2994A"},children:[e.disposition>0?"+":"",e.disposition.toFixed(1)]})]})]})})()]}),(0,n.jsxs)(eP,{title:"Governance",children:[(0,n.jsx)(eT,{label:"Tax rate",value:i.governance.taxRate,min:0,max:.5,step:.01,onChange:e=>S("taxRate",e),format:e=>e.toFixed(2)}),(0,n.jsx)(eT,{label:"Rep. decay",value:i.governance.reputationDecay,min:.8,max:1,step:.01,onChange:e=>S("reputationDecay",e),format:e=>e.toFixed(2)}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-28 shrink-0",children:"Circuit breaker"}),(0,n.jsx)("button",{onClick:()=>S("circuitBreakerEnabled",!i.governance.circuitBreakerEnabled),className:"px-2 py-0.5 rounded text-xs ".concat(i.governance.circuitBreakerEnabled?"bg-accent text-bg":"bg-btn"),children:i.governance.circuitBreakerEnabled?"ON":"OFF"}),i.governance.circuitBreakerEnabled&&(0,n.jsxs)("span",{className:"text-xs text-muted",children:["@ ",i.governance.circuitBreakerThreshold]})]})]}),(0,n.jsxs)(eP,{title:"Payoff Parameters",collapsible:!0,children:[(0,n.jsx)(eT,{label:"s_plus",value:i.payoff.s_plus,min:0,max:5,step:.1,onChange:e=>k("s_plus",e),format:e=>e.toFixed(1)}),(0,n.jsx)(eT,{label:"s_minus",value:i.payoff.s_minus,min:0,max:5,step:.1,onChange:e=>k("s_minus",e),format:e=>e.toFixed(1)}),(0,n.jsx)(eT,{label:"h (harm)",value:i.payoff.h,min:0,max:5,step:.1,onChange:e=>k("h",e),format:e=>e.toFixed(1)}),(0,n.jsx)(eT,{label:"theta",value:i.payoff.theta,min:0,max:1,step:.05,onChange:e=>k("theta",e),format:e=>e.toFixed(2)}),(0,n.jsx)(eT,{label:"rho_a",value:i.payoff.rho_a,min:0,max:1,step:.05,onChange:e=>k("rho_a",e),format:e=>e.toFixed(2)}),(0,n.jsx)(eT,{label:"rho_b",value:i.payoff.rho_b,min:0,max:1,step:.05,onChange:e=>k("rho_b",e),format:e=>e.toFixed(2)})]}),(0,n.jsxs)(eP,{title:"Simulation",collapsible:!0,children:[(0,n.jsx)(eT,{label:"Epochs",value:i.epochs,min:5,max:100,step:5,onChange:e=>s(t=>({...t,epochs:e}))}),(0,n.jsx)(eT,{label:"Steps/epoch",value:i.stepsPerEpoch,min:5,max:50,step:5,onChange:e=>s(t=>({...t,stepsPerEpoch:e}))}),(0,n.jsx)(eT,{label:"Seed",value:i.seed,min:1,max:9999,step:1,onChange:e=>s(t=>({...t,seed:e}))})]}),(0,n.jsxs)("div",{className:"pt-3 mt-3 border-t border-border",children:[v&&T?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-1.5 mb-3",children:[(0,n.jsx)(eN,{data:T.toxicity,color:T.finalToxicity>.3?"#EB5757":"#6FCF97",label:"Toxicity",value:(100*T.finalToxicity).toFixed(0)+"%"}),(0,n.jsx)(eN,{data:T.avgP,color:"#3ECFB4",label:"Avg P",value:T.finalAvgP.toFixed(3)}),(0,n.jsx)(eN,{data:T.gini,color:T.finalGini>.4?"#EB5757":"#F2994A",label:"Gini",value:T.finalGini.toFixed(3)}),(0,n.jsx)(eN,{data:T.welfare,color:"#5698FF",label:"Welfare",value:T.finalWelfare.toFixed(1)})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:C,className:"flex-1 py-2 rounded font-bold text-sm bg-accent text-bg hover:opacity-90 transition-opacity",children:"View in City"}),(0,n.jsx)("button",{onClick:j,className:"px-3 py-2 rounded font-bold text-sm bg-btn hover:bg-btn-hover transition-colors",children:"Re-run"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:j,disabled:M,className:"w-full py-2 rounded font-bold text-sm bg-accent text-bg hover:opacity-90 disabled:opacity-50 transition-opacity",children:M?"Running...":"Run Simulation"}),M&&(0,n.jsx)("div",{className:"mt-2 h-1.5 bg-btn rounded overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-accent transition-all duration-200",style:{width:"".concat(Math.round(100*c),"%")}})})]}),d&&(0,n.jsx)("p",{className:"text-xs text-red-400 mt-2",children:d})]})]})}function eF(e){let{onSelect:t}=e,[a]=(0,r.useState)({...w}),[o,i]=(0,r.useState)(0),[s,l]=(0,r.useState)(.2),[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(!0),[p,f]=(0,r.useState)(null),[g,m]=(0,r.useState)(!1),x=(0,r.useCallback)(()=>{m(!0),setTimeout(()=>{let e={...a,governance:{...a.governance,taxRate:o,circuitBreakerEnabled:c}},t={...a,governance:{...a.governance,taxRate:s,circuitBreakerEnabled:u}};f({a:ed(e),b:ed(t)}),m(!1)},10)},[a,o,s,c,u]),v=(0,r.useMemo)(()=>{if(!p)return null;let e=p.a.epoch_snapshots[p.a.epoch_snapshots.length-1],t=p.b.epoch_snapshots[p.b.epoch_snapshots.length-1];return{a:{toxicity:e.toxicity_rate,gini:e.gini_coefficient,avgP:e.avg_p,welfare:e.total_welfare},b:{toxicity:t.toxicity_rate,gini:t.gini_coefficient,avgP:t.avg_p,welfare:t.total_welfare}}},[p]);return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("p",{className:"text-xs text-muted",children:["Compare two governance configs on the same seed (",a.seed,")."]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{className:"bg-bg border border-border rounded p-2 space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-bold text-accent",children:"Config A"}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-12",children:"Tax"}),(0,n.jsx)("input",{type:"range",min:0,max:.5,step:.01,value:o,onChange:e=>i(parseFloat(e.target.value)),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-8",children:o.toFixed(2)})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-12",children:"CB"}),(0,n.jsx)("button",{onClick:()=>d(!c),className:"px-1.5 py-0.5 rounded text-xs ".concat(c?"bg-accent text-bg":"bg-btn"),children:c?"ON":"OFF"})]})]}),(0,n.jsxs)("div",{className:"bg-bg border border-border rounded p-2 space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-bold text-secondary",children:"Config B"}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-12",children:"Tax"}),(0,n.jsx)("input",{type:"range",min:0,max:.5,step:.01,value:s,onChange:e=>l(parseFloat(e.target.value)),className:"flex-1 h-1 accent-secondary"}),(0,n.jsx)("span",{className:"text-xs font-mono w-8",children:s.toFixed(2)})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-12",children:"CB"}),(0,n.jsx)("button",{onClick:()=>h(!u),className:"px-1.5 py-0.5 rounded text-xs ".concat(u?"bg-secondary text-bg":"bg-btn"),children:u?"ON":"OFF"})]})]})]}),(0,n.jsx)("button",{onClick:x,disabled:g,className:"w-full py-2 rounded font-bold text-sm bg-accent text-bg hover:opacity-90 disabled:opacity-50 transition-opacity",children:g?"Running...":"Compare"}),v&&p&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eR,{label:"Toxicity",a:v.a.toxicity,b:v.b.toxicity,format:e=>(100*e).toFixed(0)+"%",lower:!0}),(0,n.jsx)(eR,{label:"Avg P",a:v.a.avgP,b:v.b.avgP,format:e=>e.toFixed(3)}),(0,n.jsx)(eR,{label:"Gini",a:v.a.gini,b:v.b.gini,format:e=>e.toFixed(3),lower:!0}),(0,n.jsx)(eR,{label:"Welfare",a:v.a.welfare,b:v.b.welfare,format:e=>e.toFixed(1)}),(0,n.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,n.jsx)("button",{onClick:()=>t(p.a),className:"flex-1 py-1.5 rounded text-xs font-bold bg-btn hover:bg-btn-hover transition-colors",children:"View A"}),(0,n.jsx)("button",{onClick:()=>t(p.b),className:"flex-1 py-1.5 rounded text-xs font-bold bg-btn hover:bg-btn-hover transition-colors",children:"View B"})]})]})]})}function eR(e){let{label:t,a,b:r,format:o,lower:i}=e,s=i?a<r:a>r,l=i?r<a:r>a;return(0,n.jsxs)("div",{className:"flex items-center text-xs",children:[(0,n.jsx)("span",{className:"text-muted w-16 shrink-0",children:t}),(0,n.jsx)("span",{className:"font-mono w-16 text-right ".concat(s?"text-accent font-bold":"text-muted"),children:o(a)}),(0,n.jsx)("span",{className:"text-muted mx-2",children:"vs"}),(0,n.jsx)("span",{className:"font-mono w-16 ".concat(l?"text-secondary font-bold":"text-muted"),children:o(r)})]})}let eA=[{key:"taxRate",label:"Tax Rate",min:0,max:.5},{key:"reputationDecay",label:"Rep. Decay",min:.8,max:1},{key:"rho_a",label:"Externality (rho_a)",min:0,max:1},{key:"s_plus",label:"Surplus (s_plus)",min:.5,max:5},{key:"h",label:"Harm (h)",min:0,max:5}];function eI(){let[e,t]=(0,r.useState)("taxRate"),[a,o]=(0,r.useState)(8),[i,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(!1),d=eA.find(t=>t.key===e),u=(0,r.useCallback)(()=>{c(!0),setTimeout(()=>{let t={...w},n=[];for(let r=0;r<a;r++){let o=d.min+(d.max-d.min)*(r/(a-1)),i=ed("taxRate"===e||"reputationDecay"===e?{...t,governance:{...t.governance,[e]:o}}:{...t,payoff:{...t.payoff,[e]:o}}),s=i.epoch_snapshots[i.epoch_snapshots.length-1];n.push({paramValue:o,toxicity:s.toxicity_rate,avgP:s.avg_p,gini:s.gini_coefficient,welfare:s.total_welfare})}s(n),c(!1)},10)},[e,a,d]);return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-xs text-muted",children:"Sweep one parameter across its range and compare outcomes."}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted shrink-0",children:"Parameter"}),(0,n.jsx)("select",{value:e,onChange:e=>{t(e.target.value),s(null)},className:"flex-1 bg-btn text-text text-xs rounded px-2 py-1 border border-border",children:eA.map(e=>(0,n.jsx)("option",{value:e.key,children:e.label},e.key))})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-14 shrink-0",children:"Steps"}),(0,n.jsx)("input",{type:"range",min:4,max:16,step:1,value:a,onChange:e=>o(parseInt(e.target.value)),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-6",children:a})]}),(0,n.jsx)("button",{onClick:u,disabled:l,className:"w-full py-2 rounded font-bold text-sm bg-accent text-bg hover:opacity-90 disabled:opacity-50 transition-opacity",children:l?"Sweeping...":"Run Sweep"}),i&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(eD,{label:"Toxicity",results:i,accessor:e=>e.toxicity,color:"#EB5757",paramLabel:d.label}),(0,n.jsx)(eD,{label:"Avg P",results:i,accessor:e=>e.avgP,color:"#3ECFB4",paramLabel:d.label}),(0,n.jsx)(eD,{label:"Gini",results:i,accessor:e=>e.gini,color:"#F2994A",paramLabel:d.label}),(0,n.jsx)(eD,{label:"Welfare",results:i,accessor:e=>e.welfare,color:"#5698FF",paramLabel:d.label})]})]})}function eD(e){let{label:t,results:a,accessor:r,color:o,paramLabel:i}=e,s=a.map(r),l=Math.min(...s),c=Math.max(...s),d=c-l||1;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between text-xs mb-0.5",children:[(0,n.jsx)("span",{className:"text-muted",children:t}),(0,n.jsxs)("span",{className:"font-mono text-muted",children:[l.toFixed(2)," - ",c.toFixed(2)]})]}),(0,n.jsx)("svg",{width:"100%",height:32,viewBox:"0 0 ".concat(200," ").concat(32),preserveAspectRatio:"none",className:"bg-bg rounded border border-border",children:a.map((e,s)=>{let c=200/a.length-2,u=(r(e)-l)/d*28+2,h=s/a.length*200+1;return(0,n.jsxs)("g",{children:[(0,n.jsx)("rect",{x:h,y:32-u,width:c,height:u,fill:o,opacity:"0.7",rx:"1"}),(0,n.jsxs)("title",{children:[i,": ",e.paramValue.toFixed(3)," → ",t,": ",r(e).toFixed(3)]})]},s)})})]})}let eB={easy:"#6FCF97",medium:"#F2994A",hard:"#EB5757",expert:"#9B51E0"};function eL(){let{state:e,startCampaignLevel:t}=P();return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-xs text-muted",children:"Complete challenges to master governance mechanics. Each level introduces new complexity."}),(0,n.jsx)("div",{className:"space-y-2",children:_.map(a=>{let r=!a.unlockAfter||e.completedLevels.includes(a.unlockAfter),o=e.completedLevels.includes(a.id);return(0,n.jsxs)("div",{className:"border rounded-lg p-3 transition-colors ".concat(r?"border-border hover:border-accent cursor-pointer":"border-border/50 opacity-50 cursor-not-allowed"," ").concat(o?"bg-green-950/20":"bg-panel"),onClick:()=>r&&t(a),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[o&&(0,n.jsx)("span",{className:"text-green-400 text-sm",children:"✓"}),!r&&(0,n.jsx)("span",{className:"text-muted text-sm",children:"\uD83D\uDD12"}),(0,n.jsx)("span",{className:"text-sm font-bold",children:a.name}),(0,n.jsx)("span",{className:"text-[10px] font-bold uppercase px-1.5 py-0.5 rounded-full ml-auto",style:{color:eB[a.difficulty],backgroundColor:"".concat(eB[a.difficulty],"20")},children:a.difficulty})]}),(0,n.jsx)("p",{className:"text-xs text-muted",children:a.description}),r&&(0,n.jsxs)("div",{className:"mt-2 text-[10px] text-muted space-y-0.5",children:[(0,n.jsxs)("div",{children:["Win: ",S(a.winCondition)]}),(0,n.jsxs)("div",{children:["Lose: ",k(a.loseCondition)]})]})]},a.id)})})]})}function ez(){var e;let{state:t,startCampaignLevel:a,stopGame:r}=P();if("won"!==t.levelStatus&&"lost"!==t.levelStatus)return null;let o="won"===t.levelStatus,i=t.currentLevel,s=i?_.findIndex(e=>e.id===i.id):-1,l=s>=0&&s<_.length-1?_[s+1]:null;return(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-[10002] bg-black/60 backdrop-blur-sm",children:(0,n.jsxs)("div",{className:"bg-panel border border-border rounded-xl p-8 max-w-sm w-full mx-4 shadow-2xl text-center",children:[(0,n.jsx)("div",{className:"text-5xl mb-4 ".concat(o?"text-green-400":"text-red-400"),children:o?"✓":"✗"}),(0,n.jsx)("h2",{className:"text-xl font-bold mb-2 ".concat(o?"text-green-400":"text-red-400"),children:o?"Level Complete!":"Level Failed"}),i&&(0,n.jsx)("p",{className:"text-sm text-muted mb-4",children:i.name}),!o&&i&&(0,n.jsx)("p",{className:"text-xs text-muted mb-4",children:null!=(e=i.hints[t.hintIndex])?e:i.hints[0]}),(0,n.jsxs)("div",{className:"flex gap-2 justify-center",children:[!o&&i&&(0,n.jsx)("button",{onClick:()=>a(i),className:"px-4 py-2 rounded bg-accent text-bg font-bold text-sm hover:opacity-90 transition-opacity",children:"Retry"}),o&&l&&(0,n.jsx)("button",{onClick:()=>a(l),className:"px-4 py-2 rounded bg-accent text-bg font-bold text-sm hover:opacity-90 transition-opacity",children:"Next Level"}),(0,n.jsx)("button",{onClick:r,className:"px-4 py-2 rounded bg-btn hover:bg-btn-hover text-sm transition-colors",children:"Back to Menu"})]})]})})}let eO={...w,agents:[{type:"honest",count:4},{type:"opportunistic",count:1},{type:"deceptive",count:0},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:50,stepsPerEpoch:10};function eG(){let{state:e,startRedTeam:t}=P();return(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-xs text-muted",children:"Start with a healthy system. Your goal: cause maximum emergent failure using shocks and agent spawning. The scoring rewards toxicity, inequality, negative welfare, and frozen agents."}),(0,n.jsxs)("div",{className:"bg-red-950/20 border border-red-900/40 rounded-lg p-3",children:[(0,n.jsx)("div",{className:"text-xs font-bold text-red-300 mb-2",children:"Scoring"}),(0,n.jsxs)("div",{className:"space-y-1 text-xs text-muted",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Max Toxicity"}),(0,n.jsx)("span",{className:"font-mono",children:"x30"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Max Gini"}),(0,n.jsx)("span",{className:"font-mono",children:"x20"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Negative Welfare"}),(0,n.jsx)("span",{className:"font-mono",children:"x0.5"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"Frozen Agents"}),(0,n.jsx)("span",{className:"font-mono",children:"x5"})]})]})]}),e.redTeamBestScore>0&&(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,n.jsx)("span",{className:"text-muted",children:"Your best score:"}),(0,n.jsx)("span",{className:"font-mono text-yellow-400 font-bold",children:e.redTeamBestScore.toFixed(1)})]}),(0,n.jsx)("button",{onClick:()=>t(eO),className:"w-full py-2 rounded font-bold text-sm bg-red-600 text-white hover:bg-red-500 transition-colors",children:"Start Red Team"})]})}let eW=[{key:"sandbox",label:"Sandbox",description:"Free-form simulation with live controls"},{key:"campaign",label:"Campaign",description:"Challenge levels with win/lose conditions"},{key:"redteam",label:"Red Team",description:"Cause maximum system failure"}];function eY(){let{startSandbox:e,loadGame:t}=P(),[a,o]=(0,r.useState)("sandbox"),[i,s]=(0,r.useState)({honest:3,opportunistic:1,deceptive:1,adversarial:0}),l=(0,r.useCallback)(()=>{let t={...w,agents:[{type:"honest",count:i.honest},{type:"opportunistic",count:i.opportunistic},{type:"deceptive",count:i.deceptive},{type:"adversarial",count:i.adversarial}]};if(2>Object.values(i).reduce((e,t)=>e+t,0))return void alert("Need at least 2 agents to start.");e(t)},[i,e]),c=(0,r.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{var a;let n=null==(a=e.target.files)?void 0:a[0];n&&t(await n.text())},e.click()},[t]);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"grid grid-cols-3 gap-1.5",children:eW.map(e=>(0,n.jsx)("button",{onClick:()=>o(e.key),className:"text-center px-2 py-2 rounded text-xs transition-colors ".concat(a===e.key?"bg-accent text-bg font-bold":"bg-btn hover:bg-btn-hover"),children:e.label},e.key))}),"sandbox"===a&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-xs text-muted",children:"Free sandbox — spawn agents, adjust governance, inject shocks in real-time."}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("div",{className:"text-xs font-bold uppercase tracking-wider",children:"Starting Agents"}),["honest","opportunistic","deceptive","adversarial"].map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-28 shrink-0 capitalize",children:e}),(0,n.jsx)("input",{type:"range",min:0,max:10,step:1,value:i[e],onChange:t=>s(a=>({...a,[e]:parseInt(t.target.value)})),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-6 text-right",children:i[e]})]},e)),(0,n.jsxs)("p",{className:"text-xs text-muted",children:["Total: ",Object.values(i).reduce((e,t)=>e+t,0)," agents"]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:l,className:"flex-1 py-2 rounded font-bold text-sm bg-accent text-bg hover:opacity-90 transition-opacity",children:"Start Sandbox"}),(0,n.jsx)("button",{onClick:c,className:"px-3 py-2 rounded text-sm bg-btn hover:bg-btn-hover transition-colors",title:"Load a saved game",children:"Load"})]})]}),"campaign"===a&&(0,n.jsx)(eL,{}),"redteam"===a&&(0,n.jsx)(eG,{})]})}let eq="/game-app",eX=[{name:"Strict Governance + Events (15 ep, step playback)",path:"".concat(eq,"/sample-data/strict-governance-history.json"),eventsPath:"".concat(eq,"/sample-data/strict-governance-events.jsonl")},{name:"Adversarial Red Team (75 epochs)",path:"".concat(eq,"/sample-data/adversarial-redteam-75.json")},{name:"RLM Governance Lag (50 epochs)",path:"".concat(eq,"/sample-data/rlm-governance-lag-50.json")},{name:"Collusion Detection (60 epochs)",path:"".concat(eq,"/sample-data/collusion-detection-60.json")},{name:"24-Agent Mixed Demo",path:"".concat(eq,"/sample-data/demo-history-24.json")},{name:"6-Agent Mixed Demo",path:"".concat(eq,"/sample-data/demo-history.json")}],eV=[{key:"game",label:"Game"},{key:"load",label:"Load"},{key:"simulate",label:"Simulate"},{key:"compare",label:"Compare"},{key:"sweep",label:"Sweep"}];function eH(){let{data:e,loadData:t}=(0,N.$)(),a=(0,r.useRef)(null),o=(0,r.useRef)(null),{state:i}=P(),[s,l]=(0,r.useState)("game"),[c,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),p=(0,r.useCallback)(e=>{(0,eu.recordToLeaderboard)(e),t(e)},[t]),f=(0,r.useCallback)(async(e,t)=>{try{let a=t?await (0,eC.OL)(e,t):await (0,eC.oi)(e);p(a)}catch(e){alert("Error loading file: ".concat(e instanceof Error?e.message:e))}},[p]),g=(0,r.useCallback)(async e=>{d(e),u&&await f(e,u)},[u,f]),m=(0,r.useCallback)(e=>{h(e)},[]),x=(0,r.useCallback)(async()=>{c&&await f(c,u)},[c,u,f]),v=(0,r.useCallback)(async(e,t)=>{try{let a=t?await (0,eC.OL)(e,t):await (0,eC.oi)(e);p(a)}catch(e){alert("Error loading sample: ".concat(e instanceof Error?e.message:e))}},[p]);return e||i.isLive?null:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-30 bg-bg",children:(0,n.jsxs)("div",{className:"bg-panel border border-border rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsx)("h1",{className:"text-xl font-bold mb-1",children:"SWARM Isometric Viewer"}),(0,n.jsx)("p",{className:"text-sm text-muted mb-4",children:"Visualize multi-agent simulation data as an interactive isometric city"}),(0,n.jsx)("div",{className:"flex gap-0.5 mb-4 bg-btn rounded-lg p-0.5",children:eV.map(e=>(0,n.jsx)("button",{onClick:()=>l(e.key),className:"flex-1 py-1.5 rounded text-xs font-bold transition-colors ".concat(s===e.key?"bg-panel text-text":"text-muted hover:text-text"),children:e.label},e.key))}),"load"===s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-accent transition-colors mb-3",onClick:()=>{var e;return null==(e=a.current)?void 0:e.click()},onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("border-accent")},onDragLeave:e=>{e.currentTarget.classList.remove("border-accent")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("border-accent");let t=e.dataTransfer.files[0];t&&g(t)},children:[(0,n.jsx)("div",{className:"text-3xl mb-2 text-accent",children:"+"}),(0,n.jsxs)("p",{className:"text-sm text-muted",children:["Drop a ",(0,n.jsx)("span",{className:"text-text font-mono",children:"history.json"})," here"]}),(0,n.jsx)("p",{className:"text-xs text-muted mt-1",children:"or click to browse"}),c&&(0,n.jsx)("p",{className:"text-xs text-accent mt-2 font-mono",children:c.name})]}),(0,n.jsx)("input",{ref:a,type:"file",accept:".json",className:"hidden",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&g(a)}}),(0,n.jsxs)("div",{className:"border border-dashed border-border rounded-lg p-3 text-center cursor-pointer hover:border-secondary transition-colors mb-3",onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()},onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("border-secondary")},onDragLeave:e=>{e.currentTarget.classList.remove("border-secondary")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("border-secondary");let t=e.dataTransfer.files[0];t&&m(t)},children:[(0,n.jsxs)("p",{className:"text-xs text-muted",children:["+ Attach ",(0,n.jsx)("span",{className:"text-text font-mono",children:"events.jsonl"}),(0,n.jsx)("span",{className:"text-muted/60 ml-1",children:"(optional, enables step playback)"})]}),u&&(0,n.jsx)("p",{className:"text-xs text-secondary mt-1 font-mono",children:u.name})]}),(0,n.jsx)("input",{ref:o,type:"file",accept:".jsonl",className:"hidden",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&m(a)}}),c&&(0,n.jsxs)("button",{onClick:x,className:"w-full py-2 rounded bg-accent text-bg font-bold text-sm hover:opacity-90 transition-opacity mb-4",children:["Load",u?" with Events":""]}),(0,n.jsxs)("div",{className:"border-t border-border pt-4",children:[(0,n.jsx)("p",{className:"text-xs text-muted mb-2",children:"Or load sample data:"}),(0,n.jsx)("div",{className:"space-y-2",children:eX.map(e=>(0,n.jsx)("button",{onClick:()=>v(e.path,e.eventsPath),className:"w-full text-left px-3 py-2 rounded bg-btn hover:bg-btn-hover transition-colors text-sm",children:e.name},e.path))})]})]}),"game"===s&&(0,n.jsx)(eY,{}),"simulate"===s&&(0,n.jsx)(eE,{onComplete:p}),"compare"===s&&(0,n.jsx)(eF,{onSelect:p}),"sweep"===s&&(0,n.jsx)(eI,{})]})})}let eK=[{key:"interactions",label:"Arcs"},{key:"metricsHud",label:"HUD"},{key:"particles",label:"FX"},{key:"minimap",label:"Map"},{key:"collusionLines",label:"Collusion"},{key:"threatZones",label:"Threats"},{key:"digitalRain",label:"Rain"},{key:"tierraStrip",label:"Memory"},{key:"networkWeb",label:"Network"}];function eU(){let{overlays:e,toggleOverlay:t,data:a}=(0,N.$)();return a?(0,n.jsx)("div",{className:"absolute bottom-24 left-4 flex flex-wrap gap-1 z-20 max-w-xs",children:eK.map(a=>{let{key:r,label:o}=a;return(0,n.jsx)("button",{onClick:()=>t(r),className:"px-2.5 py-1 text-[10px] rounded-full border transition-colors ".concat(e[r]?"bg-accent/20 border-accent/50 text-accent":"bg-btn border-border text-muted hover:text-text"),children:o},r)})}):null}function eQ(){let[e,t]=(0,r.useState)("enter"),a=(0,r.useCallback)(()=>{"done"!==e&&t("exit")},[e]);return((0,r.useEffect)(()=>{let e=setTimeout(()=>{t(e=>"enter"===e?"exit":e)},2500);return()=>clearTimeout(e)},[]),(0,r.useEffect)(()=>{if("exit"===e){let e=setTimeout(()=>t("done"),700);return()=>clearTimeout(e)}},[e]),"done"===e)?null:(0,n.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-bg cursor-pointer ".concat("exit"===e?"animate-[splash-exit_0.7s_ease-in_forwards]":""),onClick:a,children:(0,n.jsx)("img",{src:"".concat("/game-app","/splash.png"),alt:"SWARM",className:"w-64 h-64 object-contain ".concat("enter"===e?"animate-[splash-enter_0.8s_ease-out_forwards,splash-glow_1.7s_ease-in-out_0.8s_infinite]":"")})})}function eZ(e){return(100*e).toFixed(0)+"%"}let eJ={danger:{bg:"rgba(235,87,87,0.12)",border:"#EB5757",icon:"⚠"},warning:{bg:"rgba(242,153,74,0.12)",border:"#F2994A",icon:"▲"},info:{bg:"rgba(86,152,255,0.12)",border:"#5698FF",icon:"●"},success:{bg:"rgba(111,207,151,0.12)",border:"#6FCF97",icon:"✓"}};function e$(){var e;let{data:t,currentEpoch:a}=(0,N.$)(),o=(0,r.useMemo)(()=>t?function(e){let t=[],{epoch_snapshots:a,agent_snapshots:n}=e;for(let e=0;e<a.length;e++){let r=a[e],o=e>0?a[e-1]:null;if(o&&r.toxicity_rate>o.toxicity_rate+.15&&r.toxicity_rate>.2&&t.push({epoch:r.epoch,type:"danger",message:"Toxicity spike: ".concat(eZ(o.toxicity_rate)," → ").concat(eZ(r.toxicity_rate))}),o&&o.toxicity_rate<=.4&&r.toxicity_rate>.4&&t.push({epoch:r.epoch,type:"danger",message:"Toxicity crossed critical threshold (40%)"}),o&&r.n_frozen>o.n_frozen){let e=r.n_frozen-o.n_frozen;t.push({epoch:r.epoch,type:"warning",message:"Circuit breaker: ".concat(e," agent").concat(e>1?"s":""," frozen")})}if(o&&r.n_quarantined>o.n_quarantined){let e=r.n_quarantined-o.n_quarantined;t.push({epoch:r.epoch,type:"warning",message:"".concat(e," agent").concat(e>1?"s":""," quarantined")})}o&&o.quality_gap>=0&&r.quality_gap<-.05&&t.push({epoch:r.epoch,type:"danger",message:"Adverse selection detected (quality gap: ".concat(r.quality_gap.toFixed(3),")")}),o&&r.gini_coefficient>o.gini_coefficient+.1&&r.gini_coefficient>.3&&t.push({epoch:r.epoch,type:"warning",message:"Inequality rising: Gini ".concat(o.gini_coefficient.toFixed(2)," → ").concat(r.gini_coefficient.toFixed(2))}),o&&o.total_welfare>0&&r.total_welfare<0&&t.push({epoch:r.epoch,type:"danger",message:"Welfare collapsed below zero"}),o&&o.toxicity_rate>.3&&r.toxicity_rate<o.toxicity_rate-.1&&t.push({epoch:r.epoch,type:"success",message:"Recovery: toxicity ".concat(eZ(o.toxicity_rate)," → ").concat(eZ(r.toxicity_rate))}),r.accepted_interactions===r.total_interactions&&r.total_interactions>0&&r.avg_p>.7&&t.push({epoch:r.epoch,type:"success",message:"Perfect cooperation: all ".concat(r.total_interactions," interactions accepted")}),r.total_interactions>0&&r.rejected_interactions/r.total_interactions>.7&&t.push({epoch:r.epoch,type:"warning",message:"Trust breakdown: ".concat(Math.round(r.rejected_interactions/r.total_interactions*100),"% rejected")});let i=n.filter(e=>e.epoch===r.epoch),s=e>0?n.filter(t=>t.epoch===a[e-1].epoch):[];for(let e of i){let a=s.find(t=>t.agent_id===e.agent_id);a&&a.reputation>.3&&e.reputation<.1&&t.push({epoch:r.epoch,type:"info",message:"".concat(e.name||e.agent_id," reputation collapsed")})}}return t}(t):[],[t]),i=null!=(e=(0,r.useMemo)(()=>{let e=new Map,t=["danger","warning","info","success"];for(let a of o){let n=e.get(a.epoch);(!n||t.indexOf(a.type)<t.indexOf(n.type))&&e.set(a.epoch,a)}return e},[o]).get(a))?e:null;if(!i)return null;let s=eJ[i.type];return(0,n.jsx)("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-30 pointer-events-none animate-narrative-toast",children:(0,n.jsxs)("div",{className:"px-4 py-2.5 rounded-lg backdrop-blur-sm border text-sm font-medium shadow-lg",style:{background:s.bg,borderColor:s.border,color:s.border},children:[(0,n.jsx)("span",{className:"mr-2",children:s.icon}),(0,n.jsxs)("span",{className:"text-text",children:["Epoch ",i.epoch,":"]})," ",i.message]})},"".concat(i.epoch,"-").concat(i.message))}let e0={info:{bg:"bg-blue-900/80",border:"border-blue-700",text:"text-blue-200"},success:{bg:"bg-green-900/80",border:"border-green-700",text:"text-green-200"},warning:{bg:"bg-yellow-900/80",border:"border-yellow-700",text:"text-yellow-200"},error:{bg:"bg-red-900/80",border:"border-red-700",text:"text-red-200"}};function e1(){let{state:e,dispatch:t}=P();return((0,r.useEffect)(()=>{if(0===e.toasts.length)return;let a=e.toasts.map(e=>setTimeout(()=>{t({type:"REMOVE_TOAST",id:e.id})},Math.max(0,4e3-(Date.now()-e.timestamp))));return()=>a.forEach(clearTimeout)},[e.toasts,t]),0===e.toasts.length)?null:(0,n.jsx)("div",{className:"fixed top-16 right-4 z-[10001] space-y-2 pointer-events-none",children:e.toasts.map(e=>{var t;let a=null!=(t=e0[e.type])?t:e0.info;return(0,n.jsx)("div",{className:"".concat(a.bg," ").concat(a.border," ").concat(a.text," border rounded-lg px-4 py-2 text-sm shadow-lg backdrop-blur-sm animate-slide-in pointer-events-auto"),children:e.text},e.id)})})}var e2=a(8738);function e5(){return!function(){let{state:e,dispatch:t,interactionSystem:a,particleSystem:n,codeTrailSystem:i,digitalRainRef:s,recompileStateRef:l,agentPositions:c,agentsByEpoch:d}=(0,r.useContext)(o.X),{state:u,engineRef:h,checkConditions:p,dispatch:f,computeRedTeamScore:g}=P(),m=(0,r.useRef)(0),x=(0,r.useRef)(0),v=(0,r.useRef)(0),b=(0,r.useRef)(0),y=(0,r.useRef)(()=>{}),w=(0,r.useCallback)(r=>{var o;let w=h.current;if(!w||!u.isLive)return;let _=x.current?r-x.current:16;if(x.current=r,!u.isPaused){v.current+=_;let n=!1;for(;v.current>=u.tickRate;){v.current-=u.tickRate;let{event:e,epochCompleted:t}=w.tick();n=!0,e.accepted&&a.current.addFromEventsAtStep([e],w.epoch,w.step),t&&("campaign"===u.mode&&p(w.getEpochSnapshots()),"redteam"===u.mode&&f({type:"UPDATE_REDTEAM_SCORE",score:g()}),l.current={active:!0,startTime:Date.now(),duration:400,scanlineY:0})}if(n){let a=w.toSimulationData(),n=w.agents.map(e=>e.id),r=c.current,o=!1;for(let e of n)if(!r.has(e)){o=!0;break}o&&(c.current=(0,ei.D)(n)),d.current=(0,e2.y)(a.agent_snapshots),e.data&&e.data.simulation_id===a.simulation_id||t({type:"LOAD_DATA",data:a})}}a.current.update(_,w.epoch),n.current.update(_),i.current.update(_);let S=l.current;S.active&&Date.now()-S.startTime>S.duration&&(S.active=!1),!s.current&&e.viewport.width>0&&(s.current=$(e.viewport.width)),s.current&&ee(s.current,_,e.viewport.height,e.environment.threatLevel);let k=w.getCurrentEpochSnapshot(),j=null!=(o=d.current.get(w.epoch))?o:new Map,C=(0,ei.G)(j,j,0,c.current);if(r-b.current>500)for(let e of(b.current=r,C)){let t=(0,F.Gs)(e.gridX,e.gridY);e.isFrozen&&n.current.add(Z(t.x,t.y-56*e.scale,2)),e.isQuarantined&&n.current.add(J(t.x,t.y,2))}let M=es(k,k,0);t({type:"TICK",agents:C,arcs:a.current.arcs,environment:M,particles:n.current.particles,epoch:w.epoch,fraction:w.step/Math.max(w.config.stepsPerEpoch,1),epochSnap:k}),m.current=requestAnimationFrame(e=>y.current(e))},[u.isLive,u.isPaused,u.tickRate,u.mode,h,t,e.data,e.viewport.width,e.viewport.height,e.environment.threatLevel,a,n,i,s,l,c,d,p,g,f]);(0,r.useEffect)(()=>{y.current=w},[w]),(0,r.useEffect)(()=>(u.isLive&&(x.current=0,v.current=0,m.current=requestAnimationFrame(w)),()=>{m.current&&cancelAnimationFrame(m.current)}),[u.isLive,w])}(),null}var e3=a(6278),e4=a.n(e3);let e8={simulation_started:"#7D8590",simulation_ended:"#7D8590",epoch_completed:"#7D8590",agent_created:"#2F80ED",contract_signing:"#BB6BD9",interaction_proposed:"#3ECFB4",interaction_completed:"#3ECFB4",governance_cost_applied:"#F2994A",reputation_updated:"#6FCF97",payoff_computed:"#E6EDF3",contract_metrics:"#BB6BD9"},e6={interaction_proposed:"PROPOSE",interaction_completed:"COMPLETE",reputation_updated:"REP",governance_cost_applied:"GOV",payoff_computed:"PAYOFF",agent_created:"AGENT",contract_signing:"CONTRACT",epoch_completed:"EPOCH"};function e7(){let{data:e,eventIndex:t,currentEpoch:a,currentStep:o,stepPlayback:i}=(0,N.$)(),[s,l]=(0,r.useState)(!1),c=(0,r.useMemo)(()=>t&&i?t.eventsAt(a,o):[],[t,i,a,o]);return(null==e?void 0:e.rawEvents)&&0!==e.rawEvents.length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>l(e=>!e),className:"absolute top-2 right-2 z-[10001] px-2 py-1 text-xs rounded transition-colors ".concat(s?"bg-secondary text-bg font-bold":"bg-btn hover:bg-btn-hover text-muted"),children:"Events"}),s&&(0,n.jsxs)("div",{className:"absolute top-10 right-2 z-[10001] w-80 max-h-[50vh] bg-panel/95 border border-border rounded-lg overflow-hidden flex flex-col backdrop-blur-sm",children:[(0,n.jsxs)("div",{className:"px-3 py-2 border-b border-border text-xs text-muted font-mono",children:["Epoch ",a," / Step ",o," — ",c.length," events"]}),(0,n.jsx)("div",{className:"overflow-y-auto flex-1 p-1",children:0===c.length?(0,n.jsx)("div",{className:"text-xs text-muted/50 text-center py-4",children:"No events at this step"}):c.map((e,t)=>{var a;return(0,n.jsxs)("div",{className:"flex items-start gap-2 px-2 py-1 hover:bg-btn/50 rounded text-xs",children:[(0,n.jsx)("span",{className:"shrink-0 px-1 py-0.5 rounded font-mono text-[10px] leading-tight",style:{backgroundColor:e8[e.event_type]+"22",color:e8[e.event_type]},children:null!=(a=e6[e.event_type])?a:e.event_type.toUpperCase()}),(0,n.jsx)("span",{className:"text-muted truncate font-mono",children:function(e){var t,a,n,r;switch(e.event_type){case"interaction_proposed":return"".concat(e.initiator_id," -> ").concat(e.counterparty_id," (").concat(e.payload.interaction_type,")");case"interaction_completed":return"".concat(null==(t=e.interaction_id)?void 0:t.slice(0,8),"... ").concat(e.payload.accepted?"accepted":"rejected");case"reputation_updated":{let t=e.payload.delta,a=t>=0?"+":"";return"".concat(e.agent_id," ").concat(a).concat(t.toFixed(3))}case"governance_cost_applied":return"".concat(e.agent_id," cost=").concat(null!=(n=null==(a=e.payload.cost)?void 0:a.toFixed(2))?n:"?");case"payoff_computed":return"".concat(e.initiator_id," -> ").concat(e.counterparty_id);default:return null!=(r=e.agent_id)?r:""}}(e)})]},e.event_id||t)})})]})]}):null}let e9=e4()(()=>Promise.resolve().then(a.bind(a,3997)).then(e=>e.Leaderboard),{loadableGenerated:{webpack:()=>[3997]},ssr:!1});function te(){let{state:e}=P();return(0,n.jsxs)("div",{className:"relative w-screen h-screen overflow-hidden bg-bg",children:[e.isLive&&(0,n.jsx)(e5,{}),(0,n.jsx)("div",{className:"absolute inset-0",children:(0,n.jsx)(eo,{})}),(0,n.jsx)(eH,{}),(0,n.jsx)(eb,{}),(0,n.jsx)(e_,{}),(0,n.jsx)(e$,{}),(0,n.jsx)(ej,{}),(0,n.jsx)(e9,{}),(0,n.jsx)(eU,{}),(0,n.jsx)(e7,{}),(0,n.jsx)(e1,{}),(0,n.jsx)(ez,{}),e.isLive?(0,n.jsx)(em,{}):(0,n.jsx)(ef,{}),(0,n.jsx)(eQ,{})]})}function tt(){return(0,n.jsx)(o.n,{children:(0,n.jsx)(T,{children:(0,n.jsx)(te,{})})})}function ta(){return(0,n.jsx)(tt,{})}},1150:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let n=a(5155),r=a(2115),o=a(4437);function i(e){return{default:e&&"default"in e?e.default:e}}a(6552);let s={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},l=function(e){let t={...s,...e},a=(0,r.lazy)(()=>t.loader().then(i)),l=t.loading;function c(e){let i=l?(0,n.jsx)(l,{isLoading:!0,pastDelay:!0,error:null}):null,s=!t.ssr||!!t.loading,c=s?r.Suspense:r.Fragment,d=t.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(c,{...s?{fallback:i}:{},children:d})}return c.displayName="LoadableComponent",c}},1896:(e,t,a)=>{"use strict";a.d(t,{FB:()=>o,Fe:()=>d,LZ:()=>c,UT:()=>l,e4:()=>i,s_:()=>s});var n=a(8416),r=a(7380);function o(e,t){return{x:0,y:0,width:e,height:t,zoom:1}}function i(e,t,a){return{...e,x:e.x+t,y:e.y+a}}function s(e,t,a,o){let i=(0,r.qE)(e.zoom*(1-.001*t),n.DQ,n.nD),s=i/e.zoom;return{...e,zoom:i,x:a-(a-e.x)*s,y:o-(o-e.y)*s}}function l(e,t,a){return{x:(t-e.x)/e.zoom,y:(a-e.y)/e.zoom}}function c(e,t,a){return{...e,x:e.width/2-t*e.zoom,y:e.height/2-a*e.zoom}}function d(e,t,a,o,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:80,l=e.width/(o-t+2*s),c=e.height/(i-a+2*s),d=(0,r.qE)(Math.min(l,c),n.DQ,n.nD);return{...e,zoom:d,x:e.width/2-(t+o)/2*d,y:e.height/2-(a+i)/2*d}}},3235:(e,t,a)=>{"use strict";a.d(t,{$:()=>o});var n=a(2115),r=a(5709);function o(){var e,t;let{state:a,dispatch:o,codeTrailSystem:i,digitalRainRef:s,recompileStateRef:l}=(0,n.useContext)(r.X);return{...a,agentSnapshots:null!=(t=null==(e=a.data)?void 0:e.agent_snapshots)?t:[],loadData:e=>o({type:"LOAD_DATA",data:e}),setHovered:e=>o({type:"SET_HOVERED",agentId:e}),setSelected:e=>o({type:"SET_SELECTED",agentId:e}),toggleOverlay:e=>o({type:"TOGGLE_OVERLAY",key:e}),codeTrailSystem:i,digitalRainRef:s,recompileStateRef:l}}},3424:(e,t,a)=>{"use strict";a.d(t,{D:()=>i,G:()=>o});var n=a(7380),r=a(8416);function o(e,t,a,r){let o=[],i=new Set([...e.keys(),...t.keys()]),s=(0,n.e1)(0,1,a);for(let d of i){var l,c;let i=e.get(d),u=t.get(d),h=r.get(d);if(!h)continue;let p=null!=i?i:u,f=null!=u?u:i,g=(0,n.Cc)(p.reputation,f.reputation,s),m=(0,n.Cc)(p.resources,f.resources,s),x=(0,n.Cc)(p.total_payoff,f.total_payoff,s),v=(0,n.Cc)((p.avg_p_initiated+p.avg_p_received)/2||.5,(f.avg_p_initiated+f.avg_p_received)/2||.5,s),b=a<.5?p.is_frozen:f.is_frozen,y=a<.5?p.is_quarantined:f.is_quarantined,w=(0,n.qE)(.6+(g+1)*.4,.6,1.4);o.push({id:d,name:null!=(l=f.name)?l:d.slice(0,8),agentType:null!=(c=f.agent_type)?c:"honest",reputation:g,resources:m,totalPayoff:x,avgP:v,isFrozen:b,isQuarantined:y,scale:w,gridX:h.gridX,gridY:h.gridY,interactionsInitiated:Math.round((0,n.Cc)(p.interactions_initiated,f.interactions_initiated,s)),interactionsReceived:Math.round((0,n.Cc)(p.interactions_received,f.interactions_received,s)),walkOffsetX:0,walkOffsetY:0,walkPhase:0,facing:1})}return o}function i(e){let t=new Map,a=e.length,n=Math.ceil(Math.sqrt(a));for(let o=0;o<a;o++){let a=Math.floor(o/n),i=o%n;t.set(e[o],{gridX:i*r.Ru+1,gridY:a*r.Ru+1})}return t}},3997:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Leaderboard:()=>c,recordToLeaderboard:()=>l});var n=a(5155),r=a(2115),o=a(3235);let i="swarm-leaderboard";function s(){try{let e=localStorage.getItem(i);return e?JSON.parse(e):[]}catch(e){return[]}}function l(e){var t;let a=e.epoch_snapshots[e.epoch_snapshots.length-1];if(!a)return;let n={id:e.simulation_id,date:new Date().toISOString().slice(0,10),nAgents:e.n_agents,nEpochs:e.n_epochs,seed:e.seed,finalToxicity:a.toxicity_rate,finalGini:a.gini_coefficient,finalWelfare:a.total_welfare,finalAvgP:a.avg_p},r=[...s().filter(t=>t.id!==e.simulation_id),n].map(e=>({...e,score:.3*e.finalWelfare+30*e.finalAvgP-20*e.finalToxicity-10*e.finalGini}));r.sort((e,t)=>t.score-e.score),t=r.map(e=>{let{score:t,...a}=e;return a}),localStorage.setItem(i,JSON.stringify(t.slice(0,10)))}function c(){let{data:e}=(0,o.$)(),t=(0,r.useMemo)(()=>s(),[e]);return 0===t.length?null:(0,n.jsxs)("div",{className:"absolute top-4 left-4 w-64 bg-panel border border-border rounded-lg shadow-lg z-20 text-xs max-h-72 overflow-y-auto",children:[(0,n.jsx)("div",{className:"px-3 py-2 border-b border-border font-bold",children:"Leaderboard"}),(0,n.jsx)("div",{className:"divide-y divide-border",children:t.map((t,a)=>(0,n.jsxs)("div",{className:"px-3 py-1.5 flex items-center gap-2 ".concat((null==e?void 0:e.simulation_id)===t.id?"bg-accent/10":""),children:[(0,n.jsx)("span",{className:"text-muted w-4 font-mono",children:a+1}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{className:"text-muted truncate",children:[t.nAgents,"a/",t.nEpochs,"e"]}),(0,n.jsx)("span",{className:"text-muted",children:t.date})]}),(0,n.jsxs)("div",{className:"flex gap-2 mt-0.5",children:[(0,n.jsxs)("span",{style:{color:t.finalToxicity<.15?"#6FCF97":t.finalToxicity<.3?"#F2994A":"#EB5757"},children:["T:",(100*t.finalToxicity).toFixed(0),"%"]}),(0,n.jsxs)("span",{className:"text-accent",children:["P:",t.finalAvgP.toFixed(2)]}),(0,n.jsxs)("span",{style:{color:t.finalGini<.3?"#6FCF97":"#F2994A"},children:["G:",t.finalGini.toFixed(2)]}),(0,n.jsxs)("span",{className:"text-info",children:["W:",t.finalWelfare.toFixed(0)]})]})]})]},t.id))})]})}},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{bindSnapshot:function(){return i},createAsyncLocalStorage:function(){return o},createSnapshot:function(){return s}});let a=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function o(){return r?new r:new n}function i(e){return r?r.bind(e):n.bind(e)}function s(){return r?r.snapshot():function(e,...t){return e(...t)}}},4437:(e,t,a)=>{"use strict";function n(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),a(4553)},4797:(e,t,a)=>{Promise.resolve().then(a.bind(a,163))},5709:(e,t,a)=>{"use strict";a.d(t,{X:()=>b,n:()=>y});var n=a(5155),r=a(2115),o=a(7442);function i(e,t){return"".concat(e,":").concat(t)}var s=a(3424),l=a(8416);class c{addFromEvents(e,t){let a=[];for(let n of e)n.epoch===t&&a.push({id:"arc-".concat(this.arcCounter++),fromId:n.initiator,toId:n.counterparty,p:n.p,accepted:n.accepted,progress:0,epoch:t,interactionType:d(n.interaction_type)});this.staggerAndPush(a)}addFromEventsAtStep(e,t,a){let n=[];for(let r of e)r.epoch===t&&r.step===a&&n.push({id:"arc-".concat(this.arcCounter++),fromId:r.initiator,toId:r.counterparty,p:r.p,accepted:r.accepted,progress:0,epoch:t,interactionType:d(r.interaction_type)});this.staggerAndPush(n)}addSyntheticArcs(e,t,a,n,r){let o,i=Math.min(a,2*e.length),s=(o=0|1e3*t+7,()=>{let e=Math.imul((o=o+0x6d2b79f5|0)^o>>>15,1|o);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000}),l=[];for(let a=0;a<i;a++){let a=Math.floor(s()*e.length),o=Math.floor(s()*e.length);o===a&&(o=(o+1)%e.length),l.push({id:"arc-".concat(this.arcCounter++),fromId:e[a],toId:e[o],p:n+(s()-.5)*.3,accepted:s()<r,progress:0,epoch:t,interactionType:"unknown"})}this.staggerAndPush(l)}staggerAndPush(e){var t,a;let n=new Map;for(let e of this.arcs)e.progress<1&&n.set(e.fromId,(null!=(t=n.get(e.fromId))?t:0)+1);for(let t of e){let e=null!=(a=n.get(t.fromId))?a:0;t.progress=-(1.05*e),n.set(t.fromId,e+1),this.arcs.push(t)}}update(e,t){for(let a=this.arcs.length-1;a>=0;a--){let n=this.arcs[a],r=.8+.4*Math.max(0,Math.min(1,n.p));n.progress+=e/l.Yv.arcLifetime*r,n.progress>=1&&n.epoch!==t?this.arcs.splice(a,1):n.progress>=1&&(n.progress=1)}}clear(){this.arcs=[],this.arcCounter=0}getActive(){return this.arcs.filter(e=>e.progress<1)}constructor(){this.arcs=[],this.arcCounter=0}}function d(e){switch(e){case"trade":return"trade";case"reply":return"communication";case"collaboration":return"task";case"vote":return"governance";default:return"unknown"}}class u{add(e){this.particles.push(...e)}update(e){for(let t=this.particles.length-1;t>=0;t--){let a=this.particles[t];a.x+=a.vx*e,a.y+=a.vy*e,a.life-=e,a.life<=0&&this.particles.splice(t,1)}}clear(){this.particles=[]}constructor(){this.particles=[]}}var h=a(6620);class p{spawnBurst(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;for(let r=0;r<n;r++){let n=300+250*Math.random();this.particles.push({x:e+(Math.random()-.5)*12,y:t+(Math.random()-.5)*6,char:(0,h.P6)(),color:(0,h.eJ)(a,1),alpha:.7+.3*Math.random(),life:n,maxLife:n,vy:.015+.01*Math.random(),vx:(Math.random()-.5)*.006,gravity:3e-5+2e-5*Math.random(),fontSize:8+4*Math.random()})}}update(e){for(let t=this.particles.length-1;t>=0;t--){let a=this.particles[t];a.vy+=a.gravity*e,a.y+=a.vy*e,a.x+=a.vx*e,a.life-=e;let n=Math.max(0,a.life/a.maxLife);a.alpha=n*n*.8,a.life<=0&&this.particles.splice(t,1)}}clear(){this.particles=[]}constructor(){this.particles=[]}}var f=a(8738),g=a(1896),m=a(6096);let x={data:null,currentEpoch:0,epochFraction:0,playing:!1,speed:1,viewport:(0,g.FB)(800,600),hoveredAgent:null,selectedAgent:null,overlays:{interactions:!0,metricsHud:!0,threatZones:!0,collusionLines:!0,particles:!0,minimap:!0,digitalRain:!0,tierraStrip:!0,networkWeb:!1},currentStep:0,maxStepInEpoch:0,stepPlayback:!1,eventIndex:null,agents:[],arcs:[],environment:{threatLevel:0,toxicity:0,giniCoefficient:0,collusionRisk:0,incoherence:0,contagionDepth:0,activeThreats:0,reputationStd:0,payoffStd:0,avgSynergyScore:0,avgCoordinationScore:0,avgDegree:0,avgClustering:0},particles:[],currentEpochSnap:null,gridSize:10};function v(e,t){switch(t.type){case"LOAD_DATA":{var a;let n=Math.max((Math.ceil(Math.sqrt((0,f.V2)(t.data.agent_snapshots).length))+1)*l.Ru+2,10),r=t.data.rawEvents&&t.data.rawEvents.length>0?function(e){let t=new Map,a=new Map;for(let r of e){var n;if(null==r.epoch||null==r.step)continue;let e=i(r.epoch,r.step),o=t.get(e);o||(o=[],t.set(e,o)),o.push(r);let s=null!=(n=a.get(r.epoch))?n:-1;r.step>s&&a.set(r.epoch,r.step)}let r=new Map;return{maxStep(e){var t;return null!=(t=a.get(e))?t:0},epochs:()=>[...a.keys()].sort((e,t)=>e-t),eventsAt(e,a){var n;return null!=(n=t.get(i(e,a)))?n:[]},interactionsAt(e,a){var n;let s=i(e,a),l=r.get(s);if(l)return l;let c=null!=(n=t.get(s))?n:[];return l=(0,o.Do)(c),r.set(s,l),l},reputationUpdatesAt(e,a){var n;return(null!=(n=t.get(i(e,a)))?n:[]).filter(e=>"reputation_updated"===e.event_type)},governanceCostsAt(e,a){var n;return(null!=(n=t.get(i(e,a)))?n:[]).filter(e=>"governance_cost_applied"===e.event_type)}}}(t.data.rawEvents):null,s=!!r,c=r?r.maxStep(0):0;return{...e,data:t.data,currentEpoch:0,epochFraction:0,playing:!1,gridSize:n,currentEpochSnap:null!=(a=t.data.epoch_snapshots[0])?a:null,eventIndex:r,stepPlayback:s,currentStep:0,maxStepInEpoch:c}}case"SET_EPOCH":{let a=e.eventIndex?e.eventIndex.maxStep(t.epoch):0;return{...e,currentEpoch:t.epoch,epochFraction:0,currentStep:0,maxStepInEpoch:a}}case"SET_PLAYING":return{...e,playing:t.playing};case"SET_SPEED":return{...e,speed:t.speed};case"SET_VIEWPORT":return{...e,viewport:t.viewport};case"RESIZE":if(e.viewport.width===t.width&&e.viewport.height===t.height)return e;return{...e,viewport:{...e.viewport,width:t.width,height:t.height}};case"SET_HOVERED":return{...e,hoveredAgent:t.agentId};case"SET_SELECTED":return{...e,selectedAgent:t.agentId};case"TOGGLE_OVERLAY":return{...e,overlays:{...e.overlays,[t.key]:!e.overlays[t.key]}};case"SET_STEP":return{...e,currentStep:t.step};case"SET_STEP_PLAYBACK":return{...e,stepPlayback:t.enabled,currentStep:0};case"TICK":return{...e,agents:t.agents,arcs:t.arcs,environment:t.environment,particles:t.particles,currentEpoch:t.epoch,epochFraction:t.fraction,currentEpochSnap:t.epochSnap,...void 0!==t.step?{currentStep:t.step}:{},...void 0!==t.maxStepInEpoch?{maxStepInEpoch:t.maxStepInEpoch}:{}};default:return e}}let b=(0,r.createContext)(null);function y(e){let{children:t}=e,[a,o]=(0,r.useReducer)(v,x),i=(0,r.useRef)(new c),l=(0,r.useRef)(new u),d=(0,r.useRef)(new p),h=(0,r.useRef)(null),y=(0,r.useRef)({active:!1,startTime:0,duration:400,scanlineY:0}),w=(0,r.useRef)(new Map),_=(0,r.useRef)(new Map);return(0,r.useEffect)(()=>{if(!a.data)return;let e=(0,f.V2)(a.data.agent_snapshots);if(w.current=(0,s.D)(e),_.current=(0,f.y)(a.data.agent_snapshots),i.current.clear(),l.current.clear(),d.current.clear(),h.current=null,w.current.size>0){let e=1/0,t=1/0,n=-1/0,r=-1/0;for(let a of w.current.values()){let o=(0,m.Gs)(a.gridX,a.gridY);e=Math.min(e,o.x),t=Math.min(t,o.y-120),n=Math.max(n,o.x),r=Math.max(r,o.y+30)}o({type:"SET_VIEWPORT",viewport:(0,g.Fe)(a.viewport,e,t,n,r)})}},[a.data]),(0,n.jsx)(b.Provider,{value:{state:a,dispatch:o,interactionSystem:i,particleSystem:l,codeTrailSystem:d,digitalRainRef:h,recompileStateRef:y,agentPositions:w,agentsByEpoch:_},children:t})}},6096:(e,t,a)=>{"use strict";a.d(t,{Gs:()=>r,pU:()=>o});var n=a(8416);function r(e,t){return{x:(e-t)*(n.KP/2),y:(e+t)*(n.VM/2)}}function o(e,t,a,n,r){e.beginPath(),e.moveTo(t,a-r/2),e.lineTo(t+n/2,a),e.lineTo(t,a+r/2),e.lineTo(t-n/2,a),e.closePath()}},6278:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let n=a(8140)._(a(1150));function r(e,t){var a;let r={};"function"==typeof e&&(r.loader=e);let o={...r,...t};return(0,n.default)({...o,modules:null==(a=o.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6552:(e,t,a)=>{"use strict";function n(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return n}}),a(5155),a(7650),a(8567),a(7278)},6620:(e,t,a)=>{"use strict";a.d(t,{C4:()=>d,Hw:()=>l,P6:()=>r,TN:()=>o,eJ:()=>c,mQ:()=>u,wx:()=>s});let n=[];for(let e=65382;e<=65437;e++)n.push(String.fromCharCode(e));for(let e of"0123456789+-*/<>=(){}[];:!?@#$%&^~")n.push(e);function r(){return n[Math.floor(Math.random()*n.length)]}function o(e){return n[((e>>>0)%n.length+n.length)%n.length]}let i="!?X#@$%&";function s(e){return i[((e>>>0)%i.length+i.length)%i.length]}function l(e){return"rgba(0,255,65,".concat(e,")")}function c(e,t){let a,n,r,o=Math.max(0,Math.min(1,e));if(o>.5){let e=(o-.5)*2;a=Math.round(255*(1-e)),n=255,r=Math.round(65*e)}else a=255,n=Math.round(2*o*255),r=0;return"rgba(".concat(a,",").concat(n,",").concat(r,",").concat(t,")")}let d="bold 14px 'Courier New', monospace",u="bold 10px 'Courier New', monospace"},7380:(e,t,a)=>{"use strict";function n(e,t,a){return e+(t-e)*a}function r(e,t,a){return Math.max(t,Math.min(a,e))}function o(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}function i(e){return 1-Math.pow(1-e,3)}function s(e,t,a,n,o){return n+(o-n)*(t===a?0:r((e-t)/(a-t),0,1))}function l(e,t,a){let n=r((a-e)/(t-e),0,1);return n*n*n*(n*(6*n-15)+10)}function c(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a)|0;return t>>>0}a.d(t,{Cc:()=>n,Ew:()=>s,YZ:()=>c,am:()=>o,e1:()=>l,qE:()=>r,vT:()=>i})},7442:(e,t,a)=>{"use strict";a.d(t,{Do:()=>s,OL:()=>l,oi:()=>o});var n=a(9168),r=a(9961);async function o(e){let t;if("string"==typeof e){let a=await fetch(e);if(!a.ok)throw Error("Failed to load: ".concat(a.statusText));t=await a.text()}else t=await e.text();let a=JSON.parse(t);return function(e){if(!e.epoch_snapshots||!Array.isArray(e.epoch_snapshots))throw Error("Missing epoch_snapshots array");if(!Array.isArray(e.agent_snapshots)){var t;e.agent_snapshots=null!=(t=e.agent_snapshots)?t:[]}if(0===e.epoch_snapshots.length)throw Error("No epoch snapshots found")}(a),0===a.agent_snapshots.length&&a.epoch_snapshots.length>0&&(a.agent_snapshots=function(e){var t,a,o,i,s;let l=(0,n.s)(null!=(t=e.seed)?t:42),c=e.n_agents||e.epoch_snapshots[0].n_agents||6,d=[],u=[];for(let e=0;e<c;e++){let t=e%r.K.length,a=r.K[t],n=r.n[a].names,o=n[e%n.length]+(e>=r.K.length?"-".concat(Math.floor(e/r.K.length)+1):""),i=r.n[a].disposition+(l()-.5)*.3;u.push({id:"agent-".concat(e),name:o,type:a,disposition:i})}let h=u.map(()=>({reputation:.5+(l()-.5)*.2,resources:10+5*l(),totalPayoff:0,initiated:0,received:0}));for(let t of e.epoch_snapshots)for(let e=0;e<u.length;e++){let n=u[e],r=h[e],p=l()-.5,f=(null!=(a=t.toxicity_rate)?a:0)*.5,g=.05*n.disposition+.03*p-.02*f;r.reputation=Math.max(0,Math.min(1,r.reputation+g));let m=(null!=(o=t.avg_payoff)?o:0)*(.8+.4*n.disposition)+2*p;r.totalPayoff+=m,r.resources=Math.max(0,r.resources+.1*m);let x=t.total_interactions/c,v=Math.max(0,Math.round(x*(.4+.3*l()))),b=Math.max(0,Math.round(x*(.3+.3*l())));r.initiated+=v,r.received+=b;let y=Math.max(0,Math.min(1,.5+.3*n.disposition+.1*p-(null!=(i=t.toxicity_rate)?i:0)*.15)),w=null!=(s=t.ecosystem_threat_level)?s:0,_="adversarial"===n.type&&w>.5&&r.reputation<.3&&l()>.4,S="deceptive"===n.type&&w>.4&&r.reputation<.35&&l()>.5;d.push({agent_id:n.id,epoch:t.epoch,name:n.name,agent_type:n.type,reputation:r.reputation,resources:r.resources,interactions_initiated:r.initiated,interactions_received:r.received,avg_p_initiated:y,avg_p_received:Math.max(0,Math.min(1,y+(l()-.5)*.1)),total_payoff:r.totalPayoff,is_frozen:_,is_quarantined:S})}return d}(a)),a.events&&Array.isArray(a.events)?a.events=a.events.filter(e=>!e.event_type||"interaction"===e.event_type):a.events=void 0,a}async function i(e){let t;if("string"==typeof e){let a=await fetch(e);if(!a.ok)throw Error("Failed to load events: ".concat(a.statusText));t=await a.text()}else t=await e.text();return t.trim().split("\n").filter(e=>e.length>0).map(e=>JSON.parse(e))}function s(e){let t=new Map;for(let a of e)"interaction_proposed"===a.event_type&&a.interaction_id&&t.set(a.interaction_id,a);let a=[];for(let u of e)if("interaction_completed"===u.event_type&&u.interaction_id){var n,r,o,i,s,l,c,d;let e=t.get(u.interaction_id);if(!e)continue;let h=null!=(n=e.epoch)?n:0,p=null!=(r=e.step)?r:0,f=e.payload,g=u.payload;a.push({event_type:"interaction",timestamp:e.timestamp,epoch:h,step:p,interaction_id:u.interaction_id,initiator:null!=(o=e.initiator_id)?o:"",counterparty:null!=(i=e.counterparty_id)?i:"",interaction_type:null!=(s=f.interaction_type)?s:"trade",accepted:null==(l=g.accepted)||l,p:null!=(c=f.p)?c:.5,v_hat:null!=(d=f.v_hat)?d:0})}return a}async function l(e,t){let a=await o(e);if(t){a.rawEvents=await i(t),a.events=s(a.rawEvents);let e=a.rawEvents.filter(e=>"agent_created"===e.event_type);e.length>0&&(a.agent_snapshots=function(e,t){var a,o,i,s,l;let c=(0,n.s)(null!=(a=e.seed)?a:42),d=[],u=t.map(e=>{var t,a,n,o,i;let s=null!=(n=e.payload.agent_type)?n:"honest",l=null!=(o=null==(t=r.n[s])?void 0:t.names)?o:["Agent"],d=(null!=(i=null==(a=r.n[s])?void 0:a.disposition)?i:.5)+(c()-.5)*.3;return{id:e.agent_id,name:l[0],type:s,disposition:d}}),h=u.map(()=>({reputation:.5+(c()-.5)*.2,resources:10+5*c(),totalPayoff:0,initiated:0,received:0}));for(let t of e.epoch_snapshots)for(let e=0;e<u.length;e++){let a=u[e],n=h[e],r=c()-.5,p=(null!=(o=t.toxicity_rate)?o:0)*.5,f=.05*a.disposition+.03*r-.02*p;n.reputation=Math.max(0,Math.min(1,n.reputation+f));let g=(null!=(i=t.avg_payoff)?i:0)*(.8+.4*a.disposition)+2*r;n.totalPayoff+=g,n.resources=Math.max(0,n.resources+.1*g);let m=t.total_interactions/u.length;n.initiated+=Math.max(0,Math.round(m*(.4+.3*c()))),n.received+=Math.max(0,Math.round(m*(.3+.3*c())));let x=Math.max(0,Math.min(1,.5+.3*a.disposition+.1*r-(null!=(s=t.toxicity_rate)?s:0)*.15)),v=null!=(l=t.ecosystem_threat_level)?l:0,b="adversarial"===a.type&&v>.5&&n.reputation<.3&&c()>.4,y="deceptive"===a.type&&v>.4&&n.reputation<.35&&c()>.5;d.push({agent_id:a.id,epoch:t.epoch,name:a.name,agent_type:a.type,reputation:n.reputation,resources:n.resources,interactions_initiated:n.initiated,interactions_received:n.received,avg_p_initiated:x,avg_p_received:Math.max(0,Math.min(1,x+(c()-.5)*.1)),total_payoff:n.totalPayoff,is_frozen:b,is_quarantined:y})}return d}(a,e))}return a}},7828:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return n}});let n=(0,a(4054).createAsyncLocalStorage)()},8416:(e,t,a)=>{"use strict";a.d(t,{Cw:()=>u,DQ:()=>o,FJ:()=>l,KP:()=>n,KS:()=>f,Ru:()=>d,VM:()=>r,Yv:()=>h,Zu:()=>p,gp:()=>c,lm:()=>s,nD:()=>i});let n=96,r=48,o=.3,i=4,s={bg:"#0D1117",panel:"#161B22",border:"#30363D",text:"#E6EDF3",muted:"#7D8590",accent:"#3ECFB4",secondary:"#F2994A",alert:"#EB5757",info:"#2F80ED",btn:"#21262D",btnHover:"#30363D"},l={honest:{primary:"#1A6B5A",secondary:"#3ECFB4",accent:"#A8EFDF"},opportunistic:{primary:"#8B5E2F",secondary:"#F2994A",accent:"#FCDBB5"},deceptive:{primary:"#5B2D8B",secondary:"#BB6BD9",accent:"#E4BFF5"},adversarial:{primary:"#8B2D2D",secondary:"#EB5757",accent:"#F5BFBF"},rlm:{primary:"#1E4D8B",secondary:"#2F80ED",accent:"#A8CFF5"},crewai:{primary:"#2D6B2D",secondary:"#6FCF97",accent:"#C0F0D0"}},c={honest:"Paladin",opportunistic:"Merchant",deceptive:"Illusionist",adversarial:"Enforcer",rlm:"Technomancer",crewai:"Builder"},d=3,u={baseWidth:48,baseHeight:84},h={epochTransition:2e3,arcLifetime:1500,particleLife:1e3},p={honest:{walkRate:.011,bobAmplitude:1.2,bobAsymmetry:.1,legSwingScale:.9,armSwingScale:.8,swayAmplitude:.3,idleBob:.4},opportunistic:{walkRate:.014,bobAmplitude:1.8,bobAsymmetry:.2,legSwingScale:1.1,armSwingScale:1.2,swayAmplitude:.6,idleBob:.6},deceptive:{walkRate:.01,bobAmplitude:.8,bobAsymmetry:.3,legSwingScale:.7,armSwingScale:.6,swayAmplitude:.8,idleBob:.3},adversarial:{walkRate:.016,bobAmplitude:2.2,bobAsymmetry:0,legSwingScale:1.3,armSwingScale:1.4,swayAmplitude:.2,idleBob:.5},rlm:{walkRate:.012,bobAmplitude:1,bobAsymmetry:.15,legSwingScale:1,armSwingScale:.9,swayAmplitude:.4,idleBob:.35},crewai:{walkRate:.013,bobAmplitude:1.5,bobAsymmetry:.1,legSwingScale:1,armSwingScale:1,swayAmplitude:.5,idleBob:.5}},f={charCountMin:5,charCountMax:14,charSpacingMin:.05,charSpacingMax:.12,mutateIntervalMin:50,mutateIntervalMax:120,glowRadiusMin:5,glowRadiusMax:12,gridSize:3,gridSpacing:6}},8567:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return n.workAsyncStorageInstance}});let n=a(7828)},8738:(e,t,a)=>{"use strict";function n(e){let t=new Map;for(let a of e)t.has(a.epoch)||t.set(a.epoch,new Map),t.get(a.epoch).set(a.agent_id,a);return t}function r(e){return[...new Set(e.map(e=>e.agent_id))]}a.d(t,{V2:()=>r,y:()=>n})},9168:(e,t,a)=>{"use strict";function n(e){return()=>{e|=0;let t=Math.imul((e=e+0x6d2b79f5|0)^e>>>15,1|e);return(((t=t+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/0x100000000}}function r(e){return Math.sqrt(-2*Math.log(e()||1e-10))*Math.cos(2*Math.PI*e())}a.d(t,{j:()=>r,s:()=>n})},9961:(e,t,a)=>{"use strict";a.d(t,{K:()=>n,n:()=>r});let n=["honest","opportunistic","deceptive","adversarial","rlm","crewai"],r={honest:{progressMean:.7,progressStd:.15,reworkProb:.05,rejectionProb:.02,engagementMean:.6,acceptanceThreshold:.2,disposition:.7,names:["Sentinel","Guardian","Beacon","Anchor","Steward","Warden","Shield","Paladin","Arbiter","Keeper"]},opportunistic:{progressMean:.4,progressStd:.25,reworkProb:.15,rejectionProb:.1,engagementMean:.2,acceptanceThreshold:.1,disposition:.3,names:["Broker","Trader","Hustler","Maverick","Gambit","Dealer","Shark","Schemer","Speculator","Rogue"]},deceptive:{progressMean:.2,progressStd:.3,reworkProb:.25,rejectionProb:.2,engagementMean:-.1,acceptanceThreshold:.05,disposition:-.2,names:["Mirage","Phantom","Shadow","Facade","Specter","Wraith","Veil","Decoy","Illusionist","Shade"]},adversarial:{progressMean:-.2,progressStd:.35,reworkProb:.35,rejectionProb:.3,engagementMean:-.4,acceptanceThreshold:0,disposition:-.5,names:["Viper","Striker","Havoc","Razr","Blitz","Chaos","Toxin","Bane","Ravager","Scourge"]},rlm:{progressMean:.5,progressStd:.2,reworkProb:.1,rejectionProb:.08,engagementMean:.3,acceptanceThreshold:.15,disposition:.5,names:["Nexus","Cortex","Axiom","Vertex","Synapse","Matrix","Vector","Tensor","Lambda","Neural"]},crewai:{progressMean:.6,progressStd:.18,reworkProb:.08,rejectionProb:.05,engagementMean:.5,acceptanceThreshold:.2,disposition:.6,names:["Forge","Assembly","Cluster","Hive","Colony","Swarm","Network","Grid","Nexus","Hub"]}}}},e=>{e.O(0,[441,255,358],()=>e(e.s=4797)),_N_E=e.O()}]);