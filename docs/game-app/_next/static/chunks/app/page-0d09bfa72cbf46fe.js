(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3777:(e,t,a)=>{Promise.resolve().then(a.bind(a,7303))},7303:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eW});var n=a(5155),r=a(2115);function o(e,t,a){return Math.max(t,Math.min(a,e))}function i(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}function l(e,t,a){let n=o((a-e)/(t-e),0,1);return n*n*n*(n*(6*n-15)+10)}function s(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a)|0;return t>>>0}let c={bg:"#0D1117",panel:"#161B22",border:"#30363D",text:"#E6EDF3",muted:"#7D8590",accent:"#3ECFB4",secondary:"#F2994A",alert:"#EB5757",info:"#2F80ED"},d={honest:{primary:"#1A6B5A",secondary:"#3ECFB4",accent:"#A8EFDF"},opportunistic:{primary:"#8B5E2F",secondary:"#F2994A",accent:"#FCDBB5"},deceptive:{primary:"#5B2D8B",secondary:"#BB6BD9",accent:"#E4BFF5"},adversarial:{primary:"#8B2D2D",secondary:"#EB5757",accent:"#F5BFBF"},rlm:{primary:"#1E4D8B",secondary:"#2F80ED",accent:"#A8CFF5"},crewai:{primary:"#2D6B2D",secondary:"#6FCF97",accent:"#C0F0D0"}},h={honest:"Paladin",opportunistic:"Merchant",deceptive:"Illusionist",adversarial:"Enforcer",rlm:"Technomancer",crewai:"Builder"},u={baseWidth:48,baseHeight:84},p={epochTransition:2e3,arcLifetime:1500},f={honest:{walkRate:.011,bobAmplitude:1.2,bobAsymmetry:.1,legSwingScale:.9,armSwingScale:.8,swayAmplitude:.3,idleBob:.4},opportunistic:{walkRate:.014,bobAmplitude:1.8,bobAsymmetry:.2,legSwingScale:1.1,armSwingScale:1.2,swayAmplitude:.6,idleBob:.6},deceptive:{walkRate:.01,bobAmplitude:.8,bobAsymmetry:.3,legSwingScale:.7,armSwingScale:.6,swayAmplitude:.8,idleBob:.3},adversarial:{walkRate:.016,bobAmplitude:2.2,bobAsymmetry:0,legSwingScale:1.3,armSwingScale:1.4,swayAmplitude:.2,idleBob:.5},rlm:{walkRate:.012,bobAmplitude:1,bobAsymmetry:.15,legSwingScale:1,armSwingScale:.9,swayAmplitude:.4,idleBob:.35},crewai:{walkRate:.013,bobAmplitude:1.5,bobAsymmetry:.1,legSwingScale:1,armSwingScale:1,swayAmplitude:.5,idleBob:.5}},g={charCountMin:5,charCountMax:14,charSpacingMin:.05,charSpacingMax:.12,mutateIntervalMin:50,mutateIntervalMax:120,glowRadiusMin:5,glowRadiusMax:12,gridSize:3,gridSpacing:6};class m{addFromEvents(e,t){for(let a of e)a.epoch===t&&this.arcs.push({id:"arc-".concat(this.arcCounter++),fromId:a.initiator,toId:a.counterparty,p:a.p,accepted:a.accepted,progress:0,epoch:t,interactionType:function(e){switch(e){case"trade":return"trade";case"reply":return"communication";case"collaboration":return"task";case"vote":return"governance";default:return"unknown"}}(a.interaction_type)})}addSyntheticArcs(e,t,a,n,r){let o,i=Math.min(a,2*e.length),l=(o=0|1e3*t+7,()=>{let e=Math.imul((o=o+0x6d2b79f5|0)^o>>>15,1|o);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000});for(let a=0;a<i;a++){let a=Math.floor(l()*e.length),o=Math.floor(l()*e.length);o===a&&(o=(o+1)%e.length),this.arcs.push({id:"arc-".concat(this.arcCounter++),fromId:e[a],toId:e[o],p:n+(l()-.5)*.3,accepted:l()<r,progress:.3*l(),epoch:t,interactionType:"unknown"})}}update(e,t){for(let a=this.arcs.length-1;a>=0;a--){let n=this.arcs[a],r=.8+.4*Math.max(0,Math.min(1,n.p));n.progress+=e/p.arcLifetime*r,n.progress>=1&&n.epoch!==t?this.arcs.splice(a,1):n.progress>=1&&(n.progress=1)}}clear(){this.arcs=[],this.arcCounter=0}getActive(){return this.arcs.filter(e=>e.progress<1)}constructor(){this.arcs=[],this.arcCounter=0}}class y{add(e){this.particles.push(...e)}update(e){for(let t=this.particles.length-1;t>=0;t--){let a=this.particles[t];a.x+=a.vx*e,a.y+=a.vy*e,a.life-=e,a.life<=0&&this.particles.splice(t,1)}}clear(){this.particles=[]}constructor(){this.particles=[]}}let x=[];for(let e=65382;e<=65437;e++)x.push(String.fromCharCode(e));for(let e of"0123456789+-*/<>=(){}[];:!?@#$%&^~")x.push(e);function v(){return x[Math.floor(Math.random()*x.length)]}function b(e){return x[((e>>>0)%x.length+x.length)%x.length]}let M="!?X#@$%&";function S(e){return M[((e>>>0)%M.length+M.length)%M.length]}function _(e){return"rgba(0,255,65,".concat(e,")")}function w(e,t){let a,n,r,o=Math.max(0,Math.min(1,e));if(o>.5){let e=(o-.5)*2;a=Math.round(255*(1-e)),n=255,r=Math.round(65*e)}else a=255,n=Math.round(2*o*255),r=0;return"rgba(".concat(a,",").concat(n,",").concat(r,",").concat(t,")")}let k="bold 10px 'Courier New', monospace";class P{spawnBurst(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;for(let r=0;r<n;r++){let n=300+250*Math.random();this.particles.push({x:e+(Math.random()-.5)*12,y:t+(Math.random()-.5)*6,char:v(),color:w(a,1),alpha:.7+.3*Math.random(),life:n,maxLife:n,vy:.015+.01*Math.random(),vx:(Math.random()-.5)*.006,gravity:3e-5+2e-5*Math.random(),fontSize:8+4*Math.random()})}}update(e){for(let t=this.particles.length-1;t>=0;t--){let a=this.particles[t];a.vy+=a.gravity*e,a.y+=a.vy*e,a.x+=a.vx*e,a.life-=e;let n=Math.max(0,a.life/a.maxLife);a.alpha=n*n*.8,a.life<=0&&this.particles.splice(t,1)}}clear(){this.particles=[]}constructor(){this.particles=[]}}function T(e){return[...new Set(e.map(e=>e.agent_id))]}function C(e,t,a,n,r){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:80,l=o(Math.min(e.width/(n-t+2*i),e.height/(r-a+2*i)),.3,4);return{...e,zoom:l,x:e.width/2-(t+n)/2*l,y:e.height/2-(a+r)/2*l}}function j(e,t){return{x:48*(e-t),y:24*(e+t)}}function F(e,t,a,n,r){e.beginPath(),e.moveTo(t,a-r/2),e.lineTo(t+n/2,a),e.lineTo(t,a+r/2),e.lineTo(t-n/2,a),e.closePath()}let E={data:null,currentEpoch:0,epochFraction:0,playing:!1,speed:1,viewport:{x:0,y:0,width:800,height:600,zoom:1},hoveredAgent:null,selectedAgent:null,overlays:{interactions:!0,metricsHud:!0,threatZones:!0,collusionLines:!0,particles:!0,minimap:!0,digitalRain:!0,tierraStrip:!0,networkWeb:!1},agents:[],arcs:[],environment:{threatLevel:0,toxicity:0,giniCoefficient:0,collusionRisk:0,incoherence:0,contagionDepth:0,activeThreats:0,reputationStd:0,payoffStd:0,avgSynergyScore:0,avgCoordinationScore:0,avgDegree:0,avgClustering:0},particles:[],currentEpochSnap:null,gridSize:10};function I(e,t){switch(t.type){case"LOAD_DATA":{var a;let n=Math.max((Math.ceil(Math.sqrt(T(t.data.agent_snapshots).length))+1)*3+2,10);return{...e,data:t.data,currentEpoch:0,epochFraction:0,playing:!1,gridSize:n,currentEpochSnap:null!=(a=t.data.epoch_snapshots[0])?a:null}}case"SET_EPOCH":return{...e,currentEpoch:t.epoch,epochFraction:0};case"SET_PLAYING":return{...e,playing:t.playing};case"SET_SPEED":return{...e,speed:t.speed};case"SET_VIEWPORT":return{...e,viewport:t.viewport};case"RESIZE":if(e.viewport.width===t.width&&e.viewport.height===t.height)return e;return{...e,viewport:{...e.viewport,width:t.width,height:t.height}};case"SET_HOVERED":return{...e,hoveredAgent:t.agentId};case"SET_SELECTED":return{...e,selectedAgent:t.agentId};case"TOGGLE_OVERLAY":return{...e,overlays:{...e.overlays,[t.key]:!e.overlays[t.key]}};case"TICK":return{...e,agents:t.agents,arcs:t.arcs,environment:t.environment,particles:t.particles,currentEpoch:t.epoch,epochFraction:t.fraction,currentEpochSnap:t.epochSnap};default:return e}}let R=(0,r.createContext)(null);function N(e){let{children:t}=e,[a,o]=(0,r.useReducer)(I,E),i=(0,r.useRef)(new m),l=(0,r.useRef)(new y),s=(0,r.useRef)(new P),c=(0,r.useRef)(null),d=(0,r.useRef)({active:!1,startTime:0,duration:400,scanlineY:0}),h=(0,r.useRef)(new Map),u=(0,r.useRef)(new Map);return(0,r.useEffect)(()=>{if(a.data&&(h.current=function(e){let t=new Map,a=e.length,n=Math.ceil(Math.sqrt(a));for(let r=0;r<a;r++){let a=Math.floor(r/n),o=r%n;t.set(e[r],{gridX:3*o+1,gridY:3*a+1})}return t}(T(a.data.agent_snapshots)),u.current=function(e){let t=new Map;for(let a of e)t.has(a.epoch)||t.set(a.epoch,new Map),t.get(a.epoch).set(a.agent_id,a);return t}(a.data.agent_snapshots),i.current.clear(),l.current.clear(),s.current.clear(),c.current=null,h.current.size>0)){let e=1/0,t=1/0,n=-1/0,r=-1/0;for(let a of h.current.values()){let o=j(a.gridX,a.gridY);e=Math.min(e,o.x),t=Math.min(t,o.y-120),n=Math.max(n,o.x),r=Math.max(r,o.y+30)}o({type:"SET_VIEWPORT",viewport:C(a.viewport,e,t,n,r)})}},[a.data]),(0,n.jsx)(R.Provider,{value:{state:a,dispatch:o,interactionSystem:i,particleSystem:l,codeTrailSystem:s,digitalRainRef:c,recompileStateRef:d,agentPositions:h,agentsByEpoch:u},children:t})}function A(){var e,t;let{state:a,dispatch:n,codeTrailSystem:o,digitalRainRef:i,recompileStateRef:l}=(0,r.useContext)(R);return{...a,agentSnapshots:null!=(t=null==(e=a.data)?void 0:e.agent_snapshots)?t:[],loadData:e=>n({type:"LOAD_DATA",data:e}),setHovered:e=>n({type:"SET_HOVERED",agentId:e}),setSelected:e=>n({type:"SET_SELECTED",agentId:e}),toggleOverlay:e=>n({type:"TOGGLE_OVERLAY",key:e}),codeTrailSystem:o,digitalRainRef:i,recompileStateRef:l}}function D(){let{state:e,dispatch:t,agentPositions:a}=(0,r.useContext)(R),n=(0,r.useCallback)(e=>t({type:"SET_VIEWPORT",viewport:e}),[t]),i=(0,r.useCallback)((t,a)=>{var r;n((r=e.viewport,{...r,x:r.x+t,y:r.y+a}))},[e.viewport,n]),l=(0,r.useCallback)((t,a,r)=>{n(function(e,t,a,n){let r=o(e.zoom*(1-.001*t),.3,4),i=r/e.zoom;return{...e,zoom:r,x:a-(a-e.x)*i,y:n-(n-e.y)*i}}(e.viewport,t,a,r))},[e.viewport,n]),s=(0,r.useCallback)(()=>{if(0===a.current.size){var t;return void n({...t=e.viewport,x:t.width/2-0*t.zoom,y:t.height/2-0*t.zoom})}let r=1/0,o=1/0,i=-1/0,l=-1/0;for(let e of a.current.values()){let t=j(e.gridX,e.gridY);r=Math.min(r,t.x),o=Math.min(o,t.y-100),i=Math.max(i,t.x),l=Math.max(l,t.y+20)}n(C(e.viewport,r,o,i,l))},[e.viewport,n,a]),c=(0,r.useCallback)((e,a)=>{t({type:"RESIZE",width:e,height:a})},[t]);return{viewport:e.viewport,handlePan:i,handleZoom:l,resetCamera:s,resize:c}}function B(e){let t=parseInt(e.replace("#",""),16);return{r:t>>16&255,g:t>>8&255,b:255&t}}function W(e,t,a){var n,r,i,l;let s=B(e),c=B(t);return l=(n=s.r)+(c.r-n)*a,"#"+[l,(r=s.g)+(c.g-r)*a,(i=s.b,i+(c.b-i)*a)].map(e=>o(Math.round(e),0,255).toString(16).padStart(2,"0")).join("")}function z(e,t){let{r:a,g:n,b:r}=B(e);return"rgba(".concat(a,",").concat(n,",").concat(r,",").concat(t,")")}function L(e){let t=o(e,0,1);return t<.5?W("#EB5757","#F2C94C",2*t):W("#F2C94C","#27AE60",(t-.5)*2)}let Y="/game-app",q=["honest","opportunistic","deceptive","adversarial","rlm","crewai"],X=["tile","tower","spire","node"];class O{init(){if(!this.initialized){for(let e of(this.initialized=!0,q)){let t=new Image,a={img:t,cleaned:null,loaded:!1};t.onload=()=>{a.cleaned=this.removeBackground(t),a.loaded=!0},t.onerror=()=>{},t.src="".concat(Y,"/sprites/").concat(e,"_idle.png"),this.sprites.set(e,a)}for(let e of X){let t=new Image,a={img:t,cleaned:null,loaded:!1};t.onload=()=>{let e=this.removeBackground(t);a.cleaned=this.trimTransparent(e),a.loaded=!0},t.onerror=()=>{},t.src="".concat(Y,"/sprites/").concat(e,".png"),this.envSprites.set(e,a)}}}isReady(e){var t;let a=this.sprites.get(e);return null!=(t=null==a?void 0:a.loaded)&&t}removeBackground(e){let t=document.createElement("canvas"),a=e.naturalWidth,n=e.naturalHeight;t.width=a,t.height=n;let r=t.getContext("2d");r.drawImage(e,0,0);let o=r.getImageData(0,0,a,n),i=o.data,l=new Uint8Array(a*n),s=0,c=0,d=0;for(let[e,t]of[[2,2],[a-3,2],[2,n-3],[a-3,n-3]]){let n=(t*a+e)*4;s+=i[n],c+=i[n+1],d+=i[n+2]}s/=4,c/=4,d/=4;let h=e=>{let t=i[e],a=i[e+1],n=i[e+2],r=i[e+3];return!!(0===r||120>Math.sqrt((t-s)**2+(a-c)**2+(n-d)**2))||!!(r<180)},u=[];for(let e=0;e<a;e++)for(let t of[0,n-1]){let n=t*a+e;!l[n]&&h(4*n)&&(u.push(n),l[n]=1)}for(let e=1;e<n-1;e++)for(let t of[0,a-1]){let n=e*a+t;!l[n]&&h(4*n)&&(u.push(n),l[n]=1)}let p=0;for(;p<u.length;){let e=u[p++],t=e%a,r=Math.floor(e/a);for(let o of(i[4*e+3]=0,[r>0?e-a:-1,r<n-1?e+a:-1,t>0?e-1:-1,t<a-1?e+1:-1]))o>=0&&!l[o]&&h(4*o)&&(l[o]=1,u.push(o))}let f=new Uint8Array(a*n);for(let e=0;e<a*n;e++)f[e]=i[4*e+3];for(let e=1;e<n-1;e++)for(let t=1;t<a-1;t++){let n=e*a+t;if(0===f[n])continue;let r=0;0===f[n-1]&&r++,0===f[n+1]&&r++,0===f[n-a]&&r++,0===f[n+a]&&r++,r>=2?i[4*n+3]=Math.round(.5*i[4*n+3]):1===r&&(i[4*n+3]=Math.round(.8*i[4*n+3]))}return r.putImageData(o,0,0),t}trimTransparent(e){let t=e.width,a=e.height,n=e.getContext("2d").getImageData(0,0,t,a).data,r=a,o=0,i=t,l=0;for(let e=0;e<a;e++)for(let a=0;a<t;a++)n[(e*t+a)*4+3]>0&&(e<r&&(r=e),e>o&&(o=e),a<i&&(i=a),a>l&&(l=a));if(r>o||i>l)return e;let s=l-i+1,c=o-r+1,d=document.createElement("canvas");return d.width=s,d.height=c,d.getContext("2d").drawImage(e,i,r,s,c,0,0,s,c),d}draw(e,t,a,n,r,o){let i=this.sprites.get(t);if(!(null==i?void 0:i.loaded)||!i.cleaned)return!1;let l=i.cleaned,s=48*r,c=84*r;return e.save(),o>0&&(e.translate(a,0),e.scale(-1,1),e.translate(-a,0)),e.drawImage(l,0,0,l.width,l.height,a-s/2,n-c,s,c),e.restore(),!0}drawTile(e,t,a,n,r){let o=this.envSprites.get("tile");if(!(null==o?void 0:o.loaded)||!o.cleaned)return!1;let i=o.cleaned;return e.drawImage(i,0,0,i.width,i.height,t-n/2,a-r/2,n,r),!0}drawBuilding(e,t,a,n,r,o){let i=this.envSprites.get(t);if(!(null==i?void 0:i.loaded)||!i.cleaned)return!1;let l=i.cleaned;return e.drawImage(l,0,0,l.width,l.height,a-r/2,n-o,r,o),!0}constructor(){this.sprites=new Map,this.envSprites=new Map,this.initialized=!1}}let G=new O;G.init();let H={honest:"#4AE8A0",opportunistic:"#F5C84C",deceptive:"#D084F5",adversarial:"#FF6B6B",rlm:"#5BC8FF",crewai:"#7BF590"},V={honest:"#FFD966",opportunistic:"#FFB347",deceptive:"#FF80FF",adversarial:"#FF4444",rlm:"#80D4FF",crewai:"#FFEE80"};function U(e,t,a,n,r,o){let i=u.baseWidth*o,l=u.baseHeight*o,s=i/2,c=a-l,d=.36*s,h=c+d+.03*l,p=c+.26*l;switch(n){case"honest":var f,g,m,y,x,v=e,b=t,M=h,S=d,_=r;let w=M-1.4*S,k=.2*Math.sin(.003*Date.now());v.strokeStyle=z(_.accent,.25+k),v.lineWidth=4,v.beginPath(),v.ellipse(b,w,.9*S,.28*S,0,0,2*Math.PI),v.stroke(),v.strokeStyle=z(_.accent,.6+k),v.lineWidth=1.5,v.beginPath(),v.ellipse(b,w,.9*S,.28*S,0,0,2*Math.PI),v.stroke();break;case"opportunistic":!function(e,t,a,n,r,o,i){let l=.002*Date.now(),s=(o+a)*.5;for(let a=0;a<4;a++){let r=l+2*Math.PI/4*a,o=t+Math.cos(r)*n*.8,c=s+Math.sin(r)*n*.3,d=.5+.2*Math.sin(l+a);e.fillStyle=z(i.accent,.3*d),e.beginPath(),e.arc(o,c,4,0,2*Math.PI),e.fill(),e.fillStyle=z(i.accent,d),e.beginPath(),e.arc(o,c,2,0,2*Math.PI),e.fill()}}(e,t,a,s,0,p,r);break;case"deceptive":f=e,g=t,m=h,y=d,f.strokeStyle=z((x=r).accent,.5),f.lineWidth=1.2,f.beginPath(),f.moveTo(g-.75*y,m-.2*y),f.quadraticCurveTo(g,m-.5*y,g+.75*y,m-.2*y),f.lineTo(g+.55*y,m+.18*y),f.quadraticCurveTo(g,m+.12*y,g-.55*y,m+.18*y),f.closePath(),f.stroke(),f.fillStyle=z(x.secondary,.08),f.fill();break;case"adversarial":var P=e,T=t,C=h,j=d,F=p,E=s,I=r;P.lineWidth=2;let R=P.createLinearGradient(T-.6*j,C,T-1.2*j,C-1.8*j);R.addColorStop(0,z(I.secondary,.3)),R.addColorStop(1,z(I.secondary,.9)),P.strokeStyle=R,P.beginPath(),P.moveTo(T-.6*j,C-.5*j),P.lineTo(T-1.2*j,C-1.8*j),P.stroke();let N=P.createLinearGradient(T+.6*j,C,T+1.2*j,C-1.8*j);N.addColorStop(0,z(I.secondary,.3)),N.addColorStop(1,z(I.secondary,.9)),P.strokeStyle=N,P.beginPath(),P.moveTo(T+.6*j,C-.5*j),P.lineTo(T+1.2*j,C-1.8*j),P.stroke(),P.fillStyle=z(I.secondary,.9),P.beginPath(),P.arc(T-1.2*j,C-1.8*j,2,0,2*Math.PI),P.fill(),P.beginPath(),P.arc(T+1.2*j,C-1.8*j,2,0,2*Math.PI),P.fill(),P.strokeStyle=z(I.accent,.5),P.lineWidth=1.2,P.beginPath(),P.moveTo(T-.5*E,F),P.lineTo(T-.75*E,F-.35*E),P.stroke(),P.beginPath(),P.moveTo(T+.5*E,F),P.lineTo(T+.75*E,F-.35*E),P.stroke();break;case"rlm":var A=e,D=t,B=h,W=d,L=p,Y=s,q=l,X=r;A.strokeStyle=z(X.accent,.7),A.lineWidth=1.5,A.beginPath(),A.moveTo(D,B-W),A.lineTo(D,B-2*W),A.stroke();let O=.4*Math.sin(.005*Date.now())+.6;A.fillStyle=z(X.accent,O),A.beginPath(),A.arc(D,B-2*W,2.5,0,2*Math.PI),A.fill(),A.strokeStyle=z(X.accent,.3*O),A.lineWidth=3,A.beginPath(),A.arc(D,B-2*W,5,0,2*Math.PI),A.stroke(),A.strokeStyle=z(X.accent,.5),A.lineWidth=1,A.beginPath(),A.rect(D-.7*W,B-.12*W,1.4*W,.24*W),A.stroke(),A.fillStyle=z(X.secondary,.12),A.fill(),A.strokeStyle=z(X.accent,.3),A.lineWidth=.7;let G=L+.12*q;A.beginPath(),A.moveTo(D-.35*Y,G),A.lineTo(D+.35*Y,G),A.moveTo(D-.15*Y,G),A.lineTo(D-.15*Y,G+.08*q),A.moveTo(D+.15*Y,G),A.lineTo(D+.15*Y,G+.08*q),A.moveTo(D,G),A.lineTo(D,G+.1*q),A.stroke(),A.fillStyle=z(X.accent,.6),A.beginPath(),A.arc(D-.15*Y,G+.08*q,1.5,0,2*Math.PI),A.fill(),A.beginPath(),A.arc(D+.15*Y,G+.08*q,1.5,0,2*Math.PI),A.fill(),A.beginPath(),A.arc(D,G+.1*q,1.5,0,2*Math.PI),A.fill();break;case"crewai":var H=e,V=t,U=h,Q=d,K=p,Z=s,$=l,J=r;H.strokeStyle=z(J.accent,.6),H.lineWidth=1.5,H.beginPath(),H.arc(V,U-.2*Q,1.1*Q,Math.PI,0),H.stroke(),H.beginPath(),H.moveTo(V-1.3*Q,U-.2*Q),H.lineTo(V+1.3*Q,U-.2*Q),H.stroke();let ee=K+.25*$;H.strokeStyle=z(J.accent,.45),H.lineWidth=1.2,H.beginPath(),H.moveTo(V-.4*Z,ee),H.lineTo(V+.4*Z,ee),H.stroke(),H.fillStyle=z(J.accent,.7),H.beginPath(),H.arc(V,ee,2,0,2*Math.PI),H.fill(),H.fillStyle=z(J.accent,.4),H.beginPath(),H.arc(V-.2*Z,ee,1.2,0,2*Math.PI),H.fill(),H.beginPath(),H.arc(V+.2*Z,ee,1.2,0,2*Math.PI),H.fill()}}function Q(e,t,a,n,r,o,i){let l=1-i;return{x:l*l*e+2*l*i*a+i*i*r,y:l*l*t+2*l*i*n+i*i*o}}function K(e,t,a){let n=e=>{let t=e.replace("#","");return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]},[r,o,i]=n(e),[l,s,c]=n(t),d=Math.round(r+(l-r)*a),h=Math.round(o+(s-o)*a),u=Math.round(i+(c-i)*a);return"rgb(".concat(d,",").concat(h,",").concat(u,")")}function Z(e){let t=0|e;return()=>{let e=Math.imul((t=t+0x6d2b79f5|0)^t>>>15,1|t);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000}}let $=null,J=-1,ee=[{label:"Posts",color:c.info,getValue:e=>e.total_posts,offsetX:-18},{label:"Votes",color:c.secondary,getValue:e=>e.total_votes,offsetX:0},{label:"Tasks",color:c.accent,getValue:e=>e.total_tasks_completed,offsetX:18}];function et(){let e=(0,r.useRef)(null),{agents:t,arcs:a,viewport:l,hoveredAgent:h,selectedAgent:p,currentEpochSnap:m,environment:y,overlays:x,particles:v,gridSize:M,setHovered:P,setSelected:T,codeTrailSystem:C,digitalRainRef:E,recompileStateRef:I}=A(),{handlePan:R,handleZoom:N,resetCamera:B,resize:Y}=D(),q=(0,r.useRef)(!1),X=(0,r.useRef)({x:0,y:0});(0,r.useEffect)(()=>{let t=e.current;if(!t)return;let a=t.parentElement;if(!a)return;let n=new ResizeObserver(e=>{for(let a of e){let{width:e,height:n}=a.contentRect;t.width=e*devicePixelRatio,t.height=n*devicePixelRatio,t.style.width=e+"px",t.style.height=n+"px",Y(e,n)}});return n.observe(a),()=>n.disconnect()},[Y]),(0,r.useEffect)(()=>{let n=e.current;if(!n)return;let r=n.getContext("2d");r&&(r.save(),r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.scale(devicePixelRatio,devicePixelRatio),function(e,t){let a=t.viewport.width,n=t.viewport.height;e.clearRect(0,0,a,n),function(e,t,a,n){let r=e.createLinearGradient(0,0,0,.7*a),o=Math.min(1,Math.max(0,n)),i=K("#0D1117","#3D1020",o),l=K("#0D1117","#1A0A10",.7*o);r.addColorStop(0,i),r.addColorStop(1,l),e.fillStyle=r,e.fillRect(0,0,t,a),o>.6&&(e.fillStyle=z("#EB5757",(o-.6)*.15*(.5*Math.sin(Date.now()/200)+.5)),e.fillRect(0,0,t,.3*a))}(e,a,n,t.environment.threatLevel),t.overlays.digitalRain&&t.digitalRain&&function(e,t,a,n,r){e.save(),e.font="bold 14px 'Courier New', monospace",e.textAlign="center";let i=o(r,0,1),l=Math.max(0,.4-.4*i);for(let a=0;a<t.columns.length;a++){if(l>0&&7*a%10/10<l)continue;let r=t.columns[a],o=r.chars;for(let t=0;t<o.length;t++){let a=r.headY-t*r.charInterval;if(a<-20||a>n+20)continue;let l=0===t,s=1-t/o.length,c=s*s;if(l)e.fillStyle=i>.5?"rgba(255,".concat(Math.round(180-100*i),",").concat(Math.round(80-60*i),",").concat(.95*r.brightness,")"):"rgba(200,255,220,".concat(.9*r.brightness,")");else{let t=c*r.brightness*.6;if(i>.3){let a=(i-.3)/.7,n=Math.round(200*a),r=Math.round(255*(1-.5*a));e.fillStyle="rgba(".concat(n,",").concat(r,",65,").concat(t,")")}else e.fillStyle=_(t)}e.fillText(o[t],r.x,a)}}e.restore()}(e,t.digitalRain,0,n,t.environment.threatLevel),e.save(),e.translate(t.viewport.x,t.viewport.y),e.scale(t.viewport.zoom,t.viewport.zoom);let r=t.environment.reputationStd+t.environment.payoffStd;if(!function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(let r=0;r<t;r++)for(let o=0;o<t;o++)!function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,{x:o,y:i}=j(t,a),l=n>.3,s=n>.5?"#EB5757":c.accent,d=G.drawTile(e,o,i,96,48);if(!d){F(e,o,i,96,48);let t=e.createLinearGradient(o-48,i,o+48,i);if(l){let e=.12*n;t.addColorStop(0,"rgba(".concat(Math.round(20+200*e),", ").concat(Math.round(8),", ").concat(Math.round(14+30*e),", 0.92)")),t.addColorStop(1,"rgba(".concat(Math.round(12+150*e),", ").concat(Math.round(6),", ").concat(Math.round(10+20*e),", 0.92)"))}else t.addColorStop(0,"rgba(10, 14, 22, 0.92)"),t.addColorStop(1,"rgba(6, 10, 16, 0.92)");e.fillStyle=t,e.fill(),F(e,o,i,96,48),e.strokeStyle=z(s,l?.18:.35),e.lineWidth=.6,e.stroke();let a=l?.1:.2;e.strokeStyle=z(s,a),e.lineWidth=.4,e.beginPath(),e.moveTo(o-24,i),e.lineTo(o+24,i),e.stroke(),e.beginPath(),e.moveTo(o,i-12),e.lineTo(o,i+12),e.stroke(),e.strokeStyle=z(s,.6*a),e.lineWidth=.3,F(e,o,i,48,24),e.stroke(),e.strokeStyle=z(s,.4*a),e.lineWidth=.3,e.beginPath(),e.moveTo(o-12,i-6),e.lineTo(o-28.799999999999997,i-2.4000000000000004),e.stroke(),e.beginPath(),e.moveTo(o+12,i-6),e.lineTo(o+28.799999999999997,i-2.4000000000000004),e.stroke(),e.beginPath(),e.moveTo(o-12,i+6),e.lineTo(o-28.799999999999997,i+2.4000000000000004),e.stroke(),e.beginPath(),e.moveTo(o+12,i+6),e.lineTo(o+28.799999999999997,i+2.4000000000000004),e.stroke();let r=l?.2:.4;e.fillStyle=z(s,r),e.beginPath(),e.arc(o,i,1.2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o,i-12,.96,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o,i+12,.96,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o-24,i,.96,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o+24,i,.96,0,2*Math.PI),e.fill(),e.fillStyle=z(s,.6*r);e.beginPath(),e.arc(o,i-6,.72,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o,i+6,.72,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o-12,i,.72,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(o+12,i,.72,0,2*Math.PI),e.fill()}if(l&&d&&(F(e,o,i,96,48),e.fillStyle=z("#EB5757",.15*n),e.fill()),r>.1){let t=Math.min((r-.1)/.8,1);F(e,o,i,96,48),e.fillStyle=z(t>.5?"#BB6BD9":"#F2994A",.08*t),e.fill()}}(e,r,o,a,n)}(e,t.gridSize,t.environment.toxicity,r),!function(e,t,a){let n;if(a<.2)return;let r=Math.min((a-.2)/.6,1),o=Math.floor(8*r)+1;e.save(),e.strokeStyle=z("#EB5757",.4*r),e.lineWidth=1;let i=(n=42,()=>{let e=Math.imul((n=n+0x6d2b79f5|0)^n>>>15,1|n);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000});for(let a=0;a<o;a++){let{x:a,y:n}=j(i()*t,i()*t);e.beginPath(),e.moveTo(a,n);let r=a,o=n,l=3+Math.floor(4*i());for(let t=0;t<l;t++)r+=(i()-.5)*40,o+=(i()-.5)*28,e.lineTo(r,o);e.stroke()}e.restore()}(e,t.gridSize,t.environment.giniCoefficient),t.overlays.networkWeb&&function(e,t,a,n){if(a<.5||t.length<2)return;let r=Math.round(a),o=t.map(e=>{let t=j(e.gridX,e.gridY);return{x:t.x+e.walkOffsetX,y:t.y+e.walkOffsetY}}),i=(e,t)=>{let a=o[e].x-o[t].x,n=o[e].y-o[t].y;return a*a+n*n},l=new Set,s=t.map(()=>new Set);for(let e=0;e<t.length;e++){let a=[];for(let n=0;n<t.length;n++)e!==n&&a.push({idx:n,d:i(e,n)});a.sort((e,t)=>e.d-t.d);let n=Math.min(r,a.length);for(let t=0;t<n;t++){let n=a[t].idx,r=e<n?"".concat(e,":").concat(n):"".concat(n,":").concat(e);l.add(r),s[e].add(n),s[n].add(e)}}let d=.15+.45*n;for(let t of(e.save(),e.strokeStyle=z(c.accent,d),e.lineWidth=1.2,e.setLineDash([4,6]),l)){let[a,n]=t.split(":"),r=Number(a),i=Number(n);e.beginPath(),e.moveTo(o[r].x,o[r].y),e.lineTo(o[i].x,o[i].y),e.stroke()}if(e.setLineDash([]),n>.5){e.fillStyle=z(c.accent,(n-.5)*.12);let t=new Set;for(let a of l){let[n,r]=a.split(":"),i=Number(n),l=Number(r);for(let a of s[i])if(a!==l&&s[l].has(a)){let n=[i,l,a].sort((e,t)=>e-t),r=n.join(":");if(t.has(r))continue;t.add(r),e.beginPath(),e.moveTo(o[n[0]].x,o[n[0]].y),e.lineTo(o[n[1]].x,o[n[1]].y),e.lineTo(o[n[2]].x,o[n[2]].y),e.closePath(),e.fill()}}}for(let t of(e.fillStyle=z(c.accent,d+.15),e.strokeStyle=z(c.accent,d+.25),e.lineWidth=.8,o))e.beginPath(),e.moveTo(t.x,t.y-3),e.lineTo(t.x+3,t.y),e.lineTo(t.x,t.y+3),e.lineTo(t.x-3,t.y),e.closePath(),e.fill(),e.stroke();e.restore()}(e,t.agents,t.environment.avgDegree,t.environment.avgClustering),t.overlays.threatZones){for(let a of t.agents)if("adversarial"===a.agentType||"deceptive"===a.agentType){let n=j(a.gridX,a.gridY);!function(e,t,a,n,r){if(n<.2)return;let o=.7+.3*Math.sin(2*(Date.now()/1e3)),i=30+20*n,l="adversarial"===r?"#EB5757":"#BB6BD9",s=e.createRadialGradient(t,a,0,t,a,i*o);s.addColorStop(0,z(l,.15*n)),s.addColorStop(.6,z(l,.08*n)),s.addColorStop(1,z(l,0)),e.fillStyle=s,e.beginPath(),e.arc(t,a,i*o,0,2*Math.PI),e.fill()}(e,n.x,n.y,t.environment.threatLevel,a.agentType),function(e,t,a,n,r,o){if(n<1)return;let i=Date.now()/1e3,l=Math.min(Math.floor(n),5),s=.8+.3*Math.min(r,5),c="adversarial"===o?"#EB5757":"#BB6BD9";e.save(),e.lineWidth=1;for(let n=0;n<l;n++){let r=(i*s+.6*n)%2;if(r>1)continue;let o=20+40*r*(1+.3*n),l=(1-r)*.25;e.beginPath(),e.ellipse(t,a,o,.5*o,0,0,2*Math.PI),e.strokeStyle=z(c,l),e.stroke()}e.restore()}(e,n.x,n.y,t.environment.contagionDepth,t.environment.activeThreats,a.agentType)}}t.codeTrails.length>0&&function(e,t){if(0!==t.length){for(let a of(e.save(),e.textAlign="center",t))a.alpha<=0||(e.font="bold ".concat(a.fontSize,"px 'Courier New', monospace"),e.fillStyle=a.color.replace(/[\d.]+\)$/,"".concat(a.alpha,")")),e.fillText(a.char,a.x,a.y));e.restore()}}(e,t.codeTrails);let l=[],h=new Map(t.agents.map(e=>[e.id,e])),p=t.recompileState;for(let e of t.agents)if(l.push(function(e,t){return{depth:e.gridX+e.gridY,render:a=>(function(e,t,a){var n,r,i;let l=j(t.gridX,t.gridY),s=l.x+t.walkOffsetX,c=l.y+t.walkOffsetY,h=d[t.agentType],p=t.scale;e.save(),function(e,t,a,n,r){if(n<=0)return;let i=function(e,t,a,n,r){return 0+30*o((e-0)/200,0,1)}(n,0,0,0,0);if(i<=2)return;let l=e.createRadialGradient(t,a,0,t,a,48+i);l.addColorStop(0,z(r.secondary,.3)),l.addColorStop(1,z(r.secondary,0)),e.fillStyle=l,e.beginPath(),e.ellipse(t,a,48+i,24+i/2,0,0,2*Math.PI),e.fill()}(e,s,c,t.resources,h),function(e,t,a,n,r,i){if(.5>=Math.abs(n))return;let l=u.baseHeight*r,s=n>0,c=o(Math.abs(n)/10,0,.5),d=s?"#F2C94C":"#1A1A2E",h=a-.5*l,p=e.createRadialGradient(t,h,0,t,h,76.80000000000001);p.addColorStop(0,z(d,c)),p.addColorStop(1,z(d,0)),e.fillStyle=p,e.beginPath(),e.ellipse(t,h,76.80000000000001,46.080000000000005,0,0,2*Math.PI),e.fill()}(e,s,c,t.totalPayoff,p,0),t.isQuarantined&&(n=e,r=s,i=c,n.strokeStyle=z("#EB5757",.6+.3*Math.sin(Date.now()/300)),n.lineWidth=2,n.setLineDash([6,4]),n.beginPath(),n.ellipse(r,i,57.599999999999994,28.799999999999997,0,0,2*Math.PI),n.stroke(),n.setLineDash([]));let g=Math.sqrt(t.walkOffsetX**2+t.walkOffsetY**2),m=g>.5,y=t.facing,x=f[t.agentType],v=0;if(m){let e=Math.min(1,g/80),a=Math.sin(2*t.walkPhase);v=Math.abs(a+x.bobAsymmetry*a*a)*x.bobAmplitude*p*e}else v=x.idleBob*Math.sin(.0012*Date.now())*p;if(G.draw(e,t.agentType,s,c-v,p,y)){let a=c-v;e.save(),e.translate(s,0),e.scale(y,1),e.translate(-s,0),U(e,s,a,t.agentType,h,p),e.restore()}else e.save(),e.translate(s,0),e.scale(y,1),e.translate(-s,0),function(e,t,a,n,r,o){let i,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,d=f[n],h=u.baseWidth*o,p=u.baseHeight*o,g=h/2,m=Math.min(1,c/80);if(s){let e=Math.sin(2*l);i=Math.abs(e+d.bobAsymmetry*e*e)*d.bobAmplitude*o*m}else i=d.idleBob*Math.sin(.0012*Date.now())*o;let y=a-i-p,x=y+.22*p,v=y+.26*p,b=y+.38*p,M=y+.52*p,S=y+.58*p,_=y+.78*p,w=a-.04*p,k=s?Math.sin(l)*g*.14*d.legSwingScale*m:0,P=s?-(.18*Math.sin(l))*d.armSwingScale*m:0,T=Date.now(),C=e.createRadialGradient(t,a+3,0,t,a+3,1.2*g);C.addColorStop(0,z(r.secondary,.22)),C.addColorStop(.5,z(r.secondary,.08)),C.addColorStop(1,z(r.secondary,0)),e.fillStyle=C,e.beginPath(),e.ellipse(t,a+3,+g,.28*g,0,0,2*Math.PI),e.fill();let j=e.createLinearGradient(t-.25*g,S,t-.15*g,a);j.addColorStop(0,"#0E0E18"),j.addColorStop(.5,"#0A0A12"),j.addColorStop(1,"#060610"),e.fillStyle=j,e.beginPath(),e.moveTo(t-.22*g,S),e.quadraticCurveTo(t-.28*g,_,t-.3*g+k,a),e.lineTo(t-.02*g+k,a),e.quadraticCurveTo(t-.04*g,_,t-.02*g,S),e.closePath(),e.fill(),e.strokeStyle=z(r.secondary,.12),e.lineWidth=.6,e.beginPath(),e.moveTo(t-.22*g,S),e.quadraticCurveTo(t-.28*g,_,t-.3*g+k,a),e.stroke(),e.fillStyle="#060610",e.beginPath(),e.moveTo(t+.02*g,S),e.quadraticCurveTo(t+.04*g,_,t+.02*g-k,a),e.lineTo(t+.3*g-k,a),e.quadraticCurveTo(t+.28*g,_,t+.22*g,S),e.closePath(),e.fill(),e.fillStyle=z(r.secondary,.2),e.beginPath(),e.ellipse(t-.15*g+k,a-1,.16*g,2,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(t+.15*g-k,a-1,.16*g,2,0,0,2*Math.PI),e.fill();let F=e.createLinearGradient(t-.35*g,v,t+.35*g,M);F.addColorStop(0,"#10101A"),F.addColorStop(.5,"#0A0A14"),F.addColorStop(1,"#060610"),e.fillStyle=F,e.beginPath(),e.moveTo(t-.38*g,v),e.lineTo(t+.38*g,v),e.lineTo(t+.28*g,M),e.quadraticCurveTo(t,M+2,t-.28*g,M),e.closePath(),e.fill();let E=Math.sin(.002*T+.01*t)*g*.05,I=Math.sin(.004*T+.02*t)*g*.02,R=e.createLinearGradient(t,v-4,t,w);R.addColorStop(0,z(r.secondary,.4)),R.addColorStop(.3,z(r.secondary,.3)),R.addColorStop(.7,z(r.secondary,.2)),R.addColorStop(1,z(r.secondary,.08)),e.fillStyle=R,e.beginPath(),e.moveTo(t-.48*g,v-2),e.lineTo(t+.48*g,v-2),e.quadraticCurveTo(t+.9*g+E,b,t+.85*g+E,M),e.quadraticCurveTo(t+.88*g+E+I,S,t+.82*g+E,w),e.lineTo(t-.82*g-E,w),e.quadraticCurveTo(t-.88*g-E-I,S,t-.85*g-E,M),e.quadraticCurveTo(t-.9*g-E,b,t-.48*g,v-2),e.closePath(),e.fill();let N=e.createLinearGradient(t,v,t,w);N.addColorStop(0,z(r.primary,.2)),N.addColorStop(1,z(r.primary,.05)),e.fillStyle=N,e.beginPath(),e.moveTo(t-.1*g,v+.06*p),e.lineTo(t+.1*g,v+.06*p),e.lineTo(t+.25*g+.5*E,w),e.lineTo(t-.25*g-.5*E,w),e.closePath(),e.fill(),e.fillStyle=z(r.secondary,.5),e.beginPath(),e.moveTo(t-.38*g,v-4),e.quadraticCurveTo(t-.45*g,v-6,t-.42*g,x),e.lineTo(t-.2*g,x+2),e.lineTo(t-.28*g,v-2),e.closePath(),e.fill(),e.beginPath(),e.moveTo(t+.38*g,v-4),e.quadraticCurveTo(t+.45*g,v-6,t+.42*g,x),e.lineTo(t+.2*g,x+2),e.lineTo(t+.28*g,v-2),e.closePath(),e.fill(),e.lineWidth=1.4,e.strokeStyle=z(r.secondary,.55),e.beginPath(),e.moveTo(t-.48*g,v-2),e.quadraticCurveTo(t-.9*g-E,b,t-.85*g-E,M),e.quadraticCurveTo(t-.88*g-E,S,t-.82*g-E,w),e.stroke(),e.beginPath(),e.moveTo(t+.48*g,v-2),e.quadraticCurveTo(t+.9*g+E,b,t+.85*g+E,M),e.quadraticCurveTo(t+.88*g+E,S,t+.82*g+E,w),e.stroke(),e.lineWidth=.8,e.strokeStyle=z(r.secondary,.3),e.beginPath(),e.moveTo(t-.82*g-E,w),e.lineTo(t+.82*g+E,w),e.stroke(),e.strokeStyle=z(r.secondary,.35),e.lineWidth=.6,e.beginPath(),e.moveTo(t,v+.04*p),e.lineTo(t,w),e.stroke(),e.lineWidth=.5,e.strokeStyle=z(r.secondary,.25),e.beginPath(),e.moveTo(t-.05*g,v+.04*p),e.lineTo(t-.15*g,b),e.stroke(),e.beginPath(),e.moveTo(t+.05*g,v+.04*p),e.lineTo(t+.15*g,b),e.stroke(),e.strokeStyle=z(r.secondary,.1),e.lineWidth=.4;let A=.04*p,D=.001*T;for(let a=v+A;a<w;a+=A){let n=(a-v)/(w-v),o=.02*Math.sin(D+6*n),i=g*(.48+.34*n+o),l=.06+.04*Math.sin(.005*T+10*n);e.strokeStyle=z(r.secondary,l),e.beginPath(),e.moveTo(t-i,a),e.lineTo(t+i,a),e.stroke()}e.save();let B=.002*T;for(let a=0;a<6;a++){let n=(.8*B+1.3*a)%2.5;if(n>1)continue;let i=v+(.19*a+.07*B)%1*(w-v),l=t+Math.sin(2.7*a+.0015*T)*g*.5,s=(1+.5*Math.sin(3.1*a+.003*T))*o;e.globalAlpha=.7*Math.sin(n*Math.PI),e.fillStyle=r.accent,e.beginPath(),e.arc(l,i,s,0,2*Math.PI),e.fill()}e.globalAlpha=1,e.restore();let W=t+.72*g-P*g,L=v+.26*p,Y=e.createLinearGradient(t+.45*g,v,W,L);Y.addColorStop(0,z(r.secondary,.3)),Y.addColorStop(1,z(r.secondary,.15)),e.fillStyle=Y,e.beginPath(),e.moveTo(t+.45*g,v),e.quadraticCurveTo(t+.6*g,v+.1*p,W,L),e.lineTo(W-.12*g,L+.02*p),e.quadraticCurveTo(t+.5*g,v+.12*p,t+.35*g,v+.04*p),e.closePath(),e.fill(),e.strokeStyle=z(r.secondary,.3),e.lineWidth=.7,e.beginPath(),e.moveTo(t+.45*g,v),e.quadraticCurveTo(t+.6*g,v+.1*p,W,L),e.stroke();let q=e.createRadialGradient(W-.06*g,L,0,W-.06*g,L,4*o);q.addColorStop(0,z(V[n],.7)),q.addColorStop(1,z(V[n],0)),e.fillStyle=q,e.beginPath(),e.arc(W-.06*g,L,4*o,0,2*Math.PI),e.fill(),e.fillStyle=z(V[n],.8),e.beginPath(),e.arc(W-.06*g,L,1.8*o,0,2*Math.PI),e.fill();let X=t-.72*g+P*g,O=v+.26*p,G=e.createLinearGradient(t-.45*g,v,X,O);G.addColorStop(0,z(r.secondary,.35)),G.addColorStop(1,z(r.secondary,.18)),e.fillStyle=G,e.beginPath(),e.moveTo(t-.45*g,v),e.quadraticCurveTo(t-.6*g,v+.1*p,X,O),e.lineTo(X+.12*g,O+.02*p),e.quadraticCurveTo(t-.5*g,v+.12*p,t-.35*g,v+.04*p),e.closePath(),e.fill(),e.strokeStyle=z(r.secondary,.35),e.lineWidth=.7,e.beginPath(),e.moveTo(t-.45*g,v),e.quadraticCurveTo(t-.6*g,v+.1*p,X,O),e.stroke();let U=e.createRadialGradient(X+.06*g,O,0,X+.06*g,O,4*o);U.addColorStop(0,z(V[n],.7)),U.addColorStop(1,z(V[n],0)),e.fillStyle=U,e.beginPath(),e.arc(X+.06*g,O,4*o,0,2*Math.PI),e.fill(),e.fillStyle=z(V[n],.8),e.beginPath(),e.arc(X+.06*g,O,1.8*o,0,2*Math.PI),e.fill(),e.fillStyle="#0A0A12",e.beginPath(),e.rect(t-.1*g,x,.2*g,v-x+2),e.fill();let Q=.36*g,K=y+Q+.03*p,Z=e.createRadialGradient(t-.3*Q,K-.2*Q,.1*Q,t,K,Q);Z.addColorStop(0,"#14141E"),Z.addColorStop(.7,"#0A0A14"),Z.addColorStop(1,"#06060E"),e.fillStyle=Z,e.beginPath(),e.arc(t,K,Q,0,2*Math.PI),e.fill();let $=H[n],J=function(e,t){let a=e.replace("#",""),n=Math.max(0,parseInt(a.substring(0,2),16)-60),r=Math.max(0,parseInt(a.substring(2,4),16)-60),o=Math.max(0,parseInt(a.substring(4,6),16)-t);return"rgb(".concat(n,",").concat(r,",").concat(o,")")}($,60),ee=e.createRadialGradient(t-.2*Q,K-.5*Q,.2*Q,t,K-.2*Q,1.15*Q);ee.addColorStop(0,$),ee.addColorStop(.7,$),ee.addColorStop(1,J),e.fillStyle=ee,e.beginPath(),e.arc(t,K-.12*Q,1.08*Q,1.05*Math.PI,-.05*Math.PI),e.closePath(),e.fill(),e.fillStyle=J,e.beginPath(),e.moveTo(t-1.08*Q,K-.12*Q),e.quadraticCurveTo(t-1.12*Q,K+.2*Q,t-Q,K+.55*Q),e.quadraticCurveTo(t-.85*Q,K+.7*Q,t-.65*Q,K+.65*Q),e.lineTo(t-.88*Q,K),e.closePath(),e.fill(),e.beginPath(),e.moveTo(t+1.08*Q,K-.12*Q),e.quadraticCurveTo(t+1.12*Q,K+.2*Q,t+ +Q,K+.55*Q),e.quadraticCurveTo(t+.85*Q,K+.7*Q,t+.65*Q,K+.65*Q),e.lineTo(t+.88*Q,K),e.closePath(),e.fill(),e.fillStyle=$,e.beginPath(),e.moveTo(t-1.06*Q,K-.1*Q),e.quadraticCurveTo(t-1.08*Q,K+.1*Q,t-.98*Q,K+.45*Q),e.lineTo(t-.9*Q,K+.1*Q),e.closePath(),e.fill(),e.fillStyle=z("#FFFFFF",.2),e.beginPath(),e.ellipse(t-.15*Q,K-.55*Q,.5*Q,.12*Q,-.2,0,2*Math.PI),e.fill();let et=e.createRadialGradient(t,K-.3*Q,0,t,K-.3*Q,1.8*Q);et.addColorStop(0,z($,.25)),et.addColorStop(1,z($,0)),e.fillStyle=et,e.beginPath(),e.arc(t,K-.3*Q,1.8*Q,0,2*Math.PI),e.fill();let ea=V[n],en=K+.08*Q,er=.36*Q,eo=.2*Q,ei=.16*Q,el=e.createRadialGradient(t,en,0,t,en,.9*Q);el.addColorStop(0,z(ea,.2)),el.addColorStop(1,z(ea,0)),e.fillStyle=el,e.beginPath(),e.arc(t,en,.9*Q,0,2*Math.PI),e.fill();let es=e.createRadialGradient(t-er,en,.2*eo,t-er,en,eo);es.addColorStop(0,"#FFFFFF"),es.addColorStop(.3,ea),es.addColorStop(1,z(ea,.6)),e.fillStyle=es,e.beginPath(),e.ellipse(t-er,en,eo,ei,0,0,2*Math.PI),e.fill(),e.strokeStyle=z(ea,.5),e.lineWidth=.6,e.beginPath(),e.ellipse(t-er,en,1.3*eo,1.3*ei,0,0,2*Math.PI),e.stroke();let ec=e.createRadialGradient(t+er,en,.2*eo,t+er,en,eo);ec.addColorStop(0,"#FFFFFF"),ec.addColorStop(.3,ea),ec.addColorStop(1,z(ea,.6)),e.fillStyle=ec,e.beginPath(),e.ellipse(t+er,en,eo,ei,0,0,2*Math.PI),e.fill(),e.strokeStyle=z(ea,.5),e.lineWidth=.6,e.beginPath(),e.ellipse(t+er,en,1.3*eo,1.3*ei,0,0,2*Math.PI),e.stroke(),e.strokeStyle=z(ea,.35),e.lineWidth=.8,e.beginPath(),e.arc(t,en+.28*Q,.22*Q,.15*Math.PI,.85*Math.PI),e.stroke(),e.strokeStyle=z(ea,.15),e.lineWidth=.5,e.beginPath(),e.moveTo(t,en+.02*Q),e.lineTo(t-.05*Q,en+.15*Q),e.stroke()}(e,s,c,t.agentType,h,p,t.walkPhase,m,g),U(e,s,c,t.agentType,h,p),e.restore();t.isFrozen&&function(e,t,a,n){let r=u.baseWidth*n,o=u.baseHeight*n,i=r/2;e.save(),e.globalAlpha=.3,e.fillStyle="#A8CFF5",e.beginPath(),e.ellipse(t,a-.5*o,.6*i,.5*o,0,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.strokeStyle=z("#A8CFF5",.6),e.lineWidth=1.5,e.setLineDash([3,3]),e.beginPath(),e.ellipse(t,a-.5*o,.7*i,.55*o,0,0,2*Math.PI),e.stroke(),e.setLineDash([]),e.restore()}(e,s,c,p),function(e,t,a,n,r){let o=a-u.baseHeight*r-10*r,i=L(n),l=4*r,s=e.createRadialGradient(t,o,0,t,o,4*l);s.addColorStop(0,z(i,.35)),s.addColorStop(1,z(i,0)),e.fillStyle=s,e.beginPath(),e.arc(t,o,4*l,0,2*Math.PI),e.fill();let c=e.createRadialGradient(t-.3*l,o-.3*l,.1*l,t,o,l);c.addColorStop(0,"#FFFFFF"),c.addColorStop(.3,i),c.addColorStop(1,z(i,.7)),e.fillStyle=c,e.beginPath(),e.arc(t,o,l,0,2*Math.PI),e.fill()}(e,s,c,t.avgP,p),a&&function(e,t,a,n){let r=u.baseWidth*n,o=u.baseHeight*n,i=r/2;e.strokeStyle=z("#FFFFFF",.3),e.lineWidth=4,e.beginPath(),e.ellipse(t,a-.5*o,.7*i,.54*o,0,0,2*Math.PI),e.stroke(),e.strokeStyle=z("#FFFFFF",.8),e.lineWidth=1.5,e.beginPath(),e.ellipse(t,a-.5*o,.68*i,.52*o,0,0,2*Math.PI),e.stroke()}(e,s,c,p),e.restore()})(a,e,e.id===t)}}(e,t.hoveredAgent)),p&&p.active){let t=j(e.gridX,e.gridY),a=t.x+e.walkOffsetX,n=t.y+e.walkOffsetY;l.push({depth:e.gridX+e.gridY+.1,render:t=>(function(e,t,a,n,r,o){let i=Date.now()-r;if(i>o||i<0)return;let l=i/o,s=1-l,c=a-56*n-8*n;e.save(),e.font=k,e.textAlign="center";let d=3+Math.floor(3*Math.random()),h=Math.floor(i/40);for(let a=0;a<d;a++){let n=String.fromCharCode(65382+(31*h+17*a>>>0)%56%56),r=(a-(d-1)/2)*8,o=-(6*Math.sin(l*Math.PI));e.fillStyle=_(.8*s),e.fillText(n,t+r,c+o)}e.restore()})(t,a,n,e.scale,p.startTime,p.duration)})}let m=new Set(t.agents.map(e=>"".concat(e.gridX,",").concat(e.gridY)));for(let e of function(e,t){if(J===e&&$)return $;let a=Z(7919),n=[],r=["tower","spire","node"];for(let o=0;o<e;o++)for(let i=0;i<e;i++)!t.has("".concat(o,",").concat(i))&&(a()>.15||n.push({gridX:o,gridY:i,type:r[Math.floor(a()*r.length)],seed:Math.floor(1e4*a())}));return $=n,J=e,n}(t.gridSize,m))l.push(function(e,t,a){return{depth:e.gridX+e.gridY-.3,render:n=>(function(e,t,a,n){let r=j(t.gridX,t.gridY),o=r.x,i=r.y,l=n?Math.max(0,Math.min(1,(n.total_welfare+50)/100)):.5,s=a.threatLevel,d=s>.4?W(c.accent,c.alert,Math.min((s-.4)/.4,1)):c.accent,h=.4+.6*l;switch(e.save(),t.type){case"tower":!function(e,t,a,n,r,o,i){let l=20+100*n;G.drawBuilding(e,"tower",t,a,44.24,l)||(e.beginPath(),e.moveTo(t,a),e.lineTo(t+21.12,a-10.56),e.lineTo(t+21.12,a-10.56-l),e.lineTo(t,a-l),e.closePath(),e.fillStyle=z("#1A2233",.9*o),e.fill(),e.strokeStyle=z(r,.3*o),e.lineWidth=.5,e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(t-21.12,a-10.56),e.lineTo(t-21.12,a-10.56-l),e.lineTo(t,a-l),e.closePath(),e.fillStyle=z("#0F1620",.9*o),e.fill(),e.strokeStyle=z(r,.25*o),e.lineWidth=.5,e.stroke(),e.beginPath(),e.moveTo(t,a-l-10.56),e.lineTo(t+21.12,a-10.56-l),e.lineTo(t,a-l),e.lineTo(t-21.12,a-10.56-l),e.closePath(),e.fillStyle=z("#243040",.9*o),e.fill(),e.strokeStyle=z(r,.4*o),e.lineWidth=.5,e.stroke());let s=Z(i),c=Math.max(2,Math.floor(l/14));for(let n=0;n<c;n++)for(let i=0;i<2;i++){let c=a-6-12*n,d=t+3+8*i;!(c<a-l+4)&&s()>.3&&(e.fillStyle=z(r,o*(.4+.4*s())),e.fillRect(d,c,4,3))}for(let n=0;n<c;n++)for(let i=0;i<2;i++){let c=a-6-12*n,d=t-7-8*i;!(c<a-l+4)&&s()>.3&&(e.fillStyle=z(r,o*(.3+.3*s())),e.fillRect(d,c,4,3))}let d=8+12*n;e.beginPath(),e.moveTo(t,a-l-10.56),e.lineTo(t,a-l-10.56-d),e.strokeStyle=z(r,.6*o),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(t,a-l-10.56-d,1.5,0,2*Math.PI),e.fillStyle=z(r,.8*o),e.fill(),e.strokeStyle=z(r,.06*o),e.lineWidth=.5;for(let n=a-l;n<a;n+=3)e.beginPath(),e.moveTo(t-21.12,n),e.lineTo(t+21.12,n),e.stroke()}(e,o,i,l,d,h,t.seed);break;case"spire":!function(e,t,a,n,r,o,i){var l;let s=Math.min((null!=(l=null==n?void 0:n.avg_degree)?l:2)/8,1),c=30+90*s;G.drawBuilding(e,"spire",t,a,6,c)||(e.beginPath(),e.moveTo(t-3,a),e.lineTo(t+3,a),e.lineTo(t+1,a-c),e.lineTo(t-1,a-c),e.closePath(),e.fillStyle=z("#1A2233",.8*o),e.fill(),e.strokeStyle=z(r,.3*o),e.lineWidth=.5,e.stroke());let d=Date.now(),h=2+ +(s>.5);for(let n=0;n<h;n++){let i=(d/1200+.8*n)%1,l=a-.4*c-n*c*.2,h=6+10*i,u=3+5*i,p=(1-i)*o*.5*s;e.beginPath(),e.ellipse(t,l,h,u,0,0,2*Math.PI),e.strokeStyle=z(r,p),e.lineWidth=1,e.stroke()}e.beginPath(),e.arc(t,a-c,2,0,2*Math.PI),e.fillStyle=z(r,.7*o),e.fill()}(e,o,i,n,d,h,t.seed);break;case"node":!function(e,t,a,n,r,o,i){let l=1-n,s=12+18*l;G.drawBuilding(e,"node",t,a,36.56,s)||(e.beginPath(),e.moveTo(t,a),e.lineTo(t+17.28,a-8.64),e.lineTo(t+17.28,a-8.64-s),e.lineTo(t,a-s),e.closePath(),e.fillStyle=z("#1A2233",.85*o),e.fill(),e.beginPath(),e.moveTo(t,a),e.lineTo(t-17.28,a-8.64),e.lineTo(t-17.28,a-8.64-s),e.lineTo(t,a-s),e.closePath(),e.fillStyle=z("#0F1620",.85*o),e.fill(),e.beginPath(),e.moveTo(t,a-s-8.64),e.lineTo(t+17.28,a-8.64-s),e.lineTo(t,a-s),e.lineTo(t-17.28,a-8.64-s),e.closePath(),e.fillStyle=z("#243040",.85*o),e.fill(),e.strokeStyle=z(r,.3*o),e.lineWidth=.5,e.beginPath(),e.moveTo(t,a),e.lineTo(t+17.28,a-8.64),e.lineTo(t+17.28,a-8.64-s),e.lineTo(t,a-s),e.stroke(),e.beginPath(),e.moveTo(t,a),e.lineTo(t-17.28,a-8.64),e.lineTo(t-17.28,a-8.64-s),e.lineTo(t,a-s),e.stroke());let c=10+14*l,d=e.createRadialGradient(t,a-s-4.32,0,t,a-s-4.32,c);d.addColorStop(0,z(r,l*o*.5)),d.addColorStop(1,z(r,0)),e.fillStyle=d,e.beginPath(),e.arc(t,a-s-4.32,c,0,2*Math.PI),e.fill()}(e,o,i,s,d,h,t.seed)}e.restore()})(n,e,t,a)}}(e,t.environment,t.epoch));if(t.epoch&&l.push({depth:t.gridSize-2+1-.2,render:e=>(function(e,t,a){if(!a||0===a.total_posts+a.total_votes+a.total_tasks_completed)return;let n=j(t-2,1),r=n.x,o=n.y,i=Math.max(1,a.total_posts,a.total_votes,a.total_tasks_completed);for(let t of(e.save(),ee)){let n=t.getValue(a);if(0===n)continue;let l=r+t.offsetX,s=Math.min(n/i,1),c=8+50*s,d=.5+.3*s;e.beginPath(),e.moveTo(l,o),e.lineTo(l+5.76,o-2.88),e.lineTo(l+5.76,o-2.88-c),e.lineTo(l,o-c),e.closePath(),e.fillStyle=z(t.color,.5*d),e.fill(),e.beginPath(),e.moveTo(l,o),e.lineTo(l-5.76,o-2.88),e.lineTo(l-5.76,o-2.88-c),e.lineTo(l,o-c),e.closePath(),e.fillStyle=z(t.color,.35*d),e.fill(),e.beginPath(),e.moveTo(l,o-c-2.88),e.lineTo(l+5.76,o-2.88-c),e.lineTo(l,o-c),e.lineTo(l-5.76,o-2.88-c),e.closePath(),e.fillStyle=z(t.color,.6*d),e.fill(),e.strokeStyle=z(t.color,.4*d),e.lineWidth=.5,e.beginPath(),e.moveTo(l,o),e.lineTo(l+5.76,o-2.88),e.lineTo(l+5.76,o-2.88-c),e.lineTo(l,o-c),e.lineTo(l-5.76,o-2.88-c),e.lineTo(l-5.76,o-2.88),e.closePath(),e.stroke(),e.strokeStyle=z(t.color,.06),e.lineWidth=.4;for(let t=o-c;t<o;t+=4)e.beginPath(),e.moveTo(l-5.76,t),e.lineTo(l+5.76,t),e.stroke();e.font="bold 7px 'Courier New', monospace",e.textAlign="center",e.fillStyle=z(t.color,.8),e.fillText(String(n),l,o-c-2.88-4)}e.restore()})(e,t.gridSize,t.epoch)}),t.overlays.interactions)for(let e of t.arcs){let a=function(e,t,a){let n=t.get(e.fromId),r=t.get(e.toId);if(!n||!r)return null;let o=a===e.fromId||a===e.toId;return{depth:Math.max(n.gridX+n.gridY,r.gridX+r.gridY)+.5,render:t=>(function(e,t,a,n,r){let o=j(a.gridX,a.gridY),l=j(n.gridX,n.gridY),c={x:o.x+a.walkOffsetX,y:o.y+a.walkOffsetY},d=c.y-a.scale*u.baseHeight*.6,h=l.y-n.scale*u.baseHeight*.6,p=L(t.p),f=1-Math.pow(1-t.progress,3),m=(c.x+l.x)/2,y=Math.min(d,h)-40-.15*Math.abs(c.x-l.x);e.save();let x=function(e){switch(e){case"communication":return{dash:[2,4],widthBonus:0,double:!1};case"task":return{dash:[],widthBonus:.5,double:!1};case"governance":return{dash:[],widthBonus:0,double:!0};default:return{dash:[],widthBonus:0,double:!1}}}(t.interactionType);if(t.accepted){if(e.strokeStyle=z(p,r?.15:.08),e.lineWidth=1+x.widthBonus,x.dash.length>0&&e.setLineDash(x.dash),e.beginPath(),e.moveTo(c.x,d),e.quadraticCurveTo(m,y,l.x,h),e.stroke(),x.double&&(e.beginPath(),e.moveTo(c.x,d-2),e.quadraticCurveTo(m,y-2,l.x,h-2),e.stroke()),x.dash.length>0&&e.setLineDash([]),f>.01){e.strokeStyle=z(p,r?.5:.25),e.lineWidth=(r?2:1)+x.widthBonus,x.dash.length>0&&e.setLineDash(x.dash),e.beginPath(),e.moveTo(c.x,d);let t=Math.max(8,Math.floor(30*f));for(let a=1;a<=t;a++){let n=a/t*f,r=Q(c.x,d,m,y,l.x,h,n);e.lineTo(r.x,r.y)}if(e.stroke(),x.double){e.beginPath(),e.moveTo(c.x,d-2);let t=Math.max(8,Math.floor(30*f));for(let a=1;a<=t;a++){let n=a/t*f,r=Q(c.x,d-2,m,y-2,l.x,h-2,n);e.lineTo(r.x,r.y)}e.stroke()}x.dash.length>0&&e.setLineDash([])}if(f<1&&function(e,t,a,n,r,o,i,l,c,d,h){var u,p,f,m;let y=s(t.id),x=Date.now(),v=Math.max(0,Math.min(1,t.p)),M=Math.round((u=g.charCountMin,u+(g.charCountMax-u)*v)),S=(p=g.charSpacingMax,p+(g.charSpacingMin-p)*v),_=(f=g.mutateIntervalMax,f+(g.mutateIntervalMin-f)*v),P=(m=g.glowRadiusMin,m+(g.glowRadiusMax-m)*v);e.save(),e.font=k,e.textAlign="center";for(let s=0;s<M;s++){let u=c-s*S;if(u<0||u>1)continue;let p=Q(a,n,r,o,i,l,u),f=b(y+31*s+Math.floor(x/_)),g=(1-s/M)*(h?.9:.7);if(0===s){e.fillStyle="rgba(255,255,255,".concat(g,")"),e.fillText(f,p.x,p.y);let t=e.createRadialGradient(p.x,p.y,0,p.x,p.y,P);t.addColorStop(0,z(d,.4)),t.addColorStop(1,z(d,0)),e.fillStyle=t,e.beginPath(),e.arc(p.x,p.y,P,0,2*Math.PI),e.fill()}else e.fillStyle=w(t.p,g),e.fillText(f,p.x,p.y)}e.restore()}(e,t,c.x,d,m,y,l.x,h,f,p,r),f>=.45&&f<=.55&&function(e,t,a,n,r,o,i,l,c,d){let h=s(t.id),u=Date.now(),p=(a+r)/2,f=(n+o)/2-15,m=.7*Math.sin((c-.45)/.1*Math.PI);e.save(),e.font=k,e.textAlign="center";let{gridSize:y,gridSpacing:x}=g,v=Math.floor(u/60);for(let a=0;a<y;a++)for(let n=0;n<y;n++){let r=p+(n-1)*x,o=f+(a-1)*x,i=b(h+7*a+13*n+v);e.fillStyle=w(t.p,m*(.5+.5*Math.random())),e.fillText(i,r,o)}e.restore()}(e,t,c.x,d,l.x,h,0,0,f,0),f>.95){let t=(1-(f-.95)/.05)*.6,a=6+(f-.95)/.05*12,n=e.createRadialGradient(l.x,h,0,l.x,h,a);n.addColorStop(0,z(p,t)),n.addColorStop(1,z(p,0)),e.fillStyle=n,e.beginPath(),e.arc(l.x,h,a,0,2*Math.PI),e.fill()}}else{if(e.strokeStyle=z(p,(r?.7:.3)*(1-.5*f)),e.lineWidth=r?2:1,e.setLineDash([4,4]),e.beginPath(),e.moveTo(c.x,d),e.quadraticCurveTo(m,y,l.x,h),e.stroke(),function(e,t,a,n,r,o,i,l,c,d){if(c<.15||c>.9)return;let h=s(t.id),u=Date.now();e.save(),e.font=k,e.textAlign="center";for(let t=0;t<6;t++){let s=.8*c-.06*t;if(s<0||s>1)continue;let p=Q(a,n,r,o,i,l,s),f=h+17*t+Math.floor(u/100),g=S(f),m=(c-.15)*15,y=p.x+Math.sin(f)*m,x=p.y+Math.cos(1.3*f)*m,v=(1-t/6)*(d?.7:.4)*(1-c);e.fillStyle="rgba(235,87,87,".concat(v,")"),e.fillText(g,y,x)}e.restore()}(e,t,c.x,d,m,y,l.x,h,f,r),f>.2&&f<.85){let t=Q(c.x,d,m,y,l.x,h,.5);e.strokeStyle=z("#EB5757",.8*(f<.5?i((f-.2)/.3):1-i((f-.5)/.35))),e.lineWidth=2,e.setLineDash([]),e.beginPath(),e.moveTo(t.x-5,t.y-5),e.lineTo(t.x+5,t.y+5),e.moveTo(t.x+5,t.y-5),e.lineTo(t.x-5,t.y+5),e.stroke()}if(f>.3&&f<.8){let a=Q(c.x,d,m,y,l.x,h,.5),n=1-(f-.3)/.5,r=s(t.id);e.font=k,e.textAlign="center";for(let t=0;t<6;t++){let o=t/6*Math.PI*2+3*f,i=(f-.3)*35,l=S(r+13*t+Math.floor(5*f));e.fillStyle=z("#EB5757",.7*n),e.fillText(l,a.x+Math.cos(o)*i,a.y+Math.sin(o)*i)}}}e.restore()})(t,e,n,r,o)}}(e,h,t.hoveredAgent);a&&l.push(a)}for(let t of l.slice().sort((e,t)=>e.depth-t.depth))t.render(e);if(t.overlays.collusionLines&&t.environment.collusionRisk>.1){let a=new Set(["adversarial","deceptive","opportunistic"]),n=t.agents.filter(e=>a.has(e.agentType));for(let a=0;a<n.length;a++)for(let r=a+1;r<n.length;r++)!function(e,t,a,n){let r=j(t.gridX,t.gridY),o=j(a.gridX,a.gridY),i=r.y-t.scale*u.baseHeight*.3,l=o.y-a.scale*u.baseHeight*.3;e.save();let s=Date.now()/1e3;for(let t=0;t<2;t++){let a=0===t?1:-1;e.strokeStyle=z("#5B2D8B",n*(.3+.15*t)),e.lineWidth=1.5-.5*t,e.beginPath();for(let c=0;c<=20;c++){let d=c/20,h=r.x+(o.x-r.x)*d,u=i+(l-i)*d,p=6*Math.sin(d*Math.PI*4+2.5*s+t)*a*n,f=h+.3*p,g=u+p;0===c?e.moveTo(f,g):e.lineTo(f,g)}e.stroke()}for(let t=0;t<3;t++){let a=(.8*s+.33*t)%1,c=r.x+(o.x-r.x)*a,d=i+(l-i)*a;e.fillStyle=z("#BB6BD9",Math.sin(a*Math.PI)*n*.6),e.beginPath(),e.arc(c,d,2.5,0,2*Math.PI),e.fill()}e.restore()}(e,n[a],n[r],t.environment.collusionRisk)}if(t.environment.avgSynergyScore>.1){let a=new Set(["cooperative","altruistic"]),n=t.agents.filter(e=>a.has(e.agentType));for(let a=0;a<n.length;a++)for(let r=a+1;r<n.length;r++)!function(e,t,a,n){let r=j(t.gridX,t.gridY),o=j(a.gridX,a.gridY),i=r.y-t.scale*u.baseHeight*.3,l=o.y-a.scale*u.baseHeight*.3;e.save();let s=Date.now()/1e3,c=(r.x+o.x)/2,d=(i+l)/2-20;e.strokeStyle=z("#F2C94C",.3*n),e.lineWidth=1.5,e.beginPath(),e.moveTo(r.x,i),e.quadraticCurveTo(c,d,o.x,l),e.stroke();for(let t=0;t<4;t++){let a=(.5*s+.25*t)%1,h=1-a,u=h*h*r.x+2*h*a*c+a*a*o.x,p=h*h*i+2*h*a*d+a*a*l;e.fillStyle=z("#F2C94C",Math.sin(a*Math.PI)*n*.5),e.beginPath(),e.arc(u,p,2,0,2*Math.PI),e.fill()}e.restore()}(e,n[a],n[r],t.environment.avgSynergyScore)}if(t.overlays.particles&&function(e,t){for(let a of t){let t=a.life/a.maxLife;e.fillStyle=z(a.color,a.alpha*t),e.beginPath(),e.arc(a.x,a.y,a.size*t,0,2*Math.PI),e.fill()}}(e,t.particles),e.restore(),!function(e,t,a,n){if(n<.05)return;let r=Math.min(n,1),o=n>.5?"#EB5757":"#6FCF97",i=Date.now()/1e3,l=e.createLinearGradient(0,.55*a,0,a);l.addColorStop(0,z(o,0)),l.addColorStop(.5,z(o,.08*r)),l.addColorStop(1,z(o,.18*r)),e.fillStyle=l,e.fillRect(0,0,t,a);for(let n=0;n<2;n++){let l=a*(.7+.12*n),s=r*(.06-.02*n);e.beginPath(),e.moveTo(0,a);for(let a=0;a<=t;a+=8){let t=l+8*Math.sin(.01*a+i*(.5+.3*n));e.lineTo(a,t)}e.lineTo(t,a),e.closePath(),e.fillStyle=z(o,s),e.fill()}}(e,a,n,t.environment.toxicity),t.overlays.tierraStrip&&function(e,t,a,n,r){if(0===t.length)return;let o=r-18-4-56,i=t.reduce((e,t)=>e+Math.max(t.resources,1),0);if(i<=0)return;e.save(),e.fillStyle=z("#000000",.6),e.fillRect(0,o-1,n,20);let l=0;for(let r of t){let t=Math.max(r.resources,1)/i*n,s=d[r.agentType],c=0!==r.walkOffsetX||0!==r.walkOffsetY;if(e.fillStyle=r.id===a?"#FFFFFF":s.secondary,e.fillRect(l,o,t,18),c){let a=.5+.5*Math.sin(Date.now()/200);e.strokeStyle=z(s.accent,.6+.4*a),e.lineWidth=2,e.strokeRect(l+1,o+1,t-2,16)}e.fillStyle=z("#000000",.5),e.fillRect(l+t-.5,o,1,18),l+=t}e.fillStyle=z("#000000",.15);for(let t=o;t<o+18;t+=2)e.fillRect(0,t,n,1);e.fillStyle=z("#00FF41",.2),e.fillRect(0,o-1,n,1),e.fillRect(0,o+18,n,1),e.restore()}(e,t.agents,t.hoveredAgent,a,n),t.recompileState&&t.recompileState.active&&function(e,t,a,n){if(!t.active)return;let r=Date.now()-t.startTime;if(r>t.duration)return;let o=r/t.duration;if(o<.5){let t=o/.5*n,r=e.createLinearGradient(0,t-30,0,t+30);r.addColorStop(0,_(0)),r.addColorStop(.4,_(.3)),r.addColorStop(.5,_(.6)),r.addColorStop(.6,_(.3)),r.addColorStop(1,_(0)),e.fillStyle=r,e.fillRect(0,t-30,a,60)}o>.3&&(e.fillStyle=_(Math.max(0,(1-(o-.3)/.7)*.08)),e.fillRect(0,0,a,n))}(e,t.recompileState,a,n),t.environment.incoherence>.15&&function(e,t,a,n){let r;if(n<.15)return;let o=Math.min((n-.15)/.6,1),i=Date.now(),l=(r=0|Math.floor(i/80),()=>{let e=Math.imul((r=r+0x6d2b79f5|0)^r>>>15,1|r);return(((e=e+Math.imul(e^e>>>7,61|e)^e)^e>>>14)>>>0)/0x100000000}),s=Math.floor(1+5*o);e.save();for(let n=0;n<s;n++){if(l()>.3+.5*o)continue;let n=Math.floor(l()*a),r=2+Math.floor(l()*(4+12*o)),i=(l()-.5)*(3+12*o);try{let o=e.getImageData(0,n,t,Math.min(r,a-n));e.putImageData(o,i,n)}catch(e){break}}if(o>.4){let n=(o-.4)*.08,r=Math.floor(i/120);e.fillStyle=z("#00FFFF",n);for(let n=0;n<3;n++){let o=(37*r+131*n)%a;e.fillRect(0,o,t,1)}e.fillStyle=z(c.alert,n);for(let n=0;n<2;n++){let o=(53*r+97*n)%a;e.fillRect(0,o,t,1)}}e.restore()}(e,a,n,t.environment.incoherence),t.hoveredAgent){let a=t.agents.find(e=>e.id===t.hoveredAgent);a&&function(e,t,a){let n=j(a.gridX,a.gridY),r=(n.x+a.walkOffsetX)*t.zoom+t.x,o=(n.y+a.walkOffsetY-56*a.scale-30)*t.zoom+t.y,i="".concat(a.name," (").concat(a.agentType,")"),l="Rep: ".concat(a.reputation.toFixed(2)," | P: ").concat(a.avgP.toFixed(2)),s=a.isFrozen?"FROZEN":a.isQuarantined?"QUARANTINED":"";e.save(),e.font="bold 12px -apple-system, sans-serif";let d=Math.max(e.measureText(i).width,e.measureText(l).width,s?e.measureText(s).width:0)+20,h=s?48:38,u=r-d/2,p=o-h-8;e.shadowColor="rgba(0,0,0,0.4)",e.shadowBlur=8,e.shadowOffsetY=2,e.fillStyle=c.panel,e.strokeStyle=c.border,e.lineWidth=1,e.beginPath(),e.roundRect(u,p,d,h,6),e.fill(),e.shadowColor="transparent",e.stroke(),e.fillStyle=c.panel,e.beginPath(),e.moveTo(r-5,p+h),e.lineTo(r,p+h+5),e.lineTo(r+5,p+h),e.closePath(),e.fill(),e.fillStyle=c.text,e.textAlign="center",e.fillText(i,r,p+15),e.font="11px -apple-system, sans-serif",e.fillStyle=c.muted,e.fillText(l,r,p+29),s&&(e.font="bold 10px -apple-system, sans-serif",e.fillStyle=a.isFrozen?"#A8CFF5":"#EB5757",e.fillText(s,r,p+42)),e.restore()}(e,t.viewport,a)}}(r,{agents:t,arcs:a,viewport:l,hoveredAgent:h,selectedAgent:p,epoch:m,environment:y,overlays:x,particles:v,gridSize:M,digitalRain:E.current,codeTrails:C.current.particles,recompileState:I.current}),r.restore())});let O=(0,r.useCallback)((e,a)=>{let n={x:(e-l.x)/l.zoom,y:(a-l.y)/l.zoom};for(let e of[...t].sort((e,t)=>t.gridX+t.gridY-(e.gridX+e.gridY))){let t=function(e){let{x:t,y:a}=j(e.gridX,e.gridY),n=t+e.walkOffsetX,r=a+e.walkOffsetY,o=u.baseWidth*e.scale;return{minX:n-o/2,minY:r-u.baseHeight*e.scale-10,maxX:n+o/2,maxY:r}}(e);if(n.x>=t.minX&&n.x<=t.maxX&&n.y>=t.minY&&n.y<=t.maxY)return e.id}return null},[t,l]),et=(0,r.useCallback)(e=>{q.current=!0,X.current={x:e.clientX,y:e.clientY}},[]),ea=(0,r.useCallback)(t=>{var a;let n=null==(a=e.current)?void 0:a.getBoundingClientRect();if(!n)return;let r=t.clientX-n.left,o=t.clientY-n.top;q.current?(R(t.clientX-X.current.x,t.clientY-X.current.y),X.current={x:t.clientX,y:t.clientY}):P(O(r,o))},[R,O,P]),en=(0,r.useCallback)(t=>{let a=q.current;if(q.current=!1,!a||3>Math.abs(t.clientX-X.current.x)&&3>Math.abs(t.clientY-X.current.y)){var n;let a=null==(n=e.current)?void 0:n.getBoundingClientRect();if(!a)return;T(O(t.clientX-a.left,t.clientY-a.top))}},[O,T]),er=(0,r.useCallback)(t=>{var a;t.preventDefault();let n=null==(a=e.current)?void 0:a.getBoundingClientRect();n&&N(t.deltaY,t.clientX-n.left,t.clientY-n.top)},[N]),eo=(0,r.useCallback)(()=>{B()},[B]);return(0,n.jsx)("canvas",{ref:e,className:"absolute inset-0 cursor-grab active:cursor-grabbing",onMouseDown:et,onMouseMove:ea,onMouseUp:en,onMouseLeave:()=>{q.current=!1,P(null)},onWheel:er,onDoubleClick:eo})}let ea=[.5,1,2,4];function en(){let{play:e,pause:t,setEpoch:a,setSpeed:i,playing:c,speed:d,currentEpoch:h,maxEpoch:u}=function(){let{state:e,dispatch:t,interactionSystem:a,particleSystem:n,codeTrailSystem:i,digitalRainRef:c,recompileStateRef:d,agentPositions:h,agentsByEpoch:u}=(0,r.useContext)(R),g=(0,r.useRef)(0),m=(0,r.useRef)(0),y=(0,r.useRef)(0),x=(0,r.useRef)(0),b=(0,r.useRef)(0),M=(0,r.useRef)(-1),S=(0,r.useRef)(new Map),_=(0,r.useRef)(new Map),w=(0,r.useRef)(()=>{}),k=(0,r.useCallback)(r=>{var k,P,T,C;if(!e.data)return;let F=m.current?r-m.current:16;m.current=r;let E=e.currentEpoch,I=e.epochFraction;if(e.playing&&(y.current+=F*e.speed,(I=y.current/p.epochTransition)>=1)){I=0,y.current=0,E=Math.min(E+1,e.data.epoch_snapshots.length-1);let n=e.data.epoch_snapshots[E];if(n){let t=e.data.events;if(t&&t.length>0)a.current.addFromEvents(t,E);else{let e=[...h.current.keys()],t=n.total_interactions>0?n.accepted_interactions/n.total_interactions:.5;a.current.addSyntheticArcs(e,E,n.total_interactions,n.avg_p,t)}}E>=e.data.epoch_snapshots.length-1&&t({type:"SET_PLAYING",playing:!1})}M.current>=0&&E!==M.current&&(d.current={active:!0,startTime:Date.now(),duration:400,scanlineY:0}),M.current=E;let R=d.current;if(R.active&&Date.now()-R.startTime>R.duration&&(R.active=!1),a.current.update(F,E),n.current.update(F),i.current.update(F),!c.current&&e.viewport.width>0&&(c.current=function(e){let t=Math.ceil(e/18),a=[];for(let e=0;e<t;e++){let t=8+Math.floor(14*Math.random()),n=[];for(let e=0;e<t;e++)n.push(v());let r=(Math.random()-.5)*6;a.push({x:18*e+9+r,speed:.02+.1*Math.random(),chars:n,headY:-500*Math.random(),charInterval:18+(Math.random()-.5)*4,brightness:.6+.4*Math.random(),nextMutateTime:50+150*Math.random()})}return{columns:a,initialized:!0}}(e.viewport.width)),c.current){let t=e.environment.threatLevel;!function(e,t,a,n){for(let r of e.columns){let e=1+.6*n;r.headY+=r.speed*t*e;let o=r.chars.length*r.charInterval;if(r.headY-o>a&&(r.headY=-200*Math.random()-50,r.speed=.02+.1*Math.random(),.3>Math.random())){let e=8+Math.floor(14*Math.random());for(;r.chars.length<e;)r.chars.push(v());r.chars.length>e&&(r.chars.length=e)}if(r.nextMutateTime-=t,r.nextMutateTime<=0){let e=Math.floor(Math.random()*r.chars.length);r.chars[e]=v(),r.nextMutateTime=50+150*Math.random()}}}(c.current,F,e.viewport.height,t)}let N=null!=(k=u.current.get(E))?k:new Map,A=Math.min(E+1,e.data.epoch_snapshots.length-1),D=null!=(P=u.current.get(A))?P:N,B=function(e,t,a,n){let r=[],i=new Set([...e.keys(),...t.keys()]),s=l(0,1,a);for(let l of i){var c,d,h,u,p,f,g,m;let i=e.get(l),y=t.get(l),x=n.get(l);if(!x)continue;let v=null!=i?i:y,b=null!=y?y:i,M=(h=v.reputation,h+(b.reputation-h)*s),S=(u=v.resources,u+(b.resources-u)*s),_=(p=v.total_payoff,p+(b.total_payoff-p)*s),w=(f=(v.avg_p_initiated+v.avg_p_received)/2||.5,f+(((b.avg_p_initiated+b.avg_p_received)/2||.5)-f)*s),k=a<.5?v.is_frozen:b.is_frozen,P=a<.5?v.is_quarantined:b.is_quarantined,T=o(.6+(M+1)*.4,.6,1.4);r.push({id:l,name:null!=(c=b.name)?c:l.slice(0,8),agentType:null!=(d=b.agent_type)?d:"honest",reputation:M,resources:S,totalPayoff:_,avgP:w,isFrozen:k,isQuarantined:P,scale:T,gridX:x.gridX,gridY:x.gridY,interactionsInitiated:Math.round((g=v.interactions_initiated,g+(b.interactions_initiated-g)*s)),interactionsReceived:Math.round((m=v.interactions_received,m+(b.interactions_received-m)*s)),walkOffsetX:0,walkOffsetY:0,walkPhase:0,facing:1})}return r}(N,D,I,h.current),W=new Map(B.map(e=>[e.id,e])),z=new Set;for(let e of a.current.arcs){let t;if(e.progress>=1)continue;let a=W.get(e.fromId),n=W.get(e.toId);if(!a||!n||z.has(e.fromId))continue;let r=j(a.gridX,a.gridY),o=j(n.gridX,n.gridY),i=f[a.agentType],c=e.progress;t=c<.45?l(0,.45,c):c<.55?1:1-l(.55,1,c);let d=(o.x-r.x)*t*.85,h=(o.y-r.y)*t*.85,u=Math.sqrt((o.x-r.x)**2+(o.y-r.y)**2),p=u>0?-(o.y-r.y)/u:0,g=u>0?(o.x-r.x)/u:0,m=i.swayAmplitude*Math.sin(3.5*a.walkPhase)*4,y=Math.sin(t*Math.PI)*((s(a.id)%200-100)/100*.15)*u;a.walkOffsetX=d+p*m+p*y,a.walkOffsetY=h+g*m+g*y;let x=o.x-r.x;Math.abs(x)>1&&_.current.set(e.fromId,x>0?1:-1),z.add(e.fromId)}for(let e of z){let t=W.get(e),a=f[t.agentType],n=(null!=(T=S.current.get(e))?T:0)+F*a.walkRate;S.current.set(e,n),t.walkPhase=n}for(let e of B)e.facing=null!=(C=_.current.get(e.id))?C:1;for(let[e]of S.current)z.has(e)||S.current.delete(e);let L=40+15*Math.sin(.003*r);if(r-b.current>L)for(let e of(b.current=r,z)){let t=W.get(e),a=j(t.gridX,t.gridY),n=a.x+t.walkOffsetX,r=a.y+t.walkOffsetY;i.current.spawnBurst(n,r-28*t.scale,t.avgP,2)}if(r-x.current>500)for(let e of(x.current=r,B)){let t=j(e.gridX,e.gridY),a=t.x+e.walkOffsetX,r=t.y+e.walkOffsetY;e.isFrozen&&n.current.add(function(e,t,a){let n=[];for(let a=0;a<2;a++){let a=.2*Math.sin(Date.now()/2e3);n.push({x:e+(Math.random()-.5)*30,y:t-40*Math.random(),vx:(Math.random()-.5)*.3+a,vy:.5*Math.random()+.2,life:1e3+500*Math.random(),maxLife:1500,size:2+2*Math.random(),color:"#A8CFF5",alpha:.7})}return n}(a,r-56*e.scale,0)),e.isQuarantined&&n.current.add(function(e,t,a){let n=[];for(let a=0;a<2;a++){let a=Math.random()*Math.PI*2,r=20+15*Math.random();n.push({x:e+Math.cos(a)*r,y:t+Math.sin(a)*r*.5,vx:.2*Math.cos(a),vy:-(.5*Math.random())-.3,life:800+400*Math.random(),maxLife:1200,size:1.5+Math.random(),color:"#EB5757",alpha:.5})}return n}(a,r,0))}let Y=e.data.epoch_snapshots[E],q=e.data.epoch_snapshots[A],X=function(e,t,a){var n,r,o,i,s,c,d,h,u,p,f,g,m,y,x,v,b,M,S,_,w,k,P,T,C,j,F,E,I,R,N,A,D,B,W;if(!e&&!t)return{threatLevel:0,toxicity:0,giniCoefficient:0,collusionRisk:0,incoherence:0,contagionDepth:0,activeThreats:0,reputationStd:0,payoffStd:0,avgSynergyScore:0,avgCoordinationScore:0,avgDegree:0,avgClustering:0};let z=null!=e?e:t,L=null!=t?t:e,Y=l(0,1,a);return{threatLevel:(P=null!=(n=z.ecosystem_threat_level)?n:0,P+((null!=(r=L.ecosystem_threat_level)?r:0)-P)*Y),toxicity:(T=z.toxicity_rate,T+(L.toxicity_rate-T)*Y),giniCoefficient:(C=z.gini_coefficient,C+(L.gini_coefficient-C)*Y),collusionRisk:(j=null!=(o=z.ecosystem_collusion_risk)?o:0,j+((null!=(i=L.ecosystem_collusion_risk)?i:0)-j)*Y),incoherence:(F=null!=(s=z.incoherence_index)?s:0,F+((null!=(c=L.incoherence_index)?c:0)-F)*Y),contagionDepth:(E=null!=(d=z.contagion_depth)?d:0,E+((null!=(h=L.contagion_depth)?h:0)-E)*Y),activeThreats:(I=null!=(u=z.active_threats)?u:0,I+((null!=(p=L.active_threats)?p:0)-I)*Y),reputationStd:(R=null!=(f=z.reputation_std)?f:0,R+((null!=(g=L.reputation_std)?g:0)-R)*Y),payoffStd:(N=null!=(m=z.payoff_std)?m:0,N+((null!=(y=L.payoff_std)?y:0)-N)*Y),avgSynergyScore:(A=null!=(x=z.avg_synergy_score)?x:0,A+((null!=(v=L.avg_synergy_score)?v:0)-A)*Y),avgCoordinationScore:(D=null!=(b=z.avg_coordination_score)?b:0,D+((null!=(M=L.avg_coordination_score)?M:0)-D)*Y),avgDegree:(B=null!=(S=z.avg_degree)?S:0,B+((null!=(_=L.avg_degree)?_:0)-B)*Y),avgClustering:(W=null!=(w=z.avg_clustering)?w:0,W+((null!=(k=L.avg_clustering)?k:0)-W)*Y)}}(Y,q,I),O=Y&&q?function(e,t,a){var n,r,o,i,s,c,d,h,u,p,f,g,m,y,x,v,b,M,S,_;let w=l(0,1,a);return{...t,epoch:e.epoch,total_interactions:Math.round((s=e.total_interactions,s+(t.total_interactions-s)*w)),accepted_interactions:Math.round((c=e.accepted_interactions,c+(t.accepted_interactions-c)*w)),rejected_interactions:Math.round((d=e.rejected_interactions,d+(t.rejected_interactions-d)*w)),toxicity_rate:(h=e.toxicity_rate,h+(t.toxicity_rate-h)*w),quality_gap:(u=e.quality_gap,u+(t.quality_gap-u)*w),avg_p:(p=e.avg_p,p+(t.avg_p-p)*w),total_welfare:(f=e.total_welfare,f+(t.total_welfare-f)*w),avg_payoff:(g=e.avg_payoff,g+(t.avg_payoff-g)*w),payoff_std:(m=e.payoff_std,m+(t.payoff_std-m)*w),gini_coefficient:(y=e.gini_coefficient,y+(t.gini_coefficient-y)*w),n_frozen:Math.round((x=e.n_frozen,x+(t.n_frozen-x)*w)),n_quarantined:Math.round((v=e.n_quarantined,v+(t.n_quarantined-v)*w)),avg_reputation:(b=e.avg_reputation,b+(t.avg_reputation-b)*w),reputation_std:(M=e.reputation_std,M+(t.reputation_std-M)*w),ecosystem_threat_level:(S=null!=(n=e.ecosystem_threat_level)?n:0,S+((null!=(r=t.ecosystem_threat_level)?r:0)-S)*w),ecosystem_collusion_risk:(_=null!=(o=e.ecosystem_collusion_risk)?o:0,_+((null!=(i=t.ecosystem_collusion_risk)?i:0)-_)*w)}}(Y,q,I):null!=Y?Y:null;t({type:"TICK",agents:B,arcs:a.current.arcs,environment:X,particles:n.current.particles,epoch:E,fraction:I,epochSnap:O}),g.current=requestAnimationFrame(e=>w.current(e))},[e.data,e.playing,e.speed,e.currentEpoch,e.epochFraction,t,a,n,i,c,d,e.environment.threatLevel,e.viewport.height,e.viewport.width,h,u]);(0,r.useEffect)(()=>{w.current=k},[k]);let P=(0,r.useCallback)(()=>{t({type:"SET_PLAYING",playing:!0})},[t]),T=(0,r.useCallback)(()=>{t({type:"SET_PLAYING",playing:!1})},[t]),C=(0,r.useCallback)(n=>{if(y.current=0,t({type:"SET_EPOCH",epoch:n}),e.data){a.current.clear();let t=e.data.epoch_snapshots[n];if(t){let r=e.data.events;if(r&&r.length>0)a.current.addFromEvents(r,n);else{let e=[...h.current.keys()],r=t.total_interactions>0?t.accepted_interactions/t.total_interactions:.5;a.current.addSyntheticArcs(e,n,t.total_interactions,t.avg_p,r)}}}},[t,e.data,a,h]),F=(0,r.useCallback)(e=>t({type:"SET_SPEED",speed:e}),[t]);return(0,r.useEffect)(()=>(e.data&&(g.current=requestAnimationFrame(k)),()=>{g.current&&cancelAnimationFrame(g.current)}),[k,e.data]),{play:P,pause:T,setEpoch:C,setSpeed:F,playing:e.playing,speed:e.speed,currentEpoch:e.currentEpoch,maxEpoch:e.data?e.data.epoch_snapshots.length-1:0}}(),{data:g}=A(),m=(0,r.useCallback)(()=>{g&&function(e){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="".concat(e.simulation_id||"history",".json"),n.click(),URL.revokeObjectURL(a)}(g)},[g]);return(0,n.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 h-14 bg-panel border-t border-border flex items-center gap-3 px-4 z-[10000]",children:[(0,n.jsx)("button",{onClick:()=>c?t():e(),className:"w-9 h-9 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors",title:c?"Pause":"Play",children:c?(0,n.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:[(0,n.jsx)("rect",{x:"2",y:"1",width:"4",height:"12",rx:"1"}),(0,n.jsx)("rect",{x:"8",y:"1",width:"4",height:"12",rx:"1"})]}):(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"currentColor",children:(0,n.jsx)("path",{d:"M3 1.5v11l9-5.5z"})})}),(0,n.jsxs)("span",{className:"text-xs text-muted w-20 text-center font-mono",children:["Epoch ",h,"/",u]}),(0,n.jsx)("input",{type:"range",min:0,max:u,value:h,onChange:e=>a(Number(e.target.value)),className:"flex-1 h-1.5 appearance-none bg-border rounded-full cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-3.5 [&::-webkit-slider-thumb]:h-3.5 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-accent [&::-webkit-slider-thumb]:cursor-pointer"}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"text-xs text-muted mr-1",children:"Speed"}),ea.map(e=>(0,n.jsxs)("button",{onClick:()=>i(e),className:"px-2 py-1 text-xs rounded transition-colors ".concat(d===e?"bg-accent text-bg font-bold":"bg-btn hover:bg-btn-hover text-muted"),children:[e,"x"]},e))]}),g&&(0,n.jsx)("button",{onClick:m,className:"w-9 h-9 flex items-center justify-center rounded bg-btn hover:bg-btn-hover transition-colors",title:"Export as history.json",children:(0,n.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M7 1v8M4 6l3 3 3-3M2 11v1.5h10V11"})})})]})}function er(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Math.abs(e)>=1e3?e.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,","):e.toFixed(t)}function eo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(100*e).toFixed(t)+"%"}function ei(){let{selectedAgent:e,agents:t,setSelected:a,agentSnapshots:o,currentEpoch:i}=A(),l=t.find(t=>t.id===e),s=(0,r.useMemo)(()=>(null==o?void 0:o.length)&&l?o.filter(e=>e.agent_id===l.id).sort((e,t)=>e.epoch-t.epoch):[],[o,l]),c=(0,r.useMemo)(()=>s.map(e=>e.reputation),[s]),u=(0,r.useMemo)(()=>s.map(e=>e.total_payoff),[s]),p=(0,r.useMemo)(()=>s.map(e=>e.avg_p_initiated),[s]);if(!l)return null;let f=d[l.agentType],g=l.interactionsInitiated+l.interactionsReceived,m=g>0?l.interactionsInitiated/g:.5;return(0,n.jsxs)("div",{className:"absolute top-4 left-4 w-72 bg-panel border border-border rounded-lg shadow-lg z-20 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f.secondary}}),(0,n.jsx)("span",{className:"font-semibold text-sm",children:l.name})]}),(0,n.jsx)("button",{onClick:()=>a(null),className:"text-muted hover:text-text transition-colors text-lg leading-none",children:"x"})]}),(0,n.jsxs)("div",{className:"px-4 py-2 border-b border-border flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full",style:{backgroundColor:f.primary,color:f.accent},children:h[l.agentType]}),(0,n.jsx)("span",{className:"text-xs text-muted",children:l.agentType}),l.isFrozen&&(0,n.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-blue-900/50 text-blue-300",children:"FROZEN"}),l.isQuarantined&&(0,n.jsx)("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-red-900/50 text-red-300",children:"QUARANTINED"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-px bg-border",children:[(0,n.jsx)(es,{label:"Reputation",value:er(l.reputation,3),sparkline:c,color:f.secondary}),(0,n.jsx)(es,{label:"Resources",value:er(l.resources,1)}),(0,n.jsx)(es,{label:"Total Payoff",value:er(l.totalPayoff,2),sparkline:u}),(0,n.jsx)(es,{label:"Avg P",value:eo(l.avgP),sparkline:p,color:l.avgP>.6?"#6FCF97":l.avgP>.3?"#F2994A":"#EB5757"}),(0,n.jsx)(es,{label:"Initiated",value:String(l.interactionsInitiated)}),(0,n.jsx)(es,{label:"Received",value:String(l.interactionsReceived)})]}),g>0&&(0,n.jsxs)("div",{className:"px-4 py-2 border-t border-border",children:[(0,n.jsx)("div",{className:"text-[10px] text-muted uppercase tracking-wider mb-1",children:"Activity Balance"}),(0,n.jsxs)("div",{className:"flex h-2 rounded-full overflow-hidden bg-black/30",children:[(0,n.jsx)("div",{className:"transition-all duration-300",style:{width:"".concat(100*m,"%"),backgroundColor:f.secondary}}),(0,n.jsx)("div",{className:"transition-all duration-300",style:{width:"".concat((1-m)*100,"%"),backgroundColor:f.primary}})]}),(0,n.jsxs)("div",{className:"flex justify-between text-[9px] text-muted mt-0.5",children:[(0,n.jsxs)("span",{children:["Initiated ",eo(m)]}),(0,n.jsxs)("span",{children:["Received ",eo(1-m)]})]})]}),(0,n.jsxs)("div",{className:"px-4 py-1.5 border-t border-border text-[10px] text-muted text-center",children:["Epoch ",i," | Power: ",(100*l.scale).toFixed(0),"%"]})]})}function el(e){let{data:t,color:a="#3ECFB4",width:r=48,height:o=16}=e;if(t.length<2)return null;let i=Math.min(...t),l=Math.max(...t)-i||1,s=t.map((e,a)=>{let n=a/(t.length-1)*r;return"".concat(n,",").concat(o-(e-i)/l*(o-2)-1)}).join(" ");return(0,n.jsx)("svg",{width:r,height:o,className:"inline-block ml-1 align-middle",children:(0,n.jsx)("polyline",{points:s,fill:"none",stroke:a,strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round"})})}function es(e){let{label:t,value:a,color:r,sparkline:o}=e;return(0,n.jsxs)("div",{className:"bg-panel px-3 py-2",children:[(0,n.jsx)("div",{className:"text-[10px] text-muted uppercase tracking-wider",children:t}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-0.5",children:[(0,n.jsx)("span",{className:"text-sm font-mono",style:r?{color:r}:void 0,children:a}),o&&o.length>1&&(0,n.jsx)(el,{data:o,color:r||"#3ECFB4"})]})]})}function ec(){var e,t,a;let{data:o,currentEpochSnap:i,overlays:l,currentEpoch:s}=A(),c=(0,r.useMemo)(()=>{if(!o)return{toxicity:[],avgP:[],gini:[],welfare:[]};let e=o.epoch_snapshots.slice(0,s+1);return{toxicity:e.map(e=>e.toxicity_rate),avgP:e.map(e=>e.avg_p),gini:e.map(e=>e.gini_coefficient),welfare:e.map(e=>e.total_welfare)}},[o,s]);return l.metricsHud&&i&&o?(0,n.jsxs)("div",{className:"absolute top-4 right-4 w-56 bg-panel border border-border rounded-lg shadow-lg z-20 text-xs",children:[(0,n.jsxs)("div",{className:"px-3 py-2 border-b border-border",children:[(0,n.jsxs)("span",{className:"text-muted",children:["Epoch ",i.epoch]}),(0,n.jsxs)("span",{className:"text-muted float-right",children:[i.n_agents," agents"]})]}),(0,n.jsxs)("div",{className:"p-3 space-y-2.5",children:[(0,n.jsx)(ed,{label:"Toxicity",value:eo(i.toxicity_rate),color:i.toxicity_rate>.3?"#EB5757":i.toxicity_rate>.15?"#F2994A":"#6FCF97",sparkline:c.toxicity}),(0,n.jsx)(ed,{label:"Avg P",value:er(i.avg_p,3),color:L(i.avg_p),sparkline:c.avgP}),(0,n.jsx)(ed,{label:"Quality Gap",value:er(i.quality_gap,3),color:i.quality_gap<0?"#EB5757":"#6FCF97"}),(0,n.jsx)(ed,{label:"Gini",value:er(i.gini_coefficient,3),color:i.gini_coefficient>.4?"#EB5757":"#F2994A",sparkline:c.gini}),(0,n.jsx)(ed,{label:"Total Welfare",value:er(i.total_welfare,1),sparkline:c.welfare}),(0,n.jsxs)("div",{className:"border-t border-border pt-2 mt-2",children:[(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Interactions"}),(0,n.jsx)("span",{className:"font-mono",children:i.total_interactions})]}),(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Accepted"}),(0,n.jsx)("span",{className:"font-mono text-accent",children:i.accepted_interactions})]}),(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Rejected"}),(0,n.jsx)("span",{className:"font-mono text-alert",children:i.rejected_interactions})]})]}),(null!=(e=i.ecosystem_threat_level)?e:0)>0&&(0,n.jsx)("div",{className:"border-t border-border pt-2",children:(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Threat Level"}),(0,n.jsx)("span",{className:"font-mono",style:{color:(null!=(t=i.ecosystem_threat_level)?t:0)>.5?"#EB5757":"#F2994A"},children:eo(null!=(a=i.ecosystem_threat_level)?a:0)})]})}),i.n_frozen>0&&(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Frozen"}),(0,n.jsx)("span",{className:"font-mono",style:{color:"#A8CFF5"},children:i.n_frozen})]}),i.n_quarantined>0&&(0,n.jsxs)("div",{className:"flex justify-between text-muted",children:[(0,n.jsx)("span",{children:"Quarantined"}),(0,n.jsx)("span",{className:"font-mono text-alert",children:i.n_quarantined})]})]})]}):null}function ed(e){let{label:t,value:a,color:r,sparkline:o}=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-muted",children:t}),(0,n.jsx)("span",{className:"font-mono",style:r?{color:r}:void 0,children:a})]}),o&&o.length>1&&(0,n.jsx)(eh,{data:o,color:null!=r?r:"#3ECFB4"})]})}function eh(e){let{data:t,color:a}=e,r=Math.min(...t),o=Math.max(...t)-r||1,i=t.map((e,a)=>{let n=a/(t.length-1)*200;return"".concat(n,",").concat(16-(e-r)/o*14-1)});return(0,n.jsx)("svg",{width:"100%",height:16,viewBox:"0 0 ".concat(200," ").concat(16),preserveAspectRatio:"none",className:"mt-0.5",children:(0,n.jsx)("polyline",{points:i.join(" "),fill:"none",stroke:a,strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:"0.6"})})}function eu(){let e=(0,r.useRef)(null),{agents:t,overlays:a,viewport:o}=A(),{handlePan:i}=D();return((0,r.useEffect)(()=>{if(!a.minimap)return;let n=e.current;if(!n)return;let r=n.getContext("2d");if(!r)return;let i=devicePixelRatio;n.width=140*i,n.height=140*i,r.scale(i,i);let l=0,s=0,h=100,u=100;for(let e of t){let t=j(e.gridX,e.gridY);l=Math.min(l,t.x-40),s=Math.min(s,t.y-100),h=Math.max(h,t.x+40),u=Math.max(u,t.y+40)}let p=h-l||1,f=u-s||1,g=.85*Math.min(140/p,140/f),m=(140-p*g)/2,y=(140-f*g)/2;for(let e of(r.fillStyle=z(c.bg,.9),r.fillRect(0,0,140,140),t)){let t=j(e.gridX,e.gridY),a=(t.x-l)*g+m,n=(t.y-s)*g+y;r.fillStyle=d[e.agentType].secondary,r.beginPath(),r.arc(a,n,3,0,2*Math.PI),r.fill()}let x=(-o.x/o.zoom-l)*g+m,v=(-o.y/o.zoom-s)*g+y,b=o.width/o.zoom*g,M=o.height/o.zoom*g;r.strokeStyle=c.accent,r.lineWidth=1,r.strokeRect(x,v,b,M),r.strokeStyle=c.border,r.lineWidth=1,r.strokeRect(0,0,140,140)},[t,a.minimap,o]),a.minimap)?(0,n.jsx)("canvas",{ref:e,className:"absolute bottom-16 right-4 rounded border border-border z-20 cursor-pointer",style:{width:140,height:140}}):null}function ep(e){return()=>{e|=0;let t=Math.imul((e=e+0x6d2b79f5|0)^e>>>15,1|e);return(((t=t+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/0x100000000}}function ef(e){return Math.sqrt(-2*Math.log(e()||1e-10))*Math.cos(2*Math.PI*e())}let eg=["honest","opportunistic","deceptive","adversarial","rlm","crewai"],em={honest:{progressMean:.7,progressStd:.15,reworkProb:.05,rejectionProb:.02,engagementMean:.6,acceptanceThreshold:.2,disposition:.7,names:["Sentinel","Guardian","Beacon","Anchor","Steward","Warden","Shield","Paladin","Arbiter","Keeper"]},opportunistic:{progressMean:.4,progressStd:.25,reworkProb:.15,rejectionProb:.1,engagementMean:.2,acceptanceThreshold:.1,disposition:.3,names:["Broker","Trader","Hustler","Maverick","Gambit","Dealer","Shark","Schemer","Speculator","Rogue"]},deceptive:{progressMean:.2,progressStd:.3,reworkProb:.25,rejectionProb:.2,engagementMean:-.1,acceptanceThreshold:.05,disposition:-.2,names:["Mirage","Phantom","Shadow","Facade","Specter","Wraith","Veil","Decoy","Illusionist","Shade"]},adversarial:{progressMean:-.2,progressStd:.35,reworkProb:.35,rejectionProb:.3,engagementMean:-.4,acceptanceThreshold:0,disposition:-.5,names:["Viper","Striker","Havoc","Razr","Blitz","Chaos","Toxin","Bane","Ravager","Scourge"]},rlm:{progressMean:.5,progressStd:.2,reworkProb:.1,rejectionProb:.08,engagementMean:.3,acceptanceThreshold:.15,disposition:.5,names:["Nexus","Cortex","Axiom","Vertex","Synapse","Matrix","Vector","Tensor","Lambda","Neural"]},crewai:{progressMean:.6,progressStd:.18,reworkProb:.08,rejectionProb:.05,engagementMean:.5,acceptanceThreshold:.2,disposition:.6,names:["Forge","Assembly","Cluster","Hive","Colony","Swarm","Network","Grid","Nexus","Hub"]}};async function ey(e){let t;if("string"==typeof e){let a=await fetch(e);if(!a.ok)throw Error("Failed to load: ".concat(a.statusText));t=await a.text()}else t=await e.text();let a=JSON.parse(t);return function(e){if(!e.epoch_snapshots||!Array.isArray(e.epoch_snapshots))throw Error("Missing epoch_snapshots array");if(!Array.isArray(e.agent_snapshots)){var t;e.agent_snapshots=null!=(t=e.agent_snapshots)?t:[]}if(0===e.epoch_snapshots.length)throw Error("No epoch snapshots found")}(a),0===a.agent_snapshots.length&&a.epoch_snapshots.length>0&&(a.agent_snapshots=function(e){var t,a,n,r,o;let i=ep(null!=(t=e.seed)?t:42),l=e.n_agents||e.epoch_snapshots[0].n_agents||6,s=[],c=[];for(let e=0;e<l;e++){let t=e%eg.length,a=eg[t],n=em[a].names,r=n[e%n.length]+(e>=eg.length?"-".concat(Math.floor(e/eg.length)+1):""),o=em[a].disposition+(i()-.5)*.3;c.push({id:"agent-".concat(e),name:r,type:a,disposition:o})}let d=c.map(()=>({reputation:.5+(i()-.5)*.2,resources:10+5*i(),totalPayoff:0,initiated:0,received:0}));for(let t of e.epoch_snapshots)for(let e=0;e<c.length;e++){let h=c[e],u=d[e],p=i()-.5,f=(null!=(a=t.toxicity_rate)?a:0)*.5,g=.05*h.disposition+.03*p-.02*f;u.reputation=Math.max(0,Math.min(1,u.reputation+g));let m=(null!=(n=t.avg_payoff)?n:0)*(.8+.4*h.disposition)+2*p;u.totalPayoff+=m,u.resources=Math.max(0,u.resources+.1*m);let y=t.total_interactions/l,x=Math.max(0,Math.round(y*(.4+.3*i()))),v=Math.max(0,Math.round(y*(.3+.3*i())));u.initiated+=x,u.received+=v;let b=Math.max(0,Math.min(1,.5+.3*h.disposition+.1*p-(null!=(r=t.toxicity_rate)?r:0)*.15)),M=null!=(o=t.ecosystem_threat_level)?o:0,S="adversarial"===h.type&&M>.5&&u.reputation<.3&&i()>.4,_="deceptive"===h.type&&M>.4&&u.reputation<.35&&i()>.5;s.push({agent_id:h.id,epoch:t.epoch,name:h.name,agent_type:h.type,reputation:u.reputation,resources:u.resources,interactions_initiated:u.initiated,interactions_received:u.received,avg_p_initiated:b,avg_p_received:Math.max(0,Math.min(1,b+(i()-.5)*.1)),total_payoff:u.totalPayoff,is_frozen:S,is_quarantined:_})}return s}(a)),a.events&&Array.isArray(a.events)?a.events=a.events.filter(e=>!e.event_type||"interaction"===e.event_type):a.events=void 0,a}let ex={agents:[{type:"honest",count:3},{type:"opportunistic",count:1},{type:"deceptive",count:1},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},payoff:{s_plus:2,s_minus:1,h:2,theta:.5,rho_a:0,rho_b:0,w_rep:1},epochs:10,stepsPerEpoch:10,seed:42,sigmoidK:2},ev={taskProgress:.4,reworkPenalty:.2,verifierPenalty:.2,engagementSignal:.2};function eb(e,t){return 0===e?1:2*Math.pow(t,e)-1}class eM{computeVHat(e){let t=Math.max(-1,Math.min(1,e.taskProgressDelta)),a=eb(e.reworkCount,this.reworkDecay),n=eb(e.verifierRejections,this.rejectionDecay),r=Math.max(-1,Math.min(1,e.counterpartyEngagementDelta));return Math.max(-1,Math.min(1,this.weights.taskProgress*t+this.weights.reworkPenalty*a+this.weights.verifierPenalty*n+this.weights.engagementSignal*r))}computeP(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return 1/(1+Math.exp(-t*Math.max(-10,Math.min(10,e))))}(e,this.sigmoidK)}computeLabels(e){let t=this.computeVHat(e),a=this.computeP(t);return{vHat:t,p:a}}constructor(e=ev,t=2,a=.3,n=.4){this.weights=function(e){let t=e.taskProgress+e.reworkPenalty+e.verifierPenalty+e.engagementSignal;return 0===t?{taskProgress:.25,reworkPenalty:.25,verifierPenalty:.25,engagementSignal:.25}:{taskProgress:e.taskProgress/t,reworkPenalty:e.reworkPenalty/t,verifierPenalty:e.verifierPenalty/t,engagementSignal:e.engagementSignal/t}}(e),this.sigmoidK=t,this.reworkDecay=a,this.rejectionDecay=n}}let eS={s_plus:2,s_minus:1,h:2,theta:.5,rho_a:0,rho_b:0,w_rep:1};class e_{expectedSurplus(e){return e*this.cfg.s_plus-(1-e)*this.cfg.s_minus}expectedHarm(e){return(1-e)*this.cfg.h}payoffInitiator(e,t,a,n){let r=this.expectedSurplus(e),o=this.expectedHarm(e);return this.cfg.theta*r-t-a-this.cfg.rho_a*o+this.cfg.w_rep*n}payoffCounterparty(e,t,a,n){let r=this.expectedSurplus(e),o=this.expectedHarm(e);return(1-this.cfg.theta)*r+t-a-this.cfg.rho_b*o+this.cfg.w_rep*n}constructor(e={}){this.cfg={...eS,...e}}}let ew=[{name:"Adversarial Takeover",description:"5 adversarial agents overwhelm 2 honest ones. Can governance hold?",config:{agents:[{type:"honest",count:2},{type:"opportunistic",count:0},{type:"deceptive",count:1},{type:"adversarial",count:5}],governance:{taxRate:.02,reputationDecay:.98,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:30,stepsPerEpoch:15}},{name:"Governance Stress Test",description:"High tax + aggressive circuit breaker vs. mixed bad actors.",config:{agents:[{type:"honest",count:3},{type:"opportunistic",count:2},{type:"deceptive",count:2},{type:"adversarial",count:2}],governance:{taxRate:.3,reputationDecay:.88,circuitBreakerEnabled:!0,circuitBreakerThreshold:.25},epochs:40,stepsPerEpoch:20}},{name:"Market Collapse",description:"No governance, high harm. Deceptive agents exploit freely.",config:{agents:[{type:"honest",count:2},{type:"opportunistic",count:3},{type:"deceptive",count:3},{type:"adversarial",count:0}],governance:{taxRate:0,reputationDecay:1,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},payoff:{s_plus:2,s_minus:1,h:4,theta:.5,rho_a:0,rho_b:0,w_rep:.5},epochs:50,stepsPerEpoch:15}},{name:"Utopian Baseline",description:"All honest agents, moderate governance. How good can it get?",config:{agents:[{type:"honest",count:6},{type:"opportunistic",count:0},{type:"deceptive",count:0},{type:"adversarial",count:0}],governance:{taxRate:.05,reputationDecay:.95,circuitBreakerEnabled:!1,circuitBreakerThreshold:.4},epochs:20,stepsPerEpoch:10}},{name:"Externality Pricing",description:"Agents internalize harm costs. Does it deter bad behavior?",config:{agents:[{type:"honest",count:3},{type:"opportunistic",count:2},{type:"deceptive",count:2},{type:"adversarial",count:1}],payoff:{s_plus:2,s_minus:1,h:2,theta:.5,rho_a:.5,rho_b:.5,w_rep:1},governance:{taxRate:.1,reputationDecay:.92,circuitBreakerEnabled:!0,circuitBreakerThreshold:.35},epochs:40,stepsPerEpoch:15}}];function ek(e){let{label:t,value:a,min:r,max:o,step:i,onChange:l,format:s}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-28 shrink-0",children:t}),(0,n.jsx)("input",{type:"range",min:r,max:o,step:i,value:a,onChange:e=>l(parseFloat(e.target.value)),className:"flex-1 h-1 accent-accent"}),(0,n.jsx)("span",{className:"text-xs font-mono w-12 text-right",children:s?s(a):a})]})}function eP(e){let{title:t,collapsible:a,children:o}=e,[i,l]=(0,r.useState)(!a);return(0,n.jsxs)("div",{className:"border-t border-border pt-3 mt-3 first:border-0 first:pt-0 first:mt-0",children:[(0,n.jsxs)("button",{onClick:a?()=>l(!i):void 0,className:"text-xs font-bold uppercase tracking-wider mb-2 flex items-center gap-1 ".concat(a?"cursor-pointer hover:text-accent":"cursor-default"),children:[a&&(0,n.jsx)("span",{className:"text-muted",children:i?"":""}),t]}),i&&(0,n.jsx)("div",{className:"space-y-2",children:o})]})}function eT(e){var t;let{onComplete:o}=e,[i,l]=(0,r.useState)({...ex}),{status:s,progress:c,error:d,run:h}=function(){let[e,t]=(0,r.useState)("idle"),[n,o]=(0,r.useState)(0),[i,l]=(0,r.useState)(null),[s,c]=(0,r.useState)(null),d=(0,r.useRef)(!1);return{status:e,progress:n,error:i,result:s,run:(0,r.useCallback)(e=>{return t("running"),o(0),l(null),c(null),d.current=!1,new Promise(r=>{try{let i=new Worker(a.tu(new URL(a.p+a.u(496),a.b)),{type:void 0});i.onmessage=e=>{let a=e.data;"progress"===a.type?o(a.epoch/a.totalEpochs):"complete"===a.type?(t("done"),o(1),c(a.data),i.terminate(),r(a.data)):"error"===a.type&&(t("error"),l(a.message),i.terminate(),r(null))},i.onerror=()=>{i.terminate(),n(e,r)},i.postMessage({type:"run",config:e})}catch(t){n(e,r)}});function n(e,a){try{let n=function(e,t){let a=ep(e.seed),n="sim-".concat(Date.now()),r=new eM(void 0,e.sigmoidK),o=new e_(e.payoff),i=function(e,t){let a=[],n=0;for(let r of e.agents){let e=em[r.type];if(e)for(let o=0;o<r.count;o++){let o=n%e.names.length,i=n>=e.names.length?"-".concat(Math.floor(n/e.names.length)+1):"";a.push({id:"agent-".concat(n),name:"".concat(e.names[o]).concat(i),type:r.type,reputation:.5+(t()-.5)*.2,resources:10+5*t(),totalPayoff:0,interactionsInitiated:0,interactionsReceived:0,sumPInitiated:0,sumPReceived:0,isFrozen:!1,isQuarantined:!1}),n++}}return a}(e,a),l=[],s=[],c=[];for(let p=0;p<e.epochs;p++){let f=[];for(let t=0;t<e.stepsPerEpoch;t++){let{result:l,event:s}=function(e,t,a,n,r,o,i,l){let s=e.map((e,t)=>({a:e,i:t})).filter(e=>{let{a:t}=e;return!t.isFrozen});if(s.length<2){var c,d,h,u;return{result:{p:.5,accepted:!1,initiatorPayoff:0,counterpartyPayoff:0},event:{event_type:"interaction",timestamp:new Date().toISOString(),epoch:o,step:i,interaction_id:"".concat(l,"-e").concat(o,"-s").concat(i),initiator:null!=(h=null==(c=e[0])?void 0:c.id)?h:"none",counterparty:null!=(u=null==(d=e[1])?void 0:d.id)?u:"none",interaction_type:"collaboration",accepted:!1,p:.5,v_hat:0}}}let p=s[Math.floor(r()*s.length)],f=p.a,g=function(e,t,a){let n;if(e.length<2)return t;do n=Math.floor(a()*e.length);while(n===t);return n}(e,p.i,r),m=e[g],y=function(e,t,a){let n=ef(a),r=Math.max(-1,Math.min(1,e.progressMean+e.progressStd*n+(t-.5)*.1)),o=a()<e.reworkProb?a()<e.reworkProb?2:1:0,i=a()<e.rejectionProb?a()<e.rejectionProb?2:1:0;return{taskProgressDelta:r,reworkCount:o,verifierRejections:i,counterpartyEngagementDelta:Math.max(-1,Math.min(1,e.engagementMean+.2*ef(a)+(t-.5)*.15))}}(em[f.type],f.reputation,r),{vHat:x,p:v}=t.computeLabels(y),b=em[m.type],M=f.reputation>=b.acceptanceThreshold&&!m.isFrozen,S=M?({taxRate:n,reputationDecay:1,circuitBreakerEnabled:!1,circuitBreakerThreshold:0}).taxRate:0,_=0,w=0;if(M){_=a.payoffInitiator(v,S,.01,f.reputation),w=a.payoffCounterparty(v,S,.01,m.reputation),f.totalPayoff+=_,m.totalPayoff+=w,f.resources=Math.max(0,f.resources+.1*_),m.resources=Math.max(0,m.resources+.1*w);let e=(v-.5)*.05;f.reputation=Math.max(0,Math.min(1,f.reputation+e)),m.reputation=Math.max(0,Math.min(1,m.reputation+.5*e))}f.interactionsInitiated++,m.interactionsReceived++,f.sumPInitiated+=v,m.sumPReceived+=v;let k={event_type:"interaction",timestamp:new Date().toISOString(),epoch:o,step:i,interaction_id:"".concat(l,"-e").concat(o,"-s").concat(i),initiator:f.id,counterparty:m.id,interaction_type:"collaboration",accepted:M,p:v,v_hat:x};return{result:{p:v,accepted:M,initiatorPayoff:_,counterpartyPayoff:w},event:k}}(i,r,o,e.governance.taxRate,a,p,t,n);f.push(l),c.push(s)}var d,h,u=e.governance.reputationDecay;for(let e of i)e.isFrozen||(e.reputation=.5+u*(e.reputation-.5));let g=function(e,t,a,n){let r=t.filter(e=>e.accepted),o=t.filter(e=>!e.accepted),i=r.length>0?r.reduce((e,t)=>e+(1-t.p),0)/r.length:0,l=r.length>0?r.reduce((e,t)=>e+t.p,0)/r.length:0,s=o.length>0?o.reduce((e,t)=>e+t.p,0)/o.length:0,c=r.length>0&&o.length>0?l-s:0,d=t.length>0?t.reduce((e,t)=>e+t.p,0)/t.length:.5,h=a.map(e=>e.totalPayoff),u=h.reduce((e,t)=>e+t,0),p=a.length>0?u/a.length:0,f=a.length>0?Math.sqrt(h.reduce((e,t)=>e+(t-p)**2,0)/a.length):0,g=a.map(e=>e.reputation),m=g.length>0?g.reduce((e,t)=>e+t,0)/g.length:.5,y=g.length>0?Math.sqrt(g.reduce((e,t)=>e+(t-m)**2,0)/g.length):0;return{simulation_id:n,epoch:e,timestamp:new Date().toISOString(),total_interactions:t.length,accepted_interactions:r.length,rejected_interactions:o.length,toxicity_rate:i,quality_gap:c,avg_p:d,total_welfare:u,avg_payoff:p,payoff_std:f,gini_coefficient:function(e){let t=e.length;if(0===t)return 0;let a=[...e].sort((e,t)=>e-t),n=0;for(let e=0;e<t;e++)n+=(2*(e+1)-t-1)*a[e];let r=a.reduce((e,t)=>e+t,0)/t;return 0===r?0:n/(t*t*r)}(h.map(e=>Math.max(0,e))),total_posts:r.length,total_votes:Math.floor(.3*t.length),total_tasks_completed:r.length,n_agents:a.length,n_frozen:a.filter(e=>e.isFrozen).length,n_quarantined:a.filter(e=>e.isQuarantined).length,avg_reputation:m,reputation_std:y}}(p,f,i,n);for(let t of(l.push(g),d=e.governance,h=g.toxicity_rate,d.circuitBreakerEnabled&&h>d.circuitBreakerThreshold&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;for(let a of e)a.reputation<t&&(a.isFrozen=!0)}(i),i))s.push(function(e,t){let a=e.interactionsInitiated>0?e.sumPInitiated/e.interactionsInitiated:.5,n=e.interactionsReceived>0?e.sumPReceived/e.interactionsReceived:.5;return{agent_id:e.id,epoch:t,name:e.name,agent_type:e.type,reputation:e.reputation,resources:e.resources,interactions_initiated:e.interactionsInitiated,interactions_received:e.interactionsReceived,avg_p_initiated:a,avg_p_received:n,total_payoff:e.totalPayoff,is_frozen:e.isFrozen,is_quarantined:e.isQuarantined}}(t,p));null==t||t(p+1,e.epochs)}return{simulation_id:n,started_at:new Date().toISOString(),ended_at:new Date().toISOString(),n_epochs:e.epochs,steps_per_epoch:e.stepsPerEpoch,n_agents:i.length,seed:e.seed,epoch_snapshots:l,agent_snapshots:s,events:c}}(e,(e,t)=>{o(e/t)});t("done"),o(1),c(n),a(n)}catch(e){t("error"),l(e instanceof Error?e.message:String(e)),a(null)}}},[]),cancel:(0,r.useCallback)(()=>{d.current=!0,t("idle")},[])}}(),[u,p]=(0,r.useState)(null),f=(0,r.useCallback)(e=>{l({...ex,...e.config,governance:{...ex.governance,...e.config.governance},payoff:{...ex.payoff,...e.config.payoff}}),p(e.name)},[]),g=(0,r.useCallback)((e,t)=>{p(null),l(a=>{let n=[...a.agents];return n[e]={...n[e],count:t},{...a,agents:n}})},[]),m=(0,r.useCallback)((e,t)=>{p(null),l(a=>({...a,governance:{...a.governance,[e]:t}}))},[]),y=(0,r.useCallback)((e,t)=>{p(null),l(a=>({...a,payoff:{...a.payoff,[e]:t}}))},[]),x=(0,r.useCallback)(async()=>{if(2>i.agents.reduce((e,t)=>e+t.count,0))return void alert("Need at least 2 agents to run a simulation.");let e=await h(i);e&&o(e)},[i,h,o]),v="running"===s;return(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)(eP,{title:"Presets",children:[(0,n.jsx)("div",{className:"grid grid-cols-2 gap-1.5",children:ew.map(e=>(0,n.jsx)("button",{onClick:()=>f(e),title:e.description,className:"text-left px-2 py-1.5 rounded text-xs transition-colors ".concat(u===e.name?"bg-accent text-bg font-bold":"bg-btn hover:bg-btn-hover"),children:e.name},e.name))}),u&&(0,n.jsx)("p",{className:"text-xs text-muted italic mt-1",children:null==(t=ew.find(e=>e.name===u))?void 0:t.description})]}),(0,n.jsxs)(eP,{title:"Agents",children:[i.agents.map((e,t)=>(0,n.jsx)(ek,{label:e.type.charAt(0).toUpperCase()+e.type.slice(1),value:e.count,min:0,max:10,step:1,onChange:e=>g(t,e)},e.type)),(0,n.jsxs)("p",{className:"text-xs text-muted",children:["Total: ",i.agents.reduce((e,t)=>e+t.count,0)," agents"]})]}),(0,n.jsxs)(eP,{title:"Governance",children:[(0,n.jsx)(ek,{label:"Tax rate",value:i.governance.taxRate,min:0,max:.5,step:.01,onChange:e=>m("taxRate",e),format:e=>e.toFixed(2)}),(0,n.jsx)(ek,{label:"Rep. decay",value:i.governance.reputationDecay,min:.8,max:1,step:.01,onChange:e=>m("reputationDecay",e),format:e=>e.toFixed(2)}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-muted w-28 shrink-0",children:"Circuit breaker"}),(0,n.jsx)("button",{onClick:()=>m("circuitBreakerEnabled",!i.governance.circuitBreakerEnabled),className:"px-2 py-0.5 rounded text-xs ".concat(i.governance.circuitBreakerEnabled?"bg-accent text-bg":"bg-btn"),children:i.governance.circuitBreakerEnabled?"ON":"OFF"}),i.governance.circuitBreakerEnabled&&(0,n.jsxs)("span",{className:"text-xs text-muted",children:["@ ",i.governance.circuitBreakerThreshold]})]})]}),(0,n.jsxs)(eP,{title:"Payoff Parameters",collapsible:!0,children:[(0,n.jsx)(ek,{label:"s_plus",value:i.payoff.s_plus,min:0,max:5,step:.1,onChange:e=>y("s_plus",e),format:e=>e.toFixed(1)}),(0,n.jsx)(ek,{label:"s_minus",value:i.payoff.s_minus,min:0,max:5,step:.1,onChange:e=>y("s_minus",e),format:e=>e.toFixed(1)}),(0,n.jsx)(ek,{label:"h (harm)",value:i.payoff.h,min:0,max:5,step:.1,onChange:e=>y("h",e),format:e=>e.toFixed(1)}),(0,n.jsx)(ek,{label:"theta",value:i.payoff.theta,min:0,max:1,step:.05,onChange:e=>y("theta",e),format:e=>e.toFixed(2)}),(0,n.jsx)(ek,{label:"rho_a",value:i.payoff.rho_a,min:0,max:1,step:.05,onChange:e=>y("rho_a",e),format:e=>e.toFixed(2)}),(0,n.jsx)(ek,{label:"rho_b",value:i.payoff.rho_b,min:0,max:1,step:.05,onChange:e=>y("rho_b",e),format:e=>e.toFixed(2)})]}),(0,n.jsxs)(eP,{title:"Simulation",collapsible:!0,children:[(0,n.jsx)(ek,{label:"Epochs",value:i.epochs,min:5,max:100,step:5,onChange:e=>l(t=>({...t,epochs:e}))}),(0,n.jsx)(ek,{label:"Steps/epoch",value:i.stepsPerEpoch,min:5,max:50,step:5,onChange:e=>l(t=>({...t,stepsPerEpoch:e}))}),(0,n.jsx)(ek,{label:"Seed",value:i.seed,min:1,max:9999,step:1,onChange:e=>l(t=>({...t,seed:e}))})]}),(0,n.jsxs)("div",{className:"pt-3 mt-3 border-t border-border",children:[(0,n.jsx)("button",{onClick:x,disabled:v,className:"w-full py-2 rounded font-bold text-sm bg-accent text-bg hover:opacity-90 disabled:opacity-50 transition-opacity",children:v?"Running...":"Run Simulation"}),v&&(0,n.jsx)("div",{className:"mt-2 h-1.5 bg-btn rounded overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-accent transition-all duration-200",style:{width:"".concat(Math.round(100*c),"%")}})}),d&&(0,n.jsx)("p",{className:"text-xs text-red-400 mt-2",children:d})]})]})}let eC="/game-app",ej=[{name:"Adversarial Red Team (75 epochs)",path:"".concat(eC,"/sample-data/adversarial-redteam-75.json")},{name:"RLM Governance Lag (50 epochs)",path:"".concat(eC,"/sample-data/rlm-governance-lag-50.json")},{name:"Collusion Detection (60 epochs)",path:"".concat(eC,"/sample-data/collusion-detection-60.json")},{name:"24-Agent Mixed Demo",path:"".concat(eC,"/sample-data/demo-history-24.json")},{name:"6-Agent Mixed Demo",path:"".concat(eC,"/sample-data/demo-history.json")}];function eF(){let{data:e,loadData:t}=A(),a=(0,r.useRef)(null),[o,i]=(0,r.useState)("load"),l=(0,r.useCallback)(async e=>{try{let a=await ey(e);t(a)}catch(e){alert("Error loading file: ".concat(e instanceof Error?e.message:e))}},[t]),s=(0,r.useCallback)(async e=>{try{let a=await ey(e);t(a)}catch(e){alert("Error loading sample: ".concat(e instanceof Error?e.message:e))}},[t]);return e?null:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-30 bg-bg",children:(0,n.jsxs)("div",{className:"bg-panel border border-border rounded-xl p-8 max-w-md w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsx)("h1",{className:"text-xl font-bold mb-1",children:"SWARM Isometric Viewer"}),(0,n.jsx)("p",{className:"text-sm text-muted mb-4",children:"Visualize multi-agent simulation data as an interactive isometric city"}),(0,n.jsxs)("div",{className:"flex gap-1 mb-4 bg-btn rounded-lg p-0.5",children:[(0,n.jsx)("button",{onClick:()=>i("load"),className:"flex-1 py-1.5 rounded text-xs font-bold transition-colors ".concat("load"===o?"bg-panel text-text":"text-muted hover:text-text"),children:"Load File"}),(0,n.jsx)("button",{onClick:()=>i("simulate"),className:"flex-1 py-1.5 rounded text-xs font-bold transition-colors ".concat("simulate"===o?"bg-panel text-text":"text-muted hover:text-text"),children:"Run Simulation"})]}),"load"===o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-2 border-dashed border-border rounded-lg p-6 text-center cursor-pointer hover:border-accent transition-colors mb-4",onClick:()=>{var e;return null==(e=a.current)?void 0:e.click()},onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("border-accent")},onDragLeave:e=>{e.currentTarget.classList.remove("border-accent")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("border-accent");let t=e.dataTransfer.files[0];t&&l(t)},children:[(0,n.jsx)("div",{className:"text-3xl mb-2 text-accent",children:"+"}),(0,n.jsxs)("p",{className:"text-sm text-muted",children:["Drop a ",(0,n.jsx)("span",{className:"text-text font-mono",children:"history.json"})," here"]}),(0,n.jsx)("p",{className:"text-xs text-muted mt-1",children:"or click to browse"})]}),(0,n.jsx)("input",{ref:a,type:"file",accept:".json",className:"hidden",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&l(a)}}),(0,n.jsxs)("div",{className:"border-t border-border pt-4",children:[(0,n.jsx)("p",{className:"text-xs text-muted mb-2",children:"Or load sample data:"}),(0,n.jsx)("div",{className:"space-y-2",children:ej.map(e=>(0,n.jsx)("button",{onClick:()=>s(e.path),className:"w-full text-left px-3 py-2 rounded bg-btn hover:bg-btn-hover transition-colors text-sm",children:e.name},e.path))})]})]}):(0,n.jsx)(eT,{onComplete:t})]})})}let eE=[{key:"interactions",label:"Arcs"},{key:"metricsHud",label:"HUD"},{key:"particles",label:"FX"},{key:"minimap",label:"Map"},{key:"collusionLines",label:"Collusion"},{key:"threatZones",label:"Threats"},{key:"digitalRain",label:"Rain"},{key:"tierraStrip",label:"Memory"},{key:"networkWeb",label:"Network"}];function eI(){let{overlays:e,toggleOverlay:t,data:a}=A();return a?(0,n.jsx)("div",{className:"absolute bottom-24 left-4 flex flex-wrap gap-1 z-20 max-w-xs",children:eE.map(a=>{let{key:r,label:o}=a;return(0,n.jsx)("button",{onClick:()=>t(r),className:"px-2.5 py-1 text-[10px] rounded-full border transition-colors ".concat(e[r]?"bg-accent/20 border-accent/50 text-accent":"bg-btn border-border text-muted hover:text-text"),children:o},r)})}):null}function eR(){let[e,t]=(0,r.useState)("enter"),a=(0,r.useCallback)(()=>{"done"!==e&&t("exit")},[e]);return((0,r.useEffect)(()=>{let e=setTimeout(()=>{t(e=>"enter"===e?"exit":e)},2500);return()=>clearTimeout(e)},[]),(0,r.useEffect)(()=>{if("exit"===e){let e=setTimeout(()=>t("done"),700);return()=>clearTimeout(e)}},[e]),"done"===e)?null:(0,n.jsx)("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-bg cursor-pointer ".concat("exit"===e?"animate-[splash-exit_0.7s_ease-in_forwards]":""),onClick:a,children:(0,n.jsx)("img",{src:"".concat("/game-app","/splash.png"),alt:"SWARM",className:"w-64 h-64 object-contain ".concat("enter"===e?"animate-[splash-enter_0.8s_ease-out_forwards,splash-glow_1.7s_ease-in-out_0.8s_infinite]":"")})})}function eN(e){return(100*e).toFixed(0)+"%"}let eA={danger:{bg:"rgba(235,87,87,0.12)",border:"#EB5757",icon:""},warning:{bg:"rgba(242,153,74,0.12)",border:"#F2994A",icon:""},info:{bg:"rgba(86,152,255,0.12)",border:"#5698FF",icon:""},success:{bg:"rgba(111,207,151,0.12)",border:"#6FCF97",icon:""}};function eD(){var e;let{data:t,currentEpoch:a}=A(),o=(0,r.useMemo)(()=>t?function(e){let t=[],{epoch_snapshots:a,agent_snapshots:n}=e;for(let e=0;e<a.length;e++){let r=a[e],o=e>0?a[e-1]:null;if(o&&r.toxicity_rate>o.toxicity_rate+.15&&r.toxicity_rate>.2&&t.push({epoch:r.epoch,type:"danger",message:"Toxicity spike: ".concat(eN(o.toxicity_rate),"  ").concat(eN(r.toxicity_rate))}),o&&o.toxicity_rate<=.4&&r.toxicity_rate>.4&&t.push({epoch:r.epoch,type:"danger",message:"Toxicity crossed critical threshold (40%)"}),o&&r.n_frozen>o.n_frozen){let e=r.n_frozen-o.n_frozen;t.push({epoch:r.epoch,type:"warning",message:"Circuit breaker: ".concat(e," agent").concat(e>1?"s":""," frozen")})}if(o&&r.n_quarantined>o.n_quarantined){let e=r.n_quarantined-o.n_quarantined;t.push({epoch:r.epoch,type:"warning",message:"".concat(e," agent").concat(e>1?"s":""," quarantined")})}o&&o.quality_gap>=0&&r.quality_gap<-.05&&t.push({epoch:r.epoch,type:"danger",message:"Adverse selection detected (quality gap: ".concat(r.quality_gap.toFixed(3),")")}),o&&r.gini_coefficient>o.gini_coefficient+.1&&r.gini_coefficient>.3&&t.push({epoch:r.epoch,type:"warning",message:"Inequality rising: Gini ".concat(o.gini_coefficient.toFixed(2),"  ").concat(r.gini_coefficient.toFixed(2))}),o&&o.total_welfare>0&&r.total_welfare<0&&t.push({epoch:r.epoch,type:"danger",message:"Welfare collapsed below zero"}),o&&o.toxicity_rate>.3&&r.toxicity_rate<o.toxicity_rate-.1&&t.push({epoch:r.epoch,type:"success",message:"Recovery: toxicity ".concat(eN(o.toxicity_rate),"  ").concat(eN(r.toxicity_rate))}),r.accepted_interactions===r.total_interactions&&r.total_interactions>0&&r.avg_p>.7&&t.push({epoch:r.epoch,type:"success",message:"Perfect cooperation: all ".concat(r.total_interactions," interactions accepted")}),r.total_interactions>0&&r.rejected_interactions/r.total_interactions>.7&&t.push({epoch:r.epoch,type:"warning",message:"Trust breakdown: ".concat(Math.round(r.rejected_interactions/r.total_interactions*100),"% rejected")});let i=n.filter(e=>e.epoch===r.epoch),l=e>0?n.filter(t=>t.epoch===a[e-1].epoch):[];for(let e of i){let a=l.find(t=>t.agent_id===e.agent_id);a&&a.reputation>.3&&e.reputation<.1&&t.push({epoch:r.epoch,type:"info",message:"".concat(e.name||e.agent_id," reputation collapsed")})}}return t}(t):[],[t]),i=null!=(e=(0,r.useMemo)(()=>{let e=new Map,t=["danger","warning","info","success"];for(let a of o){let n=e.get(a.epoch);(!n||t.indexOf(a.type)<t.indexOf(n.type))&&e.set(a.epoch,a)}return e},[o]).get(a))?e:null;if(!i)return null;let l=eA[i.type];return(0,n.jsx)("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-30 pointer-events-none animate-narrative-toast",children:(0,n.jsxs)("div",{className:"px-4 py-2.5 rounded-lg backdrop-blur-sm border text-sm font-medium shadow-lg",style:{background:l.bg,borderColor:l.border,color:l.border},children:[(0,n.jsx)("span",{className:"mr-2",children:l.icon}),(0,n.jsxs)("span",{className:"text-text",children:["Epoch ",i.epoch,":"]})," ",i.message]})},"".concat(i.epoch,"-").concat(i.message))}function eB(){return(0,n.jsx)(N,{children:(0,n.jsxs)("div",{className:"relative w-screen h-screen overflow-hidden bg-bg",children:[(0,n.jsx)("div",{className:"absolute inset-0",children:(0,n.jsx)(et,{})}),(0,n.jsx)(eF,{}),(0,n.jsx)(ei,{}),(0,n.jsx)(ec,{}),(0,n.jsx)(eD,{}),(0,n.jsx)(eu,{}),(0,n.jsx)(eI,{}),(0,n.jsx)(en,{}),(0,n.jsx)(eR,{})]})})}function eW(){return(0,n.jsx)(eB,{})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=3777)),_N_E=e.O()}]);